<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Debug</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .value { font-size: 48px; font-weight: bold; color: #0094CE; }
        .label { color: #666; margin-bottom: 10px; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸŒ SolarSDGs IoT Debug Dashboard</h1>

    <div class="card">
        <div class="label">ç™¼é›»åŠŸç‡ (PG)</div>
        <div class="value" id="pg">--</div>
    </div>

    <div class="card">
        <div class="label">è² è¼‰ A (PA)</div>
        <div class="value" id="pa">--</div>
    </div>

    <div class="card">
        <div class="label">è² è¼‰ P (PP)</div>
        <div class="value" id="pp">--</div>
    </div>

    <div class="card">
        <h3>API å›æ‡‰ (æœ€æ–° 5 ç­†)</h3>
        <pre id="raw-data">è¼‰å…¥ä¸­...</pre>
    </div>

    <div class="card">
        <h3>Debug æ—¥èªŒ</h3>
        <pre id="debug-log"></pre>
    </div>

    <script>
        const log = [];
        function addLog(msg) {
            const timestamp = new Date().toLocaleTimeString();
            log.push(`[${timestamp}] ${msg}`);
            document.getElementById('debug-log').textContent = log.join('\n');
            console.log(msg);
        }

        async function loadData() {
            try {
                addLog('é–‹å§‹è¼‰å…¥æ•¸æ“š...');

                const url = '/api/power-data/device/6001/latest?limit=5';
                addLog(`è«‹æ±‚ URL: ${url}`);

                const response = await fetch(url);
                addLog(`HTTP ç‹€æ…‹: ${response.status}`);

                const data = await response.json();
                addLog(`JSON è§£ææˆåŠŸ`);

                document.getElementById('raw-data').textContent = JSON.stringify(data, null, 2);

                if (data.success && data.data && data.data.records && data.data.records.length > 0) {
                    const latest = data.data.records[0];
                    document.getElementById('pg').textContent = latest.pg + ' W';
                    document.getElementById('pa').textContent = latest.pa + ' W';
                    document.getElementById('pp').textContent = latest.pp + ' W';
                    addLog(`âœ… æˆåŠŸè¼‰å…¥ ${data.data.records.length} ç­†æ•¸æ“š`);
                } else {
                    addLog('âŒ æ•¸æ“šæ ¼å¼éŒ¯èª¤æˆ–ç„¡æ•¸æ“š');
                }
            } catch (error) {
                addLog(`âŒ éŒ¯èª¤: ${error.message}`);
                document.getElementById('raw-data').textContent = `ERROR: ${error.message}\n${error.stack}`;
            }
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        addLog('é é¢è¼‰å…¥å®Œæˆ');
        loadData();

        // æ¯ 10 ç§’è‡ªå‹•æ›´æ–°
        setInterval(loadData, 10000);
    </script>
</body>
</html>
