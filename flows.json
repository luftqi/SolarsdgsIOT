[
    {
        "id": "4f2c9b23a074cc9b",
        "type": "tab",
        "label": "æµç¨‹1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "pwa_icons_tab",
        "type": "tab",
        "label": "PWA Icons - SOLARSDGS",
        "disabled": false,
        "info": "æä¾› SOLARSDGS PWA æ‰€éœ€çš„æ‰€æœ‰åœ–æ¨™å’Œ manifest.json"
    },
    {
        "id": "849c2c2e77621376",
        "type": "postgreSQLConfig",
        "name": "",
        "host": "postgres",
        "hostFieldType": "str",
        "port": 5432,
        "portFieldType": "num",
        "database": "solar_db",
        "databaseFieldType": "str",
        "ssl": "false",
        "sslFieldType": "bool",
        "applicationName": "",
        "applicationNameType": "str",
        "max": 10,
        "maxFieldType": "num",
        "idle": 1000,
        "idleFieldType": "num",
        "connectionTimeout": 10000,
        "connectionTimeoutFieldType": "num",
        "user": "admin",
        "userFieldType": "str",
        "password": "admin123",
        "passwordFieldType": "str"
    },
    {
        "id": "1de931c467a32710",
        "type": "mqtt-broker",
        "name": "Solar MQTT Broker",
        "broker": "mqtt",
        "port": 1883,
        "clientid": "nodered-solar-001",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": 4,
        "keepalive": 60,
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "814ba59b266aa278",
        "type": "ui-base",
        "name": "Solar Monitoring System",
        "path": "/dashboard",
        "appIcon": "",
        "includeClientData": true,
        "acceptsClientConfig": [
            "ui-notification",
            "ui-control"
        ],
        "showPathInSidebar": false,
        "headerContent": "page",
        "navigationStyle": "default",
        "titleBarStyle": "hidden",
        "showReconnectNotification": true,
        "notificationDisplayTime": 1,
        "showDisconnectNotification": true,
        "allowInstall": true
    },
    {
        "id": "3388de7ea2c4a1f1",
        "type": "ui-theme",
        "name": "Default Theme",
        "colors": {
            "surface": "#ffffff",
            "primary": "#0094CE",
            "bgPage": "#eeeeee",
            "groupBg": "#ffffff",
            "groupOutline": "#cccccc"
        },
        "sizes": {
            "density": "default",
            "pagePadding": "12px",
            "groupGap": "12px",
            "groupBorderRadius": "4px",
            "widgetGap": "12px"
        }
    },
    {
        "id": "d7a4298f3059e4c3",
        "type": "ui-page",
        "name": "solar monitor",
        "ui": "814ba59b266aa278",
        "path": "/page1",
        "icon": "home",
        "layout": "grid",
        "theme": "3388de7ea2c4a1f1",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 3,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "24c6ae5a937a533f",
        "type": "ui-group",
        "name": "ä¸»ç›£æ§å€",
        "page": "d7a4298f3059e4c3",
        "width": "12",
        "height": "8",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "7b548c71fe97e474",
        "type": "ui-spacer",
        "group": "24c6ae5a937a533f",
        "name": "spacer",
        "tooltip": "",
        "order": 8,
        "width": 1,
        "height": 1,
        "className": ""
    },
    {
        "id": "e4c8b01d1e02491a",
        "type": "ui-page",
        "name": "login",
        "ui": "814ba59b266aa278",
        "path": "/login",
        "icon": "home",
        "layout": "grid",
        "theme": "3388de7ea2c4a1f1",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 1,
        "className": "",
        "visible": "false",
        "disabled": "false"
    },
    {
        "id": "c3627b645dc69831",
        "type": "ui-group",
        "name": "ç™»å…¥ç•«é¢",
        "page": "e4c8b01d1e02491a",
        "width": "14",
        "height": "10",
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "14e4b2bc7756e5f9",
        "type": "ui-page",
        "name": "customer manage",
        "ui": "814ba59b266aa278",
        "path": "/admin",
        "icon": "home",
        "layout": "grid",
        "theme": "3388de7ea2c4a1f1",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 2,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "7f54281a9ecb8f13",
        "type": "ui-group",
        "name": "å®¢æˆ¶ç®¡ç†",
        "page": "14e4b2bc7756e5f9",
        "width": "12",
        "height": "8",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "624e02a3dcdcb213",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "LIST",
        "func": "// Function: LIST_TABLES_DEBUG\n// åˆ—å‡ºæ‰€æœ‰è¡¨æ ¼ + å®Œæ•´ Debug\n\nmsg.query = `\n    SELECT \n        table_name,\n        table_schema\n    FROM information_schema.tables \n    WHERE table_schema = 'public' \n    ORDER BY table_name;\n`;\n\nmsg.params = [];\n\nnode.warn('ğŸ“‹ åˆ—å‡ºæ‰€æœ‰è¡¨æ ¼');\nnode.warn('   Query: ' + msg.query.substring(0, 100) + '...');\nnode.warn('   ç­‰å¾… PostgreSQL å›æ‡‰...');\n\n// æ¨™è¨˜é€™æ˜¯æŸ¥è©¢è«‹æ±‚\nmsg._debug_label = 'LIST_TABLES';\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 260,
        "wires": [
            [
                "8467c34d555d1bfe"
            ]
        ]
    },
    {
        "id": "c461e4bb1ef3981c",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1310,
        "y": 200,
        "wires": [
            [
                "5c65df98cba2b5d5"
            ]
        ]
    },
    {
        "id": "8467c34d555d1bfe",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1310,
        "y": 260,
        "wires": [
            [
                "465c8800dd2a282d"
            ]
        ]
    },
    {
        "id": "9a4df4aae613c3cf",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1370,
        "y": 320,
        "wires": [
            [
                "f9aba0132dba17df"
            ]
        ]
    },
    {
        "id": "76c306261b085c58",
        "type": "mqtt in",
        "z": "4f2c9b23a074cc9b",
        "name": "Solar Data Input",
        "topic": "solar/+/data",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "1de931c467a32710",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 180,
        "y": 700,
        "wires": [
            [
                "586ca0706858a41b"
            ]
        ]
    },
    {
        "id": "7254f1e24f7f33bd",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "Send ACK",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 570,
        "y": 780,
        "wires": []
    },
    {
        "id": "400276d4bcaa5d90",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 770,
        "y": 700,
        "wires": [
            [
                "c673737c2a561213"
            ]
        ]
    },
    {
        "id": "586ca0706858a41b",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æ•¸æ“šè§£æå™¨",
        "func": "// =================================================================\n// MQTT æ•¸æ“šè§£æå™¨ V8.1 - åŠ å…¥ Factor ä¿®æ­£\n// ä½ç½®ï¼šMQTT In (solar/+/data) â†’ [é€™è£¡] â†’ 3å€‹è¼¸å‡º\n// \n// â­ æ–°å¢ï¼šå¾ flow context è®€å– Factor ä¸¦æ‡‰ç”¨åˆ° PA/PP\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\n// ========== æ­¥é©Ÿ 1: æå– device_id ==========\nlet deviceId = '6002';\nif (msg.topic) {\n    const topicParts = msg.topic.split('/');\n    if (topicParts.length >= 2 && topicParts[0] === 'solar') {\n        deviceId = topicParts[1];\n    }\n}\n\nlog('[Data Parser] ========================================');\nlog(`[Data Parser] è¨­å‚™: ${deviceId}`);\n\n// ========== â­ æ­¥é©Ÿ 1.5: è®€å– Factor é…ç½® ==========\nconst factorKey = `factor_${deviceId}`;\nconst factorConfig = flow.get(factorKey) || {\n    factor_a: 1.0,\n    factor_p: 1.0\n};\n\nconst factor_a = parseFloat(factorConfig.factor_a) || 1.0;\nconst factor_p = parseFloat(factorConfig.factor_p) || 1.0;\n\nlog(`[Data Parser] Factor é…ç½®: A=${factor_a}, P=${factor_p}`);\nlog('[Data Parser] ========================================');\n\n// ========== æ­¥é©Ÿ 2: è§£æåŸå§‹æ•¸æ“š ==========\nlet rawData = msg.payload;\n\nif (Buffer.isBuffer(rawData)) {\n    rawData = rawData.toString('utf-8');\n}\n\nif (typeof rawData !== 'string') {\n    rawData = String(rawData);\n}\n\nconst cleanData = rawData.replace(/[\"\\s]/g, '').trim();\nconst finalData = cleanData.endsWith(',') ? cleanData.slice(0, -1) : cleanData;\n\nlog(`[Data Parser] åŸå§‹æ•¸æ“š: ${rawData.substring(0, 100)}...`);\nlog(`[Data Parser] æ¸…ç†å¾Œ: ${finalData.substring(0, 100)}...`);\n\n// ========== æ­¥é©Ÿ 3: åˆ†å‰²æ‰¹é‡æ•¸æ“š ==========\nconst dataEntries = finalData.includes(',')\n    ? finalData.split(',').filter(s => s.trim().length > 0)\n    : [finalData];\n\nlog(`[Data Parser] æ•¸æ“šæ¢æ•¸: ${dataEntries.length}`);\n\nif (dataEntries.length === 0) {\n    log('[Data Parser] âŒ ç„¡æœ‰æ•ˆæ•¸æ“š');\n    setStatus(\"red\", \"ring\", \"ç„¡æ•¸æ“š\");\n    return [null, null, null];\n}\n\n// ========== æ­¥é©Ÿ 4: è§£ææ¯æ¢æ•¸æ“š ==========\nconst sqlBatch = [];\nlet latestChartData = null;\nlet processedCount = 0;\nconst errors = [];\n\nfor (let i = 0; i < dataEntries.length; i++) {\n    const entry = dataEntries[i].trim();\n\n    if (!entry) continue;\n\n    try {\n        // åˆ†å‰²æ•¸æ“šï¼štimestamp/pg/pa/pp/pag/ppg\n        const parts = entry.split('/');\n\n        if (parts.length !== 6 && parts.length !== 4) {\n            errors.push(`[${i}] æ ¼å¼éŒ¯èª¤: ${parts.length}å€‹éƒ¨åˆ†`);\n            continue;\n        }\n\n        // === è§£ææ™‚é–“æˆ³ ===\n        const timeParts = parts[0].split('_');\n        if (timeParts.length !== 6) {\n            errors.push(`[${i}] æ™‚é–“æ ¼å¼éŒ¯èª¤: ${parts[0]}`);\n            continue;\n        }\n\n        const [year, month, day, hour, minute, second] = timeParts.map(Number);\n\n        // é©—è­‰æ™‚é–“ç¯„åœ\n        if (year < 2020 || year > 2030 ||\n            month < 1 || month > 12 ||\n            day < 1 || day > 31 ||\n            hour < 0 || hour > 23 ||\n            minute < 0 || minute > 59 ||\n            second < 0 || second > 59) {\n            errors.push(`[${i}] æ™‚é–“å€¼ä¸åˆç†: ${parts[0]}`);\n            continue;\n        }\n\n        // å‰µå»º Date å°è±¡\n        const timestamp = new Date(year, month - 1, day, hour, minute, second);\n\n        if (isNaN(timestamp.getTime())) {\n            errors.push(`[${i}] ç„¡æ•ˆæ—¥æœŸ: ${parts[0]}`);\n            continue;\n        }\n\n        // SQL æ ¼å¼æ™‚é–“æˆ³\n        const sqlTimestamp = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')} ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}:${String(second).padStart(2, '0')}`;\n\n        // Unix æ¯«ç§’æ™‚é–“æˆ³\n        const unixTimestamp = timestamp.getTime();\n\n        // === â­ è§£æåŠŸç‡å€¼ä¸¦æ‡‰ç”¨ Factor ===\n        const pg_raw = parseInt(parts[1]) || 0;\n        const pa_raw = parseInt(parts[2]) || 0;\n        const pp_raw = parseInt(parts[3]) || 0;\n\n        // æ‡‰ç”¨ Factor ä¿®æ­£\n        const pg = pg_raw;  // PG ä¿æŒåŸå€¼ï¼ˆç™¼é›»åŠŸç‡ä¸ä¿®æ­£ï¼‰\n        const pa = Math.round(pa_raw * factor_a);  // PA ä¹˜ä»¥ factor_a\n        const pp = Math.round(pp_raw * factor_p);  // PP ä¹˜ä»¥ factor_p\n\n        // é©—è­‰åŠŸç‡å€¼ç¯„åœ\n        if (pg < 0 || pg > 10000 || pa < 0 || pa > 10000 || pp < 0 || pp > 10000) {\n            errors.push(`[${i}] åŠŸç‡è¶…å‡ºç¯„åœ`);\n            continue;\n        }\n\n        // === è§£ææˆ–è¨ˆç®—æ•ˆç‡ï¼ˆä½¿ç”¨ä¿®æ­£å¾Œçš„å€¼ï¼‰===\n        let pag, ppg;\n\n        if (parts.length === 6) {\n            // V6.3 æ–°æ ¼å¼ï¼šæœ‰æ•ˆç‡å€¼ï¼Œä½†éœ€è¦é‡æ–°è¨ˆç®—ï¼ˆå› ç‚º PA/PP å·²ä¿®æ­£ï¼‰\n            // å¿½ç•¥åŸå§‹æ•ˆç‡ï¼Œç”¨ä¿®æ­£å¾Œçš„åŠŸç‡é‡æ–°è¨ˆç®—\n            pag = pg > 0 ? ((pa - pg) * 100 / pg) : 0;\n            ppg = pg > 0 ? ((pp - pg) * 100 / pg) : 0;\n        } else {\n            // èˆŠæ ¼å¼ï¼šéœ€è¦è¨ˆç®—æ•ˆç‡\n            pag = pg > 0 ? ((pa - pg) * 100 / pg) : 0;\n            ppg = pg > 0 ? ((pp - pg) * 100 / pg) : 0;\n        }\n\n        // å››æ¨äº”å…¥åˆ°2ä½å°æ•¸\n        const pagRounded = Math.round(pag * 100) / 100;\n        const ppgRounded = Math.round(ppg * 100) / 100;\n\n        // === æº–å‚™ SQL æ•¸æ“š ===\n        const sqlRow = [\n            deviceId,\n            sqlTimestamp,\n            pg,      // ä¿®æ­£å¾Œçš„å€¼\n            pa,      // ä¿®æ­£å¾Œçš„å€¼\n            pp,      // ä¿®æ­£å¾Œçš„å€¼\n            pagRounded,  // é‡æ–°è¨ˆç®—çš„æ•ˆç‡\n            ppgRounded   // é‡æ–°è¨ˆç®—çš„æ•ˆç‡\n        ];\n\n        sqlBatch.push(sqlRow);\n\n        // === ä¿å­˜æœ€æ–°æ•¸æ“šï¼ˆç”¨æ–¼åœ–è¡¨å’ŒUIï¼‰===\n        latestChartData = {\n            deviceId: deviceId,\n            timestamp: sqlTimestamp,\n            unixTimestamp: unixTimestamp,\n            pg: pg,\n            pa: pa,\n            pp: pp,\n            pag: pagRounded,\n            ppg: ppgRounded\n        };\n\n        processedCount++;\n\n        // è©³ç´°æ—¥èªŒï¼ˆå‰3æ¢ï¼‰\n        if (i < 3) {\n            log(`[Data Parser] [${i}] ${sqlTimestamp}`);\n            log(`[Data Parser]   åŸå§‹: PG:${pg_raw}W PA:${pa_raw}W PP:${pp_raw}W`);\n            log(`[Data Parser]   ä¿®æ­£: PG:${pg}W PA:${pa}W PP:${pp}W (AÃ—${factor_a}, PÃ—${factor_p})`);\n            log(`[Data Parser]   æ•ˆç‡: PAG:${pagRounded}% PPG:${ppgRounded}%`);\n        }\n\n    } catch (error) {\n        errors.push(`[${i}] ç•°å¸¸: ${error.message}`);\n    }\n}\n\n// ========== æ­¥é©Ÿ 5: è¼¸å‡ºçµ±è¨ˆ ==========\nlog('[Data Parser] ========================================');\nlog(`[Data Parser] è™•ç†å®Œæˆ: æˆåŠŸ ${processedCount}/${dataEntries.length}`);\n\nif (errors.length > 0) {\n    log(`[Data Parser] éŒ¯èª¤æ•¸: ${errors.length}`);\n    if (errors.length <= 5) {\n        errors.forEach(err => log(`[Data Parser] ${err}`));\n    }\n}\n\n// ========== æ­¥é©Ÿ 6: æª¢æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ•¸æ“š ==========\nif (sqlBatch.length === 0) {\n    log('[Data Parser] âŒ ç„¡æœ‰æ•ˆæ•¸æ“šå¯è™•ç†');\n    setStatus(\"red\", \"ring\", `å¤±æ•—: ${errors.length}`);\n    return [null, null, null];\n}\n\n// ========== æ­¥é©Ÿ 7: æº–å‚™ä¸‰å€‹è¼¸å‡º ==========\n\n// === Output 1: åœ–è¡¨æ•¸æ“š ===\nlet chartOutput = null;\n\nif (latestChartData) {\n    chartOutput = {\n        payload: latestChartData,\n        device_id: deviceId\n    };\n\n    log('[Data Parser] Output 1: åœ–è¡¨æ•¸æ“š âœ…');\n    log(`[Data Parser]   æ™‚é–“: ${latestChartData.timestamp}`);\n    log(`[Data Parser]   PG: ${latestChartData.pg}W (ä¿®æ­£å¾Œ)`);\n    log(`[Data Parser]   PA: ${latestChartData.pa}W (ä¿®æ­£å¾Œ)`);\n    log(`[Data Parser]   PP: ${latestChartData.pp}W (ä¿®æ­£å¾Œ)`);\n}\n\n// === Output 2: SQLæ•¸æ“š ===\nlet sqlOutput;\n\nif (sqlBatch.length === 1) {\n    sqlOutput = {\n        query_type: 'insert_power_data',\n        params: sqlBatch[0],\n        device_id: deviceId,\n        stats: {\n            total: dataEntries.length,\n            processed: processedCount,\n            errors: errors.length\n        }\n    };\n    log('[Data Parser] Output 2: å–®æ¢SQLæ’å…¥ âœ…');\n} else {\n    sqlOutput = {\n        query_type: 'batch_insert_power_data',\n        batch_data: sqlBatch,\n        device_id: deviceId,\n        stats: {\n            total: dataEntries.length,\n            processed: processedCount,\n            errors: errors.length\n        }\n    };\n    log(`[Data Parser] Output 2: æ‰¹é‡SQLæ’å…¥ (${sqlBatch.length}æ¢) âœ…`);\n}\n\n// === Output 3: å³æ™‚UIæ•¸æ“š ===\nlet uiOutput = null;\n\nif (latestChartData) {\n    uiOutput = {\n        payload: {\n            type: 'realtime',\n            device_id: deviceId,\n            online: true,\n            lastUpdate: new Date().toLocaleTimeString('zh-TW'),\n            pg: latestChartData.pg,\n            pa: latestChartData.pa,\n            pp: latestChartData.pp,\n            pag: latestChartData.pag,\n            ppg: latestChartData.ppg,\n            timestamp: latestChartData.timestamp\n        },\n        device_id: deviceId\n    };\n\n    log('[Data Parser] Output 3: å³æ™‚UIæ•¸æ“š âœ…');\n}\n\n// ========== æ­¥é©Ÿ 8: è¨­ç½®ç‹€æ…‹ ==========\nif (errors.length === 0) {\n    setStatus(\"green\", \"dot\", `âœ… ${processedCount}æ¢ (AÃ—${factor_a}, PÃ—${factor_p})`);\n} else {\n    setStatus(\"yellow\", \"dot\", `âš ï¸ ${processedCount}/${dataEntries.length}`);\n}\n\nlog('[Data Parser] ========================================');\nlog('[Data Parser] âœ… ä¸‰è¼¸å‡ºæº–å‚™å®Œæˆï¼ˆå·²æ‡‰ç”¨ Factorï¼‰');\nlog('[Data Parser] ========================================');\n\n// ========== æ­¥é©Ÿ 9: è¿”å›ä¸‰å€‹è¼¸å‡º ==========\nreturn [chartOutput, sqlOutput, uiOutput];",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 700,
        "wires": [
            [
                "b8c1b92e2877575f"
            ],
            [
                "b71bb8b4f401e6c3"
            ],
            [
                "c75e089718b69008"
            ]
        ]
    },
    {
        "id": "c673737c2a561213",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "çµæœè™•ç†å™¨",
        "func": "// =================================================================\n// çµæœè™•ç†å™¨ V4.0 - å®Œæ•´ç‰ˆï¼ˆç§»é™¤é…ç½®æŸ¥è©¢ï¼‰\n// ä½ç½®ï¼šPostgreSQL â†’ [é€™è£¡] â†’ 2å€‹è¼¸å‡º\n// \n// åŠŸèƒ½ï¼šè™•ç†è³‡æ–™åº«æ“ä½œçµæœï¼Œç™¼é€ACKå’Œæ›´æ–°ç‹€æ…‹\n// è¼¸å…¥ï¼šä¾†è‡ª PostgreSQL çš„åŸ·è¡Œçµæœ\n// è¼¸å‡ºï¼š2å€‹ï¼ˆACK, æ›´æ–°ç‹€æ…‹ï¼‰\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog('[Result] ========================================');\n\n// ========== æ­¥é©Ÿ 1: æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤ ==========\nif (msg.error) {\n    log(`[Result] âŒ è³‡æ–™åº«éŒ¯èª¤: ${msg.error}`);\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n\n    // å–å¾—è¨­å‚™ ID\n    const deviceId = msg.device_id || '6002';\n\n    // æº–å‚™éŒ¯èª¤é€šçŸ¥\n    const errorOutput = {\n        topic: `solar/${deviceId}/error`,\n        payload: JSON.stringify({\n            error: msg.error,\n            timestamp: new Date().toISOString(),\n            source: 'postgresql'\n        }),\n        qos: 1\n    };\n\n    log(`[Result] ç™¼é€éŒ¯èª¤é€šçŸ¥åˆ°: solar/${deviceId}/error`);\n    log('[Result] ========================================');\n\n    // è¿”å›å…©å€‹è¼¸å‡ºï¼ˆåªæœ‰ç¬¬ä¸€å€‹æœ‰å€¼ï¼‰\n    return [errorOutput, null];\n}\n\n// ========== æ­¥é©Ÿ 2: æª¢æŸ¥æ’å…¥çµæœ ==========\nif (!msg.payload) {\n    log('[Result] âš ï¸ msg.payload ç‚ºç©º');\n    setStatus(\"yellow\", \"ring\", \"ç„¡çµæœ\");\n    return [null, null];\n}\n\nif (Array.isArray(msg.payload) && msg.payload.length === 0) {\n    log('[Result] âš ï¸ ç„¡è³‡æ–™æ’å…¥ï¼ˆç©ºé™£åˆ—ï¼‰');\n    setStatus(\"yellow\", \"ring\", \"ç„¡è³‡æ–™\");\n    return [null, null];\n}\n\n// ========== æ­¥é©Ÿ 3: çµ±è¨ˆæ’å…¥çµæœ ==========\nconst insertedCount = Array.isArray(msg.payload) ? msg.payload.length : 1;\nlog(`[Result] âœ… æˆåŠŸæ’å…¥ ${insertedCount} ç­†æ•¸æ“šåˆ°è³‡æ–™åº«`);\n\n// ========== æ­¥é©Ÿ 4: å–å¾—è¨­å‚™ ID ==========\nconst deviceId = msg.device_id || '6002';\nlog(`[Result] è¨­å‚™ ID: ${deviceId}`);\n\n// ========== æ­¥é©Ÿ 5: é¡¯ç¤ºçµ±è¨ˆè³‡è¨Šï¼ˆå¦‚æœæœ‰ï¼‰==========\nif (msg.stats) {\n    log('[Result] ----------------------------------------');\n    log(`[Result] çµ±è¨ˆè³‡è¨Š:`);\n    log(`[Result]   ç¸½æ•¸: ${msg.stats.total || 0}`);\n    log(`[Result]   æˆåŠŸ: ${msg.stats.processed || 0}`);\n    log(`[Result]   éŒ¯èª¤: ${msg.stats.errors || 0}`);\n\n    if (msg.stats.errors > 0) {\n        const successRate = ((msg.stats.processed / msg.stats.total) * 100).toFixed(1);\n        log(`[Result]   æˆåŠŸç‡: ${successRate}%`);\n    }\n}\n\nlog('[Result] ----------------------------------------');\n\n// ========== æ­¥é©Ÿ 6: æº–å‚™å…©å€‹è¼¸å‡º ==========\n\n// === Output 1: ç™¼é€ ACK åˆ°è¨­å‚™ ===\nconst ackOutput = {\n    topic: `solar/${deviceId}/ack`,\n    payload: 'OK',\n    qos: 1\n};\n\nlog(`[Result] Output 1: ç™¼é€ ACK`);\nlog(`[Result]   ä¸»é¡Œ: solar/${deviceId}/ack`);\nlog(`[Result]   å…§å®¹: OK`);\n\n// === Output 2: æ›´æ–°è¨­å‚™æœ€å¾Œä¸Šç·šæ™‚é–“ ===\nconst updateStatusOutput = {\n    query_type: 'update_device_status',\n    params: [deviceId],\n    device_id: deviceId,\n    _source: 'result_processor'\n};\n\nlog(`[Result] Output 2: æ›´æ–°è¨­å‚™ç‹€æ…‹`);\nlog(`[Result]   è¨­å‚™: ${deviceId}`);\nlog(`[Result]   å‹•ä½œ: æ›´æ–° last_seen æ™‚é–“æˆ³`);\n\n// ========== æ­¥é©Ÿ 7: è¨­ç½®ç¯€é»ç‹€æ…‹ ==========\nlet statusText;\nif (msg.stats && msg.stats.errors > 0) {\n    statusText = `âš ï¸ ${deviceId}: ${msg.stats.processed}/${msg.stats.total}`;\n    setStatus(\"yellow\", \"dot\", statusText);\n} else {\n    statusText = `âœ… ${deviceId}: ${insertedCount}ç­†`;\n    setStatus(\"green\", \"dot\", statusText);\n}\n\nlog('[Result] ========================================');\nlog(`[Result] âœ… å…©å€‹è¼¸å‡ºæº–å‚™å®Œæˆ`);\nlog('[Result] ========================================');\n\n// ========== æ­¥é©Ÿ 8: è¿”å›å…©å€‹è¼¸å‡º ==========\nreturn [ackOutput, updateStatusOutput];\n\n// =================================================================\n// ğŸ“‹ è¼¸å‡ºèªªæ˜\n// =================================================================\n//\n// Output 1 (ACK): ç™¼é€åˆ° [Send ACK] MQTT Out\n// {\n//     topic: \"solar/6002/ack\",\n//     payload: \"OK\",\n//     qos: 1\n// }\n//\n// Output 2 (æ›´æ–°ç‹€æ…‹): ç™¼é€åˆ° [SQLç”Ÿæˆå™¨-æ›´æ–°ç‹€æ…‹] â†’ [PostgreSQL]\n// {\n//     query_type: 'update_device_status',\n//     params: ['6002'],\n//     device_id: '6002',\n//     _source: 'result_processor'\n// }\n//\n// =================================================================\n// ğŸ”Œ é€£ç·šæ–¹å¼\n// =================================================================\n//\n// [PostgreSQL]\n//     â†“\n// [æ­¤ç¯€é»: çµæœè™•ç†å™¨] (è¼¸å‡ºæ•¸: 2) â­ é‡è¦ï¼\n//     â”œâ”€ Output 1 â†’ [Send ACK] (MQTT Out)\n//     â””â”€ Output 2 â†’ [SQLç”Ÿæˆå™¨-æ›´æ–°ç‹€æ…‹] â†’ [PostgreSQL-æ›´æ–°ç‹€æ…‹]\n//\n// =================================================================\n// âš™ï¸ ç¯€é»è¨­å®š\n// =================================================================\n//\n// åç¨±: çµæœè™•ç†å™¨\n// è¼¸å‡ºæ•¸é‡: 2  â­ é‡è¦ï¼ï¼ˆå¾3æ”¹ç‚º2ï¼‰\n//\n// =================================================================\n// ğŸ“ ç‰ˆæœ¬è®Šæ›´\n// =================================================================\n//\n// V4.0 (æ–°ç‰ˆ):\n// - ç§»é™¤ Output 3ï¼ˆé…ç½®æŸ¥è©¢ï¼‰\n// - é…ç½®åŒæ­¥æ”¹ç”± UI æ›´æ–°æ™‚è§¸ç™¼\n// - æ¸›å°‘ä¸å¿…è¦çš„è³‡æ–™åº«æŸ¥è©¢\n//\n// V3.0 (èˆŠç‰ˆ):\n// - æœ‰ Output 3 æŸ¥è©¢é…ç½®\n// - æ¯æ¬¡æ•¸æ“šä¸Šå‚³éƒ½æŸ¥è©¢ï¼ˆæµªè²»è³‡æºï¼‰\n//\n// =================================================================",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 800,
        "wires": [
            [
                "7254f1e24f7f33bd"
            ],
            [
                "4e63fc0483df2653"
            ]
        ]
    },
    {
        "id": "c4e07c78e9c9ab76",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "åŠŸç‡æ•¸æ“šæ¨¡æ“¬å™¨",
        "func": "// ====================================================================\n// åŠŸç‡æ•¸æ“šæ¨¡æ“¬å™¨ - æ¨¡æ“¬ Pico W ç™¼é€åˆ° solar/6002/data\n// æ”¾ç½®ä½ç½®: Injectç¯€é» â†’ [é€™è£¡] â†’ MQTT Out (solar/6002/data)\n// è¼¸å‡ºæ ¼å¼: \"2025_10_13_14_30_0/150/200/180/33.3/20.0\"\n// ====================================================================\n\n// === è¨­å®š ===\nconst DEVICE_ID = \"6002\";  // è¨­å‚™ ID\nconst SIMULATE_REAL_TIME = true;  // true=ä½¿ç”¨ç•¶å‰æ™‚é–“ï¼Œfalse=ä½¿ç”¨å›ºå®šæ™‚é–“\n\n// === å·¥å…·å‡½æ•¸ ===\nconst pad = (num) => String(num).padStart(2, '0');\n\n// === ç”Ÿæˆæ™‚é–“æˆ³ ===\nlet timestamp;\nif (SIMULATE_REAL_TIME) {\n    const now = new Date();\n    timestamp = `${now.getFullYear()}_${now.getMonth() + 1}_${now.getDate()}_${now.getHours()}_${now.getMinutes()}_${now.getSeconds()}`;\n} else {\n    // å›ºå®šæ™‚é–“ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰\n    timestamp = \"2025_10_13_14_30_0\";\n}\n\n// === æ¨¡æ“¬æ—¥é–“ç™¼é›»æ›²ç·š ===\nconst hour = new Date().getHours();\nlet dayFactor = 1;\n\n// 6:00 - 18:00 æ—¥é–“ç™¼é›»ï¼ˆæ­£å¼¦æ›²ç·šï¼‰\nif (hour >= 6 && hour <= 18) {\n    // æ­£åˆæœ€é«˜ï¼ˆhour=12 æ™‚ dayFactor=1ï¼‰\n    dayFactor = Math.sin((hour - 6) * Math.PI / 12);\n} else {\n    // å¤œé–“ä½åŠŸç‡\n    dayFactor = 0.05;\n}\n\n// === ç”ŸæˆåŠŸç‡æ•¸æ“šï¼ˆå¸¶éš¨æ©Ÿæ³¢å‹•ï¼‰===\n// PG: ç™¼é›»åŠŸç‡ (0-200W)\nconst pg = Math.max(0, Math.floor(150 * dayFactor + Math.random() * 50));\n\n// PA: è² è¼‰AåŠŸç‡ï¼ˆé€šå¸¸é«˜æ–¼PGï¼Œè¡¨ç¤ºéœ€è¦é›»æ± è£œå……ï¼‰\nconst pa = Math.max(0, Math.floor(pg * 1.25 + Math.random() * 30));\n\n// PP: è² è¼‰PåŠŸç‡ï¼ˆé€šå¸¸é«˜æ–¼PGï¼‰\nconst pp = Math.max(0, Math.floor(pg * 1.15 + Math.random() * 25));\n\n// === è¨ˆç®—æ•ˆç‡ ===\nlet pag, ppg;\nif (pg > 0) {\n    pag = ((pa - pg) / pg * 100).toFixed(2);\n    ppg = ((pp - pg) / pg * 100).toFixed(2);\n} else {\n    pag = \"0.00\";\n    ppg = \"0.00\";\n}\n\n// ç¢ºä¿æ•ˆç‡ä¸è¶…éåˆç†ç¯„åœ\npag = Math.min(100, Math.max(-100, parseFloat(pag))).toFixed(2);\nppg = Math.min(100, Math.max(-100, parseFloat(ppg))).toFixed(2);\n\n// === çµ„åˆæ•¸æ“š ===\n// æ ¼å¼: \"å¹´_æœˆ_æ—¥_æ™‚_åˆ†_ç§’/pg/pa/pp/pag/ppg\"\nconst payload = `${timestamp}/${pg}/${pa}/${pp}/${pag}/${ppg}`;\n\n// === è¨­å®š MQTT è¨Šæ¯ ===\nmsg.topic = `solar/${DEVICE_ID}/data`;\nmsg.payload = payload;  // æ³¨æ„ï¼šä¸è¦åŠ å¼•è™Ÿï¼\nmsg.qos = 1;\n\n// === æ—¥èªŒè¼¸å‡º ===\nnode.warn(`[Power Sim] è¨­å‚™: ${DEVICE_ID}`);\nnode.warn(`[Power Sim] æ™‚é–“: ${timestamp}`);\nnode.warn(`[Power Sim] åŠŸç‡: PG=${pg}W, PA=${pa}W, PP=${pp}W`);\nnode.warn(`[Power Sim] æ•ˆç‡: PAG=${pag}%, PPG=${ppg}%`);\nnode.warn(`[Power Sim] å®Œæ•´æ•¸æ“š: ${payload}`);\n\n// è¨­å®šç¯€é»ç‹€æ…‹\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `PG:${pg}W æ—¥ç…§:${(dayFactor * 100).toFixed(0)}%`\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 240,
        "wires": [
            [
                "50799a8b3b0b5f95"
            ]
        ]
    },
    {
        "id": "395de1da0aafdb58",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 750,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "160dca464de986f6",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 240,
        "wires": [
            [
                "c4e07c78e9c9ab76"
            ]
        ]
    },
    {
        "id": "50799a8b3b0b5f95",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "MQTT DATA TEST",
        "topic": "solar/6002/data",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 590,
        "y": 240,
        "wires": []
    },
    {
        "id": "4e63fc0483df2653",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "SQLç”Ÿæˆå™¨",
        "func": "// =================================================================\n// å‹•æ…‹ SQL ç”Ÿæˆå™¨ - çµ±ä¸€ç‰ˆï¼ˆç§»é™¤ pizeroï¼‰\n// ç‰ˆæœ¬: V5.0\n// é©ç”¨æ–¼ç¨ç«‹ solar_db è³‡æ–™åº«\n// \n// æ•´åˆæ‰€æœ‰ SQL æ“ä½œï¼š\n// - åŠŸç‡æ•¸æ“šã€GPSã€é…ç½®ã€è¨­å‚™ç‹€æ…‹ã€çµ±è¨ˆ\n// =================================================================\n\n// ç¢ºä¿ msg ç‰©ä»¶å­˜åœ¨\nif (!msg) {\n    msg = {};\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºè³‡æ–™åº«æ“ä½œ\nif (!msg.query_type) {\n    return msg;\n}\n\n// æª¢æŸ¥ params æ˜¯å¦å­˜åœ¨\nif (!msg.params) {\n    msg.params = [];\n}\n\n// æ—¥èªŒè¼¸å‡º\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// è¨­å®šç‹€æ…‹\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog(`[SQL] é¡å‹: ${msg.query_type}, åƒæ•¸: ${JSON.stringify(msg.params)}`);\n\ntry {\n    switch (msg.query_type) {\n        // ========================================\n        // ç³»çµ±ç®¡ç† SQL\n        // ========================================\n        case 'test_connection':\n            msg.query = 'SELECT version(), current_database();';\n            msg.params = [];\n            log('[SQL] æ¸¬è©¦è³‡æ–™åº«é€£ç·š');\n            break;\n\n        case 'list_tables':\n            msg.query = `\n                SELECT table_name \n                FROM information_schema.tables \n                WHERE table_schema = 'public' \n                ORDER BY table_name;\n            `;\n            msg.params = [];\n            log('[SQL] åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨');\n            break;\n\n        // ========================================\n        // åŠŸç‡æ•¸æ“šæ“ä½œ\n        // ========================================\n        case 'insert_power_data':\n            // ç¢ºä¿æœ‰ 7 å€‹åƒæ•¸\n            while (msg.params.length < 7) {\n                msg.params.push(null);\n            }\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                    pg = EXCLUDED.pg,\n                    pa = EXCLUDED.pa,\n                    pp = EXCLUDED.pp,\n                    pga_efficiency = EXCLUDED.pga_efficiency,\n                    pgp_efficiency = EXCLUDED.pgp_efficiency\n                RETURNING id;\n            `;\n            log(`[SQL] æ’å…¥åŠŸç‡æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'batch_insert_power_data':\n            // æ‰¹æ¬¡æ’å…¥\n            if (msg.batch_data && Array.isArray(msg.batch_data) && msg.batch_data.length > 0) {\n                const values = msg.batch_data.map((data, idx) => {\n                    const offset = idx * 7;\n                    return `($${offset + 1}, $${offset + 2}, $${offset + 3}, $${offset + 4}, $${offset + 5}, $${offset + 6}, $${offset + 7})`;\n                }).join(',');\n\n                msg.query = `\n                    INSERT INTO power_data \n                    (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                    VALUES ${values}\n                    ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                        pg = EXCLUDED.pg,\n                        pa = EXCLUDED.pa,\n                        pp = EXCLUDED.pp,\n                        pga_efficiency = EXCLUDED.pga_efficiency,\n                        pgp_efficiency = EXCLUDED.pgp_efficiency\n                    RETURNING id;\n                `;\n                msg.params = msg.batch_data.flat();\n                log(`[SQL] æ‰¹æ¬¡æ’å…¥ ${msg.batch_data.length} ç­†æ•¸æ“š`);\n            } else {\n                log('[SQL] æ‰¹æ¬¡æ’å…¥å¤±æ•—ï¼šç„¡æœ‰æ•ˆæ•¸æ“š');\n                msg.query = null;\n            }\n            break;\n\n        case 'get_latest_data':\n            // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹åƒæ•¸\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            if (msg.params.length < 2) {\n                msg.params.push(10);\n            }\n            msg.query = `\n                SELECT * FROM power_data\n                WHERE device_id = $1\n                ORDER BY timestamp DESC\n                LIMIT $2;\n            `;\n            log(`[SQL] æŸ¥è©¢æœ€æ–°æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'get_data_by_timerange':\n            if (msg.params.length < 3) {\n                log('[SQL] æ™‚é–“ç¯„åœæŸ¥è©¢éœ€è¦ 3 å€‹åƒæ•¸');\n                msg.query = null;\n            } else {\n                msg.query = `\n                    SELECT * FROM power_data\n                    WHERE device_id = $1 \n                    AND timestamp BETWEEN $2 AND $3\n                    ORDER BY timestamp DESC;\n                `;\n                log(`[SQL] æŸ¥è©¢æ™‚é–“ç¯„åœæ•¸æ“š: ${msg.params[0]}`);\n            }\n            break;\n\n        // ========================================\n        // è¨­å‚™ç®¡ç†\n        // ========================================\n        case 'update_device_status':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                UPDATE devices \n                SET last_seen = CURRENT_TIMESTAMP\n                WHERE device_id = $1\n                RETURNING device_id, last_seen;\n            `;\n            log(`[SQL] æ›´æ–°è¨­å‚™ç‹€æ…‹: ${msg.params[0]}`);\n            break;\n\n        case 'upsert_device':\n            while (msg.params.length < 3) {\n                msg.params.push('');\n            }\n            msg.query = `\n                INSERT INTO devices (device_id, device_name, location)\n                VALUES ($1, $2, $3)\n                ON CONFLICT (device_id) \n                DO UPDATE SET \n                    device_name = EXCLUDED.device_name,\n                    location = EXCLUDED.location,\n                    last_seen = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] è¨»å†Š/æ›´æ–°è¨­å‚™: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_devices':\n            msg.query = `\n                SELECT \n                    d.*,\n                    c.factor_a,\n                    c.factor_p,\n                    (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                ORDER BY d.device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹');\n            break;\n\n        // ========================================\n        // é…ç½®ç®¡ç†ï¼ˆç§»é™¤ pizeroï¼‰\n        // ========================================\n        case 'get_config':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    device_id,\n                    factor_a,\n                    factor_p,\n                    updated_at\n                FROM config\n                WHERE device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢é…ç½®: ${msg.params[0]}`);\n            break;\n\n        case 'update_config':\n            // ç¢ºä¿æœ‰ 3 å€‹åƒæ•¸ï¼ˆç§»é™¤ pizero_on, pizero_offï¼‰\n            while (msg.params.length < 3) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else {\n                    msg.params.push(1.0);\n                }\n            }\n            msg.query = `\n                INSERT INTO config \n                (device_id, factor_a, factor_p, updated_at)\n                VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    factor_a = EXCLUDED.factor_a,\n                    factor_p = EXCLUDED.factor_p,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] æ›´æ–°é…ç½®: ${msg.params[0]}`);\n            log(`[SQL]   Factor_A: ${msg.params[1]}`);\n            log(`[SQL]   Factor_P: ${msg.params[2]}`);\n            break;\n\n        case 'get_device_info':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    d.device_id,\n                    d.device_name,\n                    d.location,\n                    d.last_seen,\n                    c.factor_a,\n                    c.factor_p\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                WHERE d.device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢è¨­å‚™å®Œæ•´è³‡è¨Š: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // çµ±è¨ˆæŸ¥è©¢\n        // ========================================\n        case 'get_hourly_stats':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE_TRUNC('hour', timestamp) as hour,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    MAX(pg) as max_pg,\n                    MIN(pg) as min_pg,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '24 hours'\n                GROUP BY hour, device_id\n                ORDER BY hour DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢å°æ™‚çµ±è¨ˆ: ${msg.params[0]}`);\n            break;\n\n        case 'get_daily_summary':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE(timestamp) as date,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    SUM(pg) as total_pg,\n                    AVG(pga_efficiency) as avg_pga_eff,\n                    AVG(pgp_efficiency) as avg_pgp_eff,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '30 days'\n                GROUP BY date, device_id\n                ORDER BY date DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢æ¯æ—¥ç¸½çµ: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // GPS ä½ç½®ç®¡ç†\n        // ========================================\n        case 'upsert_gps_location':\n            while (msg.params.length < 6) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else if (msg.params.length <= 2) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 3) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 4) {\n                    msg.params.push(0);\n                } else {\n                    msg.params.push(new Date().toISOString());\n                }\n            }\n\n            msg.query = `\n                INSERT INTO gps_locations \n                (device_id, latitude, longitude, altitude, satellites, timestamp)\n                VALUES ($1, $2, $3, $4, $5, $6)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    latitude = EXCLUDED.latitude,\n                    longitude = EXCLUDED.longitude,\n                    altitude = EXCLUDED.altitude,\n                    satellites = EXCLUDED.satellites,\n                    timestamp = EXCLUDED.timestamp,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n\n            log(`[SQL] æ’å…¥/æ›´æ–° GPS: ${msg.params[0]} (${msg.params[1]}, ${msg.params[2]})`);\n            break;\n\n        case 'get_gps_location':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                WHERE device_id = $1;\n            `;\n\n            log(`[SQL] æŸ¥è©¢ GPS: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_gps_locations':\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                ORDER BY device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰ GPS');\n            break;\n\n        case 'create_gps_table':\n            msg.query = `\n                CREATE TABLE IF NOT EXISTS gps_locations (\n                    id SERIAL PRIMARY KEY,\n                    device_id VARCHAR(50) NOT NULL,\n                    latitude DOUBLE PRECISION NOT NULL,\n                    longitude DOUBLE PRECISION NOT NULL,\n                    altitude DOUBLE PRECISION DEFAULT 0,\n                    satellites INTEGER DEFAULT 0,\n                    timestamp TIMESTAMP NOT NULL,\n                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    CONSTRAINT unique_device_gps UNIQUE (device_id)\n                );\n                \n                CREATE INDEX IF NOT EXISTS idx_gps_device ON gps_locations(device_id);\n                CREATE INDEX IF NOT EXISTS idx_gps_timestamp ON gps_locations(timestamp DESC);\n            `;\n            msg.params = [];\n            log('[SQL] å»ºç«‹ GPS è¡¨æ ¼');\n            break;\n\n        // ========================================\n        // æ¸¬è©¦æ•¸æ“š\n        // ========================================\n        case 'insert_test_data':\n            const now = new Date();\n            const deviceId = msg.params[0] || '6002';\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                RETURNING *;\n            `;\n            msg.params = [\n                deviceId,\n                now.toISOString(),\n                Math.floor(Math.random() * 50) + 150,\n                Math.floor(Math.random() * 50) + 200,\n                Math.floor(Math.random() * 50) + 180,\n                Math.random() * 20 + 30,\n                Math.random() * 20 + 20\n            ];\n            log('[SQL] æ’å…¥æ¸¬è©¦æ•¸æ“š');\n            break;\n\n        default:\n            log(`[SQL] æœªè™•ç†çš„æŸ¥è©¢é¡å‹: ${msg.query_type}`);\n            msg.query = null;\n            break;\n    }\n\n    // è¨­å®šç‹€æ…‹\n    if (msg.query) {\n        setStatus(\"green\", \"dot\", `SQL: ${msg.query_type}`);\n    } else {\n        setStatus(\"yellow\", \"ring\", \"ç„¡ SQL\");\n    }\n\n} catch (error) {\n    log(`[SQL] éŒ¯èª¤: ${error.message}`);\n    msg.error = error.message;\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n}\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„æŸ¥è©¢é¡å‹æ¸…å–®\n// =================================================================\n//\n// ã€ç³»çµ±ç®¡ç†ã€‘\n//   test_connection, list_tables, create_gps_table\n//\n// ã€åŠŸç‡æ•¸æ“šã€‘\n//   insert_power_data, batch_insert_power_data, \n//   get_latest_data, get_data_by_timerange\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   update_device_status, upsert_device, get_all_devices\n//\n// ã€é…ç½®ç®¡ç†ã€‘ï¼ˆç§»é™¤ pizeroï¼‰\n//   get_config, update_config, get_device_info\n//\n// ã€çµ±è¨ˆæŸ¥è©¢ã€‘\n//   get_hourly_stats, get_daily_summary\n//\n// ã€GPS ä½ç½®ã€‘\n//   upsert_gps_location, get_gps_location, get_all_gps_locations\n//\n// ã€æ¸¬è©¦ã€‘\n//   insert_test_data\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 840,
        "wires": [
            [
                "395de1da0aafdb58"
            ]
        ]
    },
    {
        "id": "fcfafba4b015bc1e",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "page": "",
        "ui": "",
        "name": "ç›£æ§ç•«é¢",
        "order": 1,
        "width": "",
        "height": "",
        "head": "",
        "format": "<template>\n    <div class=\"solar-dash\">\n        <!--é ‚éƒ¨ç‹€æ…‹åˆ— -->\n        <div class=\"status-bar\">\n            <div style=\"display: flex; align-items: center; gap: 10px;\">\n                <!-- ğŸ¨ LOGO åœ–ç‰‡ï¼ˆæ–°å¢ï¼‰-->\n                <img :src=\"logoBase64\" alt=\"SOLARSDGS\" style=\"width: 35px; height: 35px; border-radius: 6px; background: white; padding: 5px; box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);\">\n\n                <!-- è¿”å›ç®¡ç†å“¡æŒ‰éˆ•ï¼ˆåƒ…ç®¡ç†å“¡å¯è¦‹ï¼‰-->\n                <button v-if=\"isAdmin\" @click=\"backToAdmin\"\n                        style=\"padding: 6px 12px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;\"\n                        onmouseover=\"this.style.background='#5568d3'\"\n                        onmouseout=\"this.style.background='#667eea'\">\n                    â† ç®¡ç†å“¡\n                </button>\n\n                <span class=\"status-dot\" :class=\"{on: online}\"></span>\n\n                <!-- è¨­å‚™é¸æ“‡å™¨ -->\n                <select v-model=\"deviceId\" @change=\"switchDevice\"\n                        style=\"padding: 6px 10px; border-radius: 4px; border: 1px solid #ddd; font-weight: 600;\">\n                    <option v-for=\"id in availableDevices\" :key=\"id\" :value=\"id\">\n                        {{getDeviceDisplayName(id)}}\n                    </option>\n                </select>\n\n                <span style=\"opacity: 0.8;\">{{online ? 'ğŸŸ¢ åœ¨ç·š' : 'ğŸ”´ é›¢ç·š'}}</span>\n                <span v-if=\"loading\" style=\"color: #f39c12; font-size: 12px;\">\n                    â³ è¼‰å…¥ä¸­...\n                </span>\n            </div>\n\n            <!-- ç”¨æˆ¶è³‡è¨Šèˆ‡ç™»å‡º -->\n            <div style=\"display: flex; gap: 15px; align-items: center;\">\n                <span style=\"background: #34495e; color: white; padding: 4px 10px; border-radius: 4px; font-size: 13px;\">\n                    {{isAdmin ? 'ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡' : 'ğŸ‘¤ ' + customerName}}\n                </span>\n                <span style=\"opacity: 0.8;\">{{lastUpdate}}</span>\n                <button @click=\"logout\"\n                        style=\"padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;\"\n                        onmouseover=\"this.style.background='#c0392b'\"\n                        onmouseout=\"this.style.background='#e74c3c'\">\n                    ç™»å‡º\n                </button>\n            </div>\n        </div>\n\n        <!-- è¨­å‚™è³‡è¨Šå¡ç‰‡ -->\n        <div class=\"card\" style=\"margin-bottom: 20px; background: #f8f9fa;\">\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;\">\n                <div>\n                    <span style=\"color: #7f8c8d;\">è¨­å‚™ç·¨è™Ÿ</span>\n                    <div style=\"font-size: 20px; font-weight: bold; color: #2c3e50;\">{{deviceId}}</div>\n                </div>\n                <div>\n                    <span style=\"color: #7f8c8d;\">è¨­å‚™åç¨±</span>\n                    <div style=\"font-size: 20px; font-weight: bold; color: #2c3e50;\">{{deviceName}}</div>\n                </div>\n                <div>\n                    <span style=\"color: #7f8c8d;\">ä½ç½®</span>\n                    <div style=\"font-size: 20px; font-weight: bold; color: #2c3e50;\">{{deviceLocation}}</div>\n                </div>\n                <div>\n                    <span style=\"color: #7f8c8d;\">é€£ç·šç‹€æ…‹</span>\n                    <div style=\"font-size: 20px; font-weight: bold; color: #2c3e50;\">\n                        {{connectionStatus}}\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- åŠŸç‡å¡ç‰‡ -->\n        <div class=\"metrics\">\n            <div class=\"card\">\n                <h3>PG ç™¼é›»åŠŸç‡</h3>\n                <div class=\"val\" style=\"color: #3498db;\">{{pg}}</div>\n                <div>W</div>\n            </div>\n            <div class=\"card\">\n                <h3>PA è² è¼‰A</h3>\n                <div class=\"val\" style=\"color: #2ecc71;\">{{pa}}</div>\n                <div>W</div>\n            </div>\n            <div class=\"card\">\n                <h3>PP è² è¼‰P</h3>\n                <div class=\"val\" style=\"color: #e74c3c;\">{{pp}}</div>\n                <div>W</div>\n            </div>\n        </div>\n\n        <!-- æ•ˆç‡å¡ç‰‡ -->\n        <div class=\"eff\">\n            <div class=\"card\">\n                <h3>PAG æ•ˆç‡</h3>\n                <div class=\"val\" style=\"color: #9b59b6;\">{{pag.toFixed(2)}}%</div>\n                <div class=\"bar\">\n                    <div class=\"fill\" :style=\"{\n                        width: Math.max(0, Math.min(100, pag)) + '%',\n                        background: 'linear-gradient(90deg, #9b59b6, #8e44ad)'\n                    }\"></div>\n                </div>\n            </div>\n            <div class=\"card\">\n                <h3>PPG æ•ˆç‡</h3>\n                <div class=\"val\" style=\"color: #f39c12;\">{{ppg.toFixed(2)}}%</div>\n                <div class=\"bar\">\n                    <div class=\"fill\" :style=\"{\n                        width: Math.max(0, Math.min(100, ppg)) + '%',\n                        background: 'linear-gradient(90deg, #f39c12, #e67e22)'\n                    }\"></div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Factor è¨­å®šï¼ˆéœ€æ¬Šé™ï¼‰-->\n        <div v-if=\"showControlPanel\" class=\"card ctrl\">\n            <h3>âš™ï¸ Factor è¨­å®š</h3>\n            <div class=\"factors\">\n                <div class=\"fac-wrap\">\n                    <label>Factor_A</label>\n                    <div style=\"display: flex; gap: 5px; align-items: center;\">\n                        <input type=\"number\"\n                               v-model.number=\"fa\"\n                               :disabled=\"!faUnlock\"\n                               step=\"0.1\"\n                               class=\"fac-input\">\n                        <span @click=\"unlock('A')\"\n                              style=\"cursor: pointer; font-size: 20px; padding: 5px;\">\n                            {{faUnlock ? 'ğŸ”“' : 'ğŸ”’'}}\n                        </span>\n                    </div>\n                </div>\n                <div class=\"fac-wrap\">\n                    <label>Factor_P</label>\n                    <div style=\"display: flex; gap: 5px; align-items: center;\">\n                        <input type=\"number\"\n                               v-model.number=\"fp\"\n                               :disabled=\"!fpUnlock\"\n                               step=\"0.1\"\n                               class=\"fac-input\">\n                        <span @click=\"unlock('P')\"\n                              style=\"cursor: pointer; font-size: 20px; padding: 5px;\">\n                            {{fpUnlock ? 'ğŸ”“' : 'ğŸ”’'}}\n                        </span>\n                    </div>\n                </div>\n            </div>\n            <p class=\"last-update\">æœ€å¾Œæ›´æ–°: {{lastConfigUpdate}}</p>\n        </div>\n\n        <!-- æ§åˆ¶æŒ‰éˆ•ï¼ˆéœ€æ¬Šé™ï¼‰-->\n        <div v-if=\"showControlPanel\" class=\"card ctrl\">\n            <h3>ğŸ® è¨­å‚™æ§åˆ¶</h3>\n            <div class=\"ctrl-buttons\">\n                <button @click=\"sendReboot\" class=\"ctrl-btn ctrl-btn-danger\">\n                    ğŸ”„ é‡å•Ÿè¨­å‚™\n                </button>\n                <button @click=\"sendOTA\" class=\"ctrl-btn ctrl-btn-warning\">\n                    ğŸ“¦ OTA æ›´æ–°\n                </button>\n                <button @click=\"requestGPS\" class=\"ctrl-btn ctrl-btn-info\">\n                    ğŸ“ è«‹æ±‚ GPS\n                </button>\n                <button @click=\"refreshData\" class=\"ctrl-btn ctrl-btn-info\">\n                    ğŸ”ƒ åˆ·æ–°æ•¸æ“š\n                </button>\n            </div>\n        </div>\n\n        <!-- å¯†ç¢¼å°è©±æ¡† -->\n        <div v-if=\"pwd\" class=\"modal\">\n            <div class=\"modal-content\">\n                <h3>è§£é– Factor_{{pwdFor}}</h3>\n                <input type=\"password\"\n                       v-model=\"pwdIn\"\n                       placeholder=\"è«‹è¼¸å…¥å¯†ç¢¼\"\n                       @keyup.enter=\"chkPwd\"\n                       style=\"width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;\">\n                <div style=\"display: flex; gap: 10px; justify-content: flex-end;\">\n                    <button @click=\"pwd = false\" class=\"ctrl-btn\" style=\"background: #95a5a6;\">\n                        å–æ¶ˆ\n                    </button>\n                    <button @click=\"chkPwd\" class=\"ctrl-btn ctrl-btn-info\">\n                        ç¢ºèª\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n    data() {\n        return {\n            // ğŸ¨ åœ¨é€™è£¡è²¼ä¸Šä½ çš„ LOGO Base64 å­—ä¸²\n            logoBase64: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAACCCAYAAACdIYA0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAGHaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8P3hwYWNrZXQgYmVnaW49J++7vycgaWQ9J1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCc/Pg0KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyI+PHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj48dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPjwvcmRmOkRlc2NyaXB0aW9uPjwvcmRmOlJERj48L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9J3cnPz4slJgLAAAeaUlEQVR4Xu2deXxU9bn/398za1ZZRAqIkMgSQUCQRVAJIC6AXpFg/dXqtWip1pbf7c+trVZBr9dWyq9u1VbrbutVrFpr0VouBhIWQRFBEAQiKkJkERKyzHLmnOf+cSYh+c6QGcg2kXm/Xs8ffJ9nDiczn/Ndnu9ylIgIadIcAUMvSJOmIWmBpGmStEDSNElaIGma5PgWiL0TsTeB2LonTZTjVyByADt4E5h/BqV0b5oox6lABAk9jESKQZ0FpAVyJI5LgUjkHyh5AMNzNspzge5O04DjTiBifoiYPwfvIXBNAZWhh6RpwPElENmLhO7GyNiMHR4L7ov0iDQax5FAQhB6CMP3Jggo42KU0VcPSqNx3AhEQs+A+j14BLumH7jO10PSxOG4EIhYy8C+H3yHIAjK9X2U+0w9LE0cvv0CsT9Hgveg/J+DDbbZE9znHxd/ekvwLf+WarGD92O434UQYIFyTU3XHkfBt1YgIhYSehRlPO8UKJBwFringPLr4WmOwLdWIJiLwFqA8tY6tYcLRIaj3CP1yDRN8O0USGQzmP+JytwL1YAXCLtR7svBOEWPTtME3z6ByB7s8J0o3wdQC4gjEJF8lGeiHp0mAd8ygZgQehDD9RpYzj/xgh0yENf3wDhN/0CaBHyrBGKHXkasx8AlTr9DAT5Qko/yzADl1j+SJgHfHoFEiiEyD5VxCALRMjcQAVEXolzp2uNY+FYIRKwd2MF5GJllh/sd4tQedvgklLsI8OgfS5MEHV8gUgPh+RjeEqfmqFs9aDimjGHgGqJ9KE2ydHCB2NihR4DnnH9GGri8IIEMcM1AGSc2cKQ5Gjq0QMT8O0R+h/IFIKg5fWDbg8AzRXOkORo6rkDsTUjoHozsfVCj+TwgIQNlXIhKJ8aaRYcUiNjl2KHbMTLWOeLQdxf7gcjpGL6r0guSm0nHE4iEIPwAhvF3p89haX5X3dD2PHAN1JxpjpYOJxAJvwz2Hx0hhHSvU3vY5qko75Ud8c9LOVRHOv5BIu9B6N9RmducSTj9zg0gA8ScjvL9HpEMlNKrmGaiwLagohI8HvD7oboaIg1HUCmAbdsopejUqRNer1d3J03HEYj9GXbgRxgZS5x8R7zfXUXXfUg+4hqAYKNiVHSMRC9j+OHAXvh/t8HZY2DCePivBVD+tf6B9iUcDnPiiScyd+5chgw59jxQBxFILRK4CeV53JmACyfoe7qdYS4qTi1zLEj0mlGCVTB0OFw+Ha68HC64DHaXN/xAajB06FBee+01Tj31VN2VNB2ikZbw0wjPOT+UmUAcRBNmtTgjnNoWsBCEDsDOz6D8S9iyBYIhME1n33fvnnByD+j5HXC79JtpP84++2z69m3e1o7UF0jkDYj8GsMbPDwJlwx18zEtYZmweh1MvwwunAJXXg27doNlQb+B8NzT8M5b8OQfoEd3/UbaB8MwKCgowOVqnmJTWiBifYwdmovK3O08ye2BODXW1/vhww3w8Sew+VOwbcfnz4WBQ2HQGTBmLGRn6xdoHwYOHMiECRP04qMmdQViH4TQPRj+9fGTYW1JBPqdArO+D1ddATMvdUYvGHBgD/ztr/Dfz8PTz8CBCv3D7cPIkSMZOLD5eaDU7KRKCAneBSxAKdvplCaitaWuIGI4a472lsM5hY5Q/k8RFF0FX+0CUakz3J07dy7z5s3Ti4+a1v5ajwkJv4iyH0V5khSH18l/4G9FywB3Brg8kJ0FhgEuN3i9ELHBtFJHHD179uTcc8/Vi4+J1KtBIu8hwQbJsKZQTmrdtnqj3OeAeJG4CZKWw/DBwf3wn7+BkSNg7Cj4/eOwdz8opVBJnFZk286ilWTjDcMgFAqxfPlydu7cqbtjGDt2LK+++io9evTQXUdNagnEKkOC16Eyljmd0kRHh3lAbBfKdR/4f4KI0XKJsSOhQASCQXC5wO2GcAhsAY/Hk3DUYNs24bBTLSYTLyLYts327dv5/ve/z7p16/SQGK6//noeeughfD6f7jpqUkcgUoNd+zMM35NOHiOZpiULJHA6ZCxMiTWnGzZsYP369bjd7rg1QzgcpkePHkyYMAGPx8O2bdtYs2YNSikMI7a1N02Tzp07M2XKFFasWMGMGTP45ptv9LBGdOnShWeffZZLLrlEdx0bkiJYgd+JVeMVCSFSgUhlAqtFJIDYgbtExNYv1+YcPHhQioqKxOPxiN/vjzGfzycej0eKioqkqqpKwuGw/PCHPxSv1ys+ny8m3u/3i8fjkYEDB8r27dvlqaeeEpfLpWdoYmz48OGyY8cO/faOmVjZtgNivoqy7sfwhZ2VYbEPXyxesM08cF+c5AdalzVr1lBcXIxpmgSDwRgLhUKYpkmvXr3Izs6mrKyMZcuWEQ6HCYVCMfHBYBDTNOnduzc+n48VK1ZgWYn7V/n5+XTp0kUvPmbaXSASWY+E70Fl7Uk+GeaKTtYZ08E1XPe2OSLCihUrOHDggO5qhN/vZ8SIEQCsWrWKL774Qg+J4aKLLuLQoUMsX75cd8WQmZnJ1KlTyc3N1V3HTLsKRGQ/hO/FyNjgiCPZ3pAP7Eg3lPcSVApshtq7dy8lJSV6cQz9+vXjnHPOwbZtli5dWt9ZPRJ9+vThwgsvZN26dXz22We6O4bevXszZswYvbhZtJtARIJI6NdgvOZ0SBvmEKLD17gtR3RKHyamzE79jz/+mI0bN+rFMYwaNYr8/HzKyspYs2aN7o5hwoQJ9OrVi7fffptIEkmW3r17061bN724WbSbQAj9GSKPo9xaMkwBbhe2dEfIaeCI4gU7dAK4rwAVx98OlJSUJBxd5ObmMm3aNJRSLF++PGGN4PF4OO+889i2bRvvvvuu7o5BKcWECRM48cSW3eLRPgKJrETs+zAyaxr3O5TTfEhkGMpzLRi5Tk3SEA+g+qLcwzRH+7Bnzx5WrlxJomzB0KFDKSwsJBKJJNW85OXlMXr0aJYvX055eeLFJtnZ2Zx++ulxh8vNoc3zIGLtAOs6lKfYmYRrmAzLiJ4C5HkWjK5I6LsY7v2N1556QazvoNxXguqNSLyFqa2PAvD5eOsfn3LlVf9NZWWlHtKIX/7yl9x3332UlZVx6aWXsmnTJj2kEddddx133XUXP/7xj3nrrbd0dwyjRo3iL3/5C/3799ddzUMf97Ymll0lEfMHIuIRqdLyGlWImIhVc42IHRKJbBa7qr+IGScHUuXkQexa1W4mISUiSh5ZEJuL0K1z587y9ttvi4jIkiVLpFu3bjExuj366KPy/vvvS+/evWN8uhmGIbfffrtYlqV/5c2mZeujJhBskKdwuf8BVWbsmtJMsIODUL6bQXlB2agjbbi2HVNI+5gIeIXKPcJfX9NvLpaBAwcyYsQIRITi4mL27dunhzTC5/ORl5fHrl272L9/v+6Owev1MmTIkBZvXmjLJsaO/BXDfQvUfhG7bNAPRDIR10Mo3w+dMmsjUns5KmNL8vmRtiQTtm2En90K31RAph+qA1lk544kMzMby7IQEUKhEDNmzGDOnDmYpsn8+fNZvHgxfr8/bjo+EAgwfPhwbr31Vh544AEWLFigh8Rw6qmn8vLLL3PmmS1/emPbCMRajx24GiPj49h8h6suK/oDVMYjKOUsyRJrAypwOfi3pp5ApO5YKzhwCAwXKJVNbfB2fBmz8fn89VlP0zTJzMwkMzMTogIIhUJxxaGUIhwOk5ubS3l5OZdddllSk3M/+tGPePjhh1tkck6n5eskDbH3Y4fudsQR0MSB0zG1gv1Qvv+oF4eDFxF/g3+nEC4IBuDzcgiGIWRCTc1ZeH2XYhguamtr69Pnubm5ZGZmYlkWe/fupaKiAtM0CYfDjSwUClFbW0t2djZer5fVq1ezbds2/X+OweVyMWLEiFYRB61fg0SQwD0odR8oK3YnnA/E8oDrXpTvtkYukUokMAvD93p8YbUmif6vHHjrVfjFXKepdBngdvclK7dPfdNiWRZZWVnceeedFBYW8sknn3DHHXewe/duPJ7YvlVdjXPbbbdx6aWXMmfOHB577DE9LIYePXrw/PPPM3nyZN2VGKkA1UkvbYzea21J7NCTYld3EgnHGYlUIxJBrJrpIvY+/aMidlCsmitExImTcBuZ6cwSy6E49xydRbZqkBuujR1N6Jafny8bNmwQEZHHH388xq9bTk6OLFu2TLZs2SIDBgyI8ceziy++WPbti/P9JYOVeNa31ZoYsUqQ8K9RGRXxtyv4wQ70RXl+BipO9k+5UUYB1PbBru6DHchvG6vpjx3ui+CNn+r3QvlOKF2hO2KZOHEip512GqFQiNLSUt0dQ2FhIaNGjWL58uWUlZXp7rj069ePrl276sVJkrhz1zpNjL0Tqf0BKvPd+CvD6puW+1C+WzRnA2QfEvkCZaANe1oJUaCyEfMViPwa5alp3Cwqp3l55XmY9WOoaeL79fv9PPHEE1x99dV8/PHHzJw5k61bt+phjZg3bx633nors2bNYuHChbo7hk6dOvHkk09SVFSku5LDWguuBCMfvUppPpVi1VzrLOipjVNFVzvHqNvVl4pYe/UPtz/WVrFrCkWC0YRcw3uvceYYr58VW9XrNmzYMNm6dauIiDzxxBPi8XhiYhqaz+eTV155RbZv3y79+/eP8cezSZMmye7du/W/IHki7+slMbR4EyOhJ1DqBWf4aupeJ38gwb7guwWMlp15bDb2fiTwC5R/mZPIi1Pzfb4dVn+glcdh8ODB9OnTB9M0KSkpwTTjfRmH6du3L8OHD6esrIy9e/fq7rj079+fk046SS9OHpV45NOiApHwIpT5/1FeM/bMMJx+h4Q94LoR5T5b97YvYmKHHkS533CErc+uR5cgrF3vYuNmzReH/Px8vF4vH374YVL9j7POOou+ffuyZs0aDh06pLtj8Pl8DBkyJOGi56ZJnEZoOYFY6yDyK8j8On7fxwAMhVhFKO/1bdOnOAok9CxKHgUjznBcovmaQA7LSrsSiTR97126dGHs2LEAFBcX8+WXX+ohjfD5fFx44YXU1taydOnShDPDAIMGDeKCC5r5SleVeFtEiwhErD3Y4btRmR85NYdeNRPNlgZPQXlnO+s4pLptzK4CquJUCQ2IFIPVxIgrE3CdyL79P+GjjflRxRyZQYMGMWbMGCorK1m2bFnCH3zYsGFMnjyZ9evXJ5U5BSgoKODkk0/Wi4+ORonJ+DR/FCMmEpyHcv3GOQtBf/rq8IBl9kC5xyN4UU39YC2EUiBSC8YADP/NQJyt99Zm7OAPMDLWxN8D7AE8Brhv4q23zmH27BvZvXu3FtSYO++8k3vuuYfi4mJmzpyZcK3qzTffzIIFC5g3bx5333237o7B5XIxd+5c7rjjjlaZoGuE3ms9asyXxAp0dpJZ+ohFt0M42xoibWTimLOEoEa/cxH7kNjVVzvJsZo491sdvUbw30Rkj8yfP1/8fr9kZ2dLTk5OjGVkZMiAAQNk5cqVIiLy7LPPSufOnSUzMzMmti6+R48esnjxYvn6669l1KhRMSOVeNarVy8pLS3V/5pWoVk1iERKEfN6jIzNTi2e6Er160nbiAyQ8AkozzPgvqyxT0wk9DuUfRe4o9stGqKcjVl28HSMjGdAjeTDDz/ks88+w+2OXSitlMI0zfr+R0ZGBl999RVr167FsqyYJ70uPjs7m0mTJvH6668za9YsAoF4bVxjxowZw8svv0yfPn10V8ujKyZprC/ErpnkPGF6viBVzEas6tPEjnyq373YoZfEqmmi5osgdqCb2KHX9Y+2OOFwWGbPnh1TU8QzpZT84he/ENM09cu0CsdWg0gAO3ATyvNHVOQI+Y72xlW3PWIWhu/3oJzpdgCx1iLBazCyNsWv+TIAOxPhXpTvPwCDVatWUVpaimEYcYeWoVCI7t27M336dDp37symTZv45z//iW3bcWucutqjqKiI2tpaLrvsMtavX6+HxdCtWzf+/Oc/N38Ekyy6YhJjiwQXiF2b6Uxu6U9eqpiJWNU9xAr/s/HtW7vErv03ESvax9A/V4vYYSV27Q31/ZbKykopKiqqf4INw4gxQAoKCmTr1q1iWZbcdNNN9U+9HlsX37lzZ1mxYoW899570qVLl5jaIp4NHjxYtm3b1vhvakWOugss4X8g5v0oX238IWEqoJxTCZUxFMPdYCORBJHQfSjP352tFvqyR1e03xKZhvLdWV/rbNq0qX4fi0R32+tGNLN58skns2/fvkY74fTYuvghQ4ZQUFDAhg0bkkqOAYwePZpevXrpxa3G0QnEeh+s21HZ+5xcR0Y7W2bUvFrnt35r5umgTogW2kjoUVDPOs+ivuvAcK5pVw9DeeeC0bPetWrVqoRDW5fLxeTJk8nIyKC8vJw9e/boIY0wDIPp06eTm5vL4sWLk9oYlZOTw5QpU8jIyNBdrUbSAhG7Ggk/j0S+wKrpjh3ogR1sZwv0wA72wjZPAnE5IpG6zVVdUK4Jh5UTeQus36J8NfFrvkyQ4Eko7z0o1+Ede5WVlZSWlibcOF1QUFC/aGf16tUJBfKd73yHiRMnsnXrVt5//33dHZeTTjqJAQMG6MWtylF0UgNgfeS84elIq83bGFEGCj+2uQjM+zHcQSdhmgkSmonKfArIdZJhgR9gZK2Jf4R3JkjoBJTnPvDe0Oi5WbVqFVdccUXCk31uuOEGHn30USKRCLNmzeLFF1/UQxpx8cUX88orr/D8889z4403JhQgwCWXXMLTTz/d4rvnmkTvlHRErMD/FQkqp9MZQOxav9ihpxynvUfsmplOhzpeMiyASNAQq/Y2Ebvx0NG2bfntb3+b8FyOrKwsefHFF0VEZN26dQlXgxmGIQ8//LBUVVXJ1KlTY/zxTCkl8+fPb3R/bUHSTUzKYq1CRV53XoUaifZHrG5gDHf6HeEHUa5XnT6T3sy7ncrQtr6LkXFLzGtTq6urWbNmTcKnu1+/fpx11lkQbV4S7bvNyclh6NChbNq0iffee093xyU7O7tZR2ofKx1bIGIi5kKUe6czBxT9a0SdCa5BSPgF4PdgRN+j25Bop1SCo50RC7FrUw4ePJiwaSF6aFzv3r0JBAIsW7YsYYfzlFNOoXv37ixZsiThPE0dw4cPb/GjHZKhgwtkO5hvR2uNaOe0thOG9waUvREx56G8VfE7pdlgB3qjvL9BuQbpXgA2btyYcJmgYRgMHToUt9vNtm3bWL16tR4Sw7hx48jOzk5q134dEydObNPhbR0dWCCCmIvA+Oxw7WAA7n7Y4sMO3YuR+Xn8ozQzwa7JAfdd4JmoeyGa6Vy0aFHCJzwnJ4f8/HwA3nnnnYTNi1KKiRMnUlFRkdS+F6JHQeTl5enFbULHFYi9F+w3UFnm4b5FyEBRgNiPoay/x+7iI9pHiSiU60YM7yzNeZiDBw9SUVFBXl4eBQUFcS0vL49LLrmEkSNHEolEKC8vp2/fvjFxDeOnTJlCYWEhn376acI9unXU7e1tD45imJtaSHghmLNRnkMNZmL94D4NPF9C6JvYhUvR98jYoe9hZDwC6sjbBUzT5MsvvyQUCsWdeyF6rGWXLl3qq/6dO3dSVVXVZHznzp3p3r07c+bM4fHHH9dD4vLTn/6UBx988IjXbVX0YU2HwKoQq3qGMxPbaCbZiB3G1tmhuuMlzhLb2qxfMQbTNMW2kz9e0zTNpI9f2Lx5swwePDhmKBvPDMOQRx55RL9Em9EhaxAxSyD0PZT/KF4TkgUSOAXlewY8k3RvI7Zs2cIf//hHDh48eMRtkm63m1mzZjFu3DjKysp47LHH2L9//xHjAWbOnMm0adN46aWXuPbaa5Na+3HKKafwwgsvMH78eN3VAljReYkm0BWT+oTFDs5xVqbFm42NZyZiV58gduhJ/WJxmT9/fsyTrFv37t1l+fLlIiLyhz/8QZRSMTG6vfDCC2KaplxzzTUxviPZ1KlT5eDBg/ottgx2WC+JoeN1Uu0ysN89PLRNhBck4gLXT1Cea3RvDHVzL4k499xzOfPMMwkGg0mtRO/ZsydnnHEGn376KcXFxbr7iBQUFJCT036H9XUsgYhgm2+C2hq7RFBHoiMWH9jWFdGTi2IX7uhs2rSJjz76SC+OYdiwYfj9frZt28batWt1dwxnnnkm/fr1o6SkhK+++kp3x6V79+5cdNFF7dM5jdKhBCJyABVZgvKbiVex1R1MEzgHw/8rUMkdT71y5Up27dqlFzciIyOj/m1OK1asYMeOHXpIDBdccAFKKRYvXly/HiQRBQUFDB06VC9uUzqUQLDWYMuHTt6jqRpdOZlSCQ1GeX+X9JsgKioqKCkpSfgDDhgwgNGjR9cfaZlorqZPnz4UFhZSXl6e8HTDhuTl5dGpU4LzO1qZjiMQMSHyGq6sfbHzKjqZILXdUJ67UO5RuveIrF69mlWrVunFMYwbN44+ffqwZcsWPvgg8Ubd8ePHc/rpp7Nly5akk2NZWVlMnjy51U4OSpaOIxBrI2ItdWqOph5YP0jEC8Yt4L5c9x4REWHp0qUJTxXMzs7mvPPOA6C0tDThtkqv18v555+PUoqSkhIqKpJ76+HAgQMZN26cXtzmdBCBCFhvoDxlTXdOo0sPxZ6F8h3d/t/du3cnNXoZOXIkEyZMwDRNli5dmnDXfn5+PuPGjePAgQOUlpYmHO3UkZeX1+LnrsegYnM2Oh1DILIL21qM8sqRaw8j+oqyyGQM3y8brEVNjrVr1yZ1IH9hYSFdu3ZttJC5KcaOHUt+fj4ffPBBUtcnWuuMGzeOrKws3dXmdAyBhN9G8aHT94j3AEZ3wUlwEHh/DcbR7TizLIslS5YkPE67a9eu9RnNkpISPv/8cz2kEYZhcPbZZ6OU4p133km6eenatSujR4+Oe1RmW5PyqXaRSghchcr8R/xNTkSHs1Y+yvsgynNs72pbtGgRGzdubPJ9c3379qWoqAiPx8OKFStYvnw5LpcrZlslUdH5/X6++93vEgqFmDp1atIjmHHjxvHiiy+2zdbKBKS+QMw3ITQL5f0mfv8j2rRY5pUYmfNBDOdlzEeL4Y1O9wIIoWDjM8iUUkj05GTbtvF4PHg8niP2KepEZlkWCxcu5OabbyYYjPcHNKZu5/6vfvWruEJta1JcICYSvBHledJZFRbvd49uCBfpCa5TnYPo4gY2jVKGcyEPWAIPPgBvvt04pm7TlBMf/02VDan7gXfs2JHU68eIHj6zcOHC+pFSu6NPzqQUkbViVZ0a/40PutU6h+M126JHRvxkduzEWVvYoEGD5JNPPtG/iXaj6UegXREk8jqGqyxxYozoBvJqnENgjtaqo1YFBCFcCwlGr63GpEmT2m15YTxSVyDWZsR8I/lZ2zpinskEhjOhh/+web1gHX0r1Wyys7OZMGECfn/iw+XaipQViJjvYLg2xe6hbUmUI4RDlVBxACoPQtV+qPgGPG7IyoDcHDghBzqdAK39u5144onNP3eshUnJTqrYe5HANRi+f7buQf5ZsH0L3PpzqDzkiELEEc6Fk2HYsOi/AZ8X3ngTHvoDJJibO2ZmzpzJn/70p3afoGtIStYgEvkfFKVO09Ja4sBZEnCgEt58C4pL4V/FsHgpLC6Gzp1g8jQ4/2LHxl8AI0ZAgoFLszjjjDNSShykZA0iQezADRi+5448tG0p/PD1LnjuBThUBW63U3soBcp2Hp/oKBqPD1a+B4vegQSrAY6Jbt268cwzzzBt2jTd1a6knEAk8i6ErkJ5yuMnxloaIzrJR1QJLrBMuOF6ePI5LbYVmTZtGs8991wz3tzQOrRihXksCIT/hfKWJ14x1lLY0SGyiTOcjvYv2jqHOWzYsJQTByknEGsTYr/t3JV9+IluddOGviKt29fQ8fv9bX4wTLK04deQGNtcjDI+Plx7eKLVf2ubr0EuxAtuj/OiwrZiyJAhFBYW6sUpQer0QWQPErgG5XvH6Xt4QUJDUe7zEVEgrTS21FAuMAX+9jdYlXi5R7MQESKRCOPHj6eoqCjh3E57kDICkfBfEHM2hjcARvSdMt7HUJ6LogGtMHQ4AoLTzLTVN9Oe2xoSkSICMbFrf4zhe8qZmQ1modwPgHe2HpimjUmJOk0iG8FaBi6QsIEYc8Dz73pYmnYgNQRi/gvldQ5eEXsGhu+WpF6Xlab1aX+BWF+C9SrKZyM1ozD8/9XkuR1p2pYUEMibGJnvI4G+4L0XjNTMBxyvtKtARPYhrpeQUBbKdT/K00ZvMEiTNO0nEAEl/4MydgI/B88MPSJNCtCOw9wqJHAdiEL5/wRGrh6QJgVoP4FIOWK+jnIVgmuw7k2TIrSfQOrPcEi8PzRN+9GOAknTEWi/TmqaDkFaIGmaJC2QNE2SFkiaJkkLJE2TpAWSpknSAknTJGmBpGmStEDSNMn/AoNzl/ise38bAAAAAElFTkSuQmCC',\n            \n            deviceId: '6002',\n            deviceName: 'è¨­å‚™ 6002',\n            deviceLocation: 'æœªè¨­å®š',\n            connectionStatus: 'æª¢æŸ¥ä¸­',\n            pg: 0,\n            pa: 0,\n            pp: 0,\n            pag: 0,\n            ppg: 0,\n            online: false,\n            lastUpdate: '--:--',\n            loading: false,\n            currentCustomer: '',\n            customerName: '',\n            isAdmin: false,\n            availableDevices: [],\n            allDevices: ['6001', '6002', '6003', '6004', '6005', '6006'],\n            fa: 1.0,\n            fp: 1.0,\n            faUnlock: false,\n            fpUnlock: false,\n            pwd: false,\n            pwdIn: '',\n            pwdFor: '',\n            configLoaded: false,\n            lastConfigUpdate: '--:--',\n            configUpdateTimer: null,\n            isInitialized: false,\n            messageCount: 0,\n            deviceConfigs: {},\n            dataRefreshTimer: null,\n            unlockTimers: {}\n        }\n    },\n    \n    computed: {\n        showControlPanel() {\n            return this.isAdmin || this.deviceId.startsWith(this.currentCustomer);\n        }\n    },\n    \n    mounted() {\n        console.log('ğŸš€ å¤ªé™½èƒ½ç›£æ§ Dashboard åˆå§‹åŒ–...');\n        \n        const customer = localStorage.getItem('solar_customer');\n        const loginTime = localStorage.getItem('solar_login_time');\n        const customerName = localStorage.getItem('solar_customer_name');\n        \n        if (!customer || !loginTime) {\n            console.log('âŒ æœªç™»å…¥ï¼Œè·³è½‰åˆ°ç™»å…¥é ');\n            window.location.href = '/dashboard/login';\n            return;\n        }\n        \n        const elapsed = Date.now() - parseInt(loginTime);\n        if (elapsed > 8 * 60 * 60 * 1000) {\n            console.log('â° ç™»å…¥å·²éæœŸ');\n            alert('ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥');\n            this.logout();\n            return;\n        }\n        \n        this.currentCustomer = customer;\n        this.customerName = customerName || 'æœªçŸ¥å®¢æˆ¶';\n        this.isAdmin = (customer === 'admin');\n        \n        console.log(`ğŸ¢ å®¢æˆ¶ç™»å…¥: ${this.customerName} (${customer})`);\n        console.log(`ğŸ‘¤ æ¬Šé™: ${this.isAdmin ? 'ç®¡ç†å“¡' : 'ä¸€èˆ¬å®¢æˆ¶'}`);\n        \n        if (this.isAdmin) {\n            this.availableDevices = [...this.allDevices];\n            console.log('ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡æ¨¡å¼ï¼šå¯æŸ¥çœ‹æ‰€æœ‰è¨­å‚™');\n        } else {\n            this.availableDevices = this.allDevices.filter(d => \n                d.startsWith(customer)\n            );\n            console.log(`ğŸ” å®¢æˆ¶æ¨¡å¼ï¼šåªèƒ½æŸ¥çœ‹ ${customer} é–‹é ­çš„è¨­å‚™`);\n        }\n        \n        const urlParams = new URLSearchParams(window.location.search);\n        const deviceFromUrl = urlParams.get('device');\n        \n        if (deviceFromUrl && this.availableDevices.includes(deviceFromUrl)) {\n            this.deviceId = deviceFromUrl;\n            console.log('ğŸ“± å¾ URL è¼‰å…¥è¨­å‚™:', this.deviceId);\n        } else if (!this.availableDevices.includes(this.deviceId)) {\n            this.deviceId = this.availableDevices[0] || '6002';\n            console.log('ğŸ“± ä½¿ç”¨é è¨­è¨­å‚™:', this.deviceId);\n        }\n        \n        this.initializeDevice();\n        \n        this.dataRefreshTimer = setInterval(() => {\n            this.refreshData();\n        }, 30000);\n        \n        setInterval(() => {\n            localStorage.setItem('solar_login_time', Date.now());\n            console.log('ğŸ”„ Session å·²æ›´æ–°');\n        }, 30 * 60 * 1000);\n    },\n    \n    watch: {\n        msg: {\n            handler(msg) {\n                if (!msg || !msg.payload) return;\n                \n                const data = msg.payload;\n                this.messageCount++;\n                \n                console.log(`ğŸ“¥ [${this.messageCount}] æ”¶åˆ°è¨Šæ¯:`, data.type || 'unknown', \n                           'for device:', data.device_id || 'unknown');\n                \n                if (data.device_id && data.device_id !== this.deviceId) {\n                    console.log(`â­ï¸ å¿½ç•¥å…¶ä»–è¨­å‚™ ${data.device_id} çš„æ•¸æ“šï¼ˆç•¶å‰: ${this.deviceId}ï¼‰`);\n                    return;\n                }\n                \n                if (data.type === 'config') {\n                    this.handleConfigData(data);\n                    return;\n                }\n                \n                if (data.type === 'realtime') {\n                    this.handlePowerData(data);\n                    return;\n                }\n                \n                if (data.type === 'device_info') {\n                    this.handleDeviceInfo(data);\n                    return;\n                }\n            },\n            deep: true\n        },\n        \n        fa(newVal, oldVal) {\n            if (this.faUnlock && this.isInitialized && this.configLoaded) {\n                console.log(`ğŸ“ [${this.deviceId}] Factor_A è®Šæ›´: ${oldVal} â†’ ${newVal}`);\n                this.scheduleConfigUpdate();\n            }\n        },\n        \n        fp(newVal, oldVal) {\n            if (this.fpUnlock && this.isInitialized && this.configLoaded) {\n                console.log(`ğŸ“ [${this.deviceId}] Factor_P è®Šæ›´: ${oldVal} â†’ ${newVal}`);\n                this.scheduleConfigUpdate();\n            }\n        }\n    },\n    \n    methods: {\n        backToAdmin() {\n            console.log('ğŸ”™ è¿”å›ç®¡ç†å“¡é é¢');\n            window.location.href = '/dashboard/admin';\n        },\n        \n        logout() {\n            if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {\n                localStorage.removeItem('solar_customer');\n                localStorage.removeItem('solar_customer_name');\n                localStorage.removeItem('solar_devices');\n                localStorage.removeItem('solar_login_time');\n                localStorage.removeItem('solar_is_admin');\n                window.location.href = '/dashboard/login';\n            }\n        },\n        \n        initializeDevice() {\n            console.log(`ğŸ¯ åˆå§‹åŒ–è¨­å‚™ ${this.deviceId}`);\n            this.resetData();\n            this.loadConfig();\n            this.loadLatestData();\n            this.loadDeviceInfo();\n            setTimeout(() => {\n                this.isInitialized = true;\n                console.log(`âœ… è¨­å‚™ ${this.deviceId} åˆå§‹åŒ–å®Œæˆ`);\n            }, 2000);\n        },\n        \n        updateUrl() {\n            const newUrl = new URL(window.location);\n            newUrl.searchParams.set('device', this.deviceId);\n            window.history.pushState({}, '', newUrl);\n        },\n        \n        getDeviceDisplayName(id) {\n            return `è¨­å‚™ ${id}`;\n        },\n        \n        switchDevice() {\n            console.log(`ğŸ”„ åˆ‡æ›è¨­å‚™: ${this.deviceId}`);\n            this.updateUrl();\n            this.initializeDevice();\n        },\n        \n        resetData() {\n            this.pg = 0;\n            this.pa = 0;\n            this.pp = 0;\n            this.pag = 0;\n            this.ppg = 0;\n            this.online = false;\n            this.lastUpdate = '--:--';\n            this.configLoaded = false;\n            this.faUnlock = false;\n            this.fpUnlock = false;\n            \n            if (this.unlockTimers) {\n                if (this.unlockTimers.A) clearTimeout(this.unlockTimers.A);\n                if (this.unlockTimers.P) clearTimeout(this.unlockTimers.P);\n            }\n        },\n        \n        loadConfig() {\n            if (this.deviceConfigs[this.deviceId]) {\n                const cached = this.deviceConfigs[this.deviceId];\n                console.log(`ğŸ“¦ ä½¿ç”¨å¿«å–é…ç½® ${this.deviceId}:`, cached);\n                this.fa = cached.fa;\n                this.fp = cached.fp;\n                this.configLoaded = true;\n            } else {\n                this.fa = 1.0;\n                this.fp = 1.0;\n            }\n            \n            console.log(`ğŸ”„ è«‹æ±‚è¼‰å…¥è¨­å‚™ ${this.deviceId} çš„é…ç½®`);\n            this.send({\n                payload: {\n                    action: 'get_config',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        loadLatestData() {\n            console.log(`ğŸ“Š è«‹æ±‚è¨­å‚™ ${this.deviceId} çš„æœ€æ–°æ•¸æ“š`);\n            this.send({\n                payload: {\n                    action: 'get_latest',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        loadDeviceInfo() {\n            console.log(`â„¹ï¸ è«‹æ±‚è¨­å‚™ ${this.deviceId} çš„è³‡è¨Š`);\n            this.send({\n                payload: {\n                    action: 'get_device_info',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        refreshData() {\n            console.log(`ğŸ”„ åˆ·æ–°è¨­å‚™ ${this.deviceId} çš„æ•¸æ“š`);\n            this.loadLatestData();\n        },\n        \n        handleConfigData(data) {\n            console.log(`âš™ï¸ [${this.deviceId}] æ”¶åˆ°é…ç½®:`, data);\n            this.fa = data.factor_a || 1.0;\n            this.fp = data.factor_p || 1.0;\n            this.configLoaded = true;\n            \n            this.deviceConfigs[this.deviceId] = {\n                fa: this.fa,\n                fp: this.fp\n            };\n            \n            this.lastConfigUpdate = new Date().toLocaleTimeString('zh-TW');\n        },\n        \n        handlePowerData(data) {\n            console.log(`ğŸ“Š [${this.deviceId}] æ”¶åˆ°åŠŸç‡æ•¸æ“š:`, data);\n            this.pg = data.pg || 0;\n            this.pa = data.pa || 0;\n            this.pp = data.pp || 0;\n            this.pag = data.pag || 0;\n            this.ppg = data.ppg || 0;\n            this.online = data.online !== false;\n            this.lastUpdate = data.lastUpdate || new Date().toLocaleTimeString('zh-TW');\n            this.connectionStatus = this.online ? 'âœ… é€£ç·šæ­£å¸¸' : 'âŒ é€£ç·šä¸­æ–·';\n        },\n        \n        handleDeviceInfo(data) {\n            this.deviceName = data.device_name || `è¨­å‚™ ${this.deviceId}`;\n            this.deviceLocation = data.location || 'æœªè¨­å®šä½ç½®';\n            console.log(`â„¹ï¸ [${this.deviceId}] è¨­å‚™è³‡è¨Šå·²æ›´æ–°`);\n        },\n        \n        scheduleConfigUpdate() {\n            if (!this.configLoaded || !this.isInitialized) {\n                console.log('âš ï¸ ç³»çµ±æœªå°±ç·’');\n                return;\n            }\n            \n            clearTimeout(this.configUpdateTimer);\n            \n            this.configUpdateTimer = setTimeout(() => {\n                console.log(`ğŸ”§ ç™¼é€è¨­å‚™ ${this.deviceId} çš„é…ç½®æ›´æ–°`);\n                \n                this.send({\n                    payload: {\n                        action: 'update_config',\n                        deviceId: this.deviceId,\n                        device_id: this.deviceId,\n                        factor_a: this.fa,\n                        factor_p: this.fp\n                    }\n                });\n                \n                this.deviceConfigs[this.deviceId] = {\n                    fa: this.fa,\n                    fp: this.fp\n                };\n                \n                this.lastConfigUpdate = new Date().toLocaleTimeString('zh-TW');\n            }, 1000);\n        },\n        \n        sendReboot() {\n            if (!confirm(`ç¢ºå®šè¦é‡å•Ÿè¨­å‚™ ${this.deviceId} å—ï¼Ÿ`)) return;\n            \n            console.log(`ğŸ”„ ç™¼é€é‡å•ŸæŒ‡ä»¤åˆ°è¨­å‚™ ${this.deviceId}`);\n            this.send({\n                payload: {\n                    action: 'reboot',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        sendOTA() {\n            if (!confirm(`ç¢ºå®šè¦å°è¨­å‚™ ${this.deviceId} åŸ·è¡Œ OTA æ›´æ–°å—ï¼Ÿ`)) return;\n            \n            console.log(`ğŸ“¡ ç™¼é€ OTA æŒ‡ä»¤åˆ°è¨­å‚™ ${this.deviceId}`);\n            this.send({\n                payload: {\n                    action: 'ota',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        requestGPS() {\n            console.log(`ğŸ“ è«‹æ±‚è¨­å‚™ ${this.deviceId} çš„ GPS å®šä½`);\n            this.send({\n                payload: {\n                    action: 'request_gps',\n                    deviceId: this.deviceId,\n                    device_id: this.deviceId\n                }\n            });\n        },\n        \n        unlock(type) {\n            this.pwdFor = type;\n            this.pwd = true;\n            this.pwdIn = '';\n        },\n        \n        chkPwd() {\n            if (this.pwdIn === '82767419') {\n                console.log(`âœ… è§£é–è¨­å‚™ ${this.deviceId} çš„ Factor_${this.pwdFor}`);\n                \n                if (!this.unlockTimers) this.unlockTimers = {};\n                \n                if (this.unlockTimers[this.pwdFor]) {\n                    clearTimeout(this.unlockTimers[this.pwdFor]);\n                }\n                \n                if (this.pwdFor === 'A') {\n                    this.faUnlock = true;\n                    this.unlockTimers.A = setTimeout(() => {\n                        this.faUnlock = false;\n                        console.log(`ğŸ”’ è¨­å‚™ ${this.deviceId} Factor_A å·²è‡ªå‹•é–å®š`);\n                    }, 30000);\n                } else if (this.pwdFor === 'P') {\n                    this.fpUnlock = true;\n                    this.unlockTimers.P = setTimeout(() => {\n                        this.fpUnlock = false;\n                        console.log(`ğŸ”’ è¨­å‚™ ${this.deviceId} Factor_P å·²è‡ªå‹•é–å®š`);\n                    }, 30000);\n                }\n                \n                this.pwd = false;\n                this.pwdIn = '';\n            } else {\n                alert('âŒ å¯†ç¢¼éŒ¯èª¤ï¼');\n                this.pwdIn = '';\n            }\n        }\n    },\n    \n    beforeUnmount() {\n        clearTimeout(this.configUpdateTimer);\n        clearInterval(this.dataRefreshTimer);\n        if (this.unlockTimers) {\n            if (this.unlockTimers.A) clearTimeout(this.unlockTimers.A);\n            if (this.unlockTimers.P) clearTimeout(this.unlockTimers.P);\n        }\n    }\n}\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 520,
        "y": 980,
        "wires": [
            [
                "26326e9c4ff0218a",
                "53c096d139c0fbe9"
            ]
        ]
    },
    {
        "id": "b26bbb00ae88e427",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "",
        "page": "d7a4298f3059e4c3",
        "ui": "",
        "name": "CSS",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ========================================\n   å¤ªé™½èƒ½ç›£æ§ç³»çµ± Dashboard å®Œæ•´æ¨£å¼\n   Solar Monitoring System Dashboard Styles\n   Version: 2.1 - ä¿®å¾©ç©ºç™½å•é¡Œ\n   Last Updated: 2025-10-16\n   ======================================== */\n\n/* ========================================\n   å…¨å±€æ¨£å¼ Global Styles\n   ======================================== */\n.solar-dash {\n    font-family: Arial, sans-serif;\n    background: #f5f6fa;\n    /* min-height: 100vh; */\n    /* ç§»é™¤ï¼é€™æœƒé€ æˆç©ºç™½ */\n    padding: 20px;\n}\n\n/* ========================================\n   é ‚éƒ¨ç‹€æ…‹åˆ— Status Bar\n   ======================================== */\n.status-bar {\n    background: #fff;\n    padding: 12px 20px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    margin-bottom: 20px;\n    border-radius: 8px;\n}\n\n.status-dot {\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background: #f44336;\n    display: inline-block;\n    margin-right: 8px;\n    transition: all 0.3s;\n}\n\n.status-dot.on {\n    background: #4caf50;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n\n    0%,\n    100% {\n        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);\n    }\n\n    50% {\n        box-shadow: 0 0 0 8px rgba(76, 175, 80, 0);\n    }\n}\n\n/* ========================================\n   å¡ç‰‡æ¨£å¼ Card Styles\n   ======================================== */\n.card {\n    background: #fff;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n    transition: all 0.3s;\n    margin-bottom: 20px;\n    /* çµ±ä¸€é–“è· */\n}\n\n.card:last-child {\n    margin-bottom: 0;\n    /* æœ€å¾Œä¸€å€‹å¡ç‰‡ä¸ç•™ç©ºç™½ */\n}\n\n.card:hover {\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);\n}\n\n.card h3 {\n    margin: 0 0 12px;\n    color: #7f8c8d;\n    font-size: 14px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n/* ========================================\n   åŠŸç‡èˆ‡æ•ˆç‡å¡ç‰‡ Metrics & Efficiency\n   ======================================== */\n.metrics,\n.eff {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 20px;\n    margin-bottom: 20px;\n}\n\n/* é—œéµä¿®å¾©ï¼šå¦‚æœæ˜¯é é¢æœ€å¾Œä¸€å€‹å…ƒç´ ï¼Œç§»é™¤åº•éƒ¨é–“è· */\n.metrics:last-child,\n.eff:last-child {\n    margin-bottom: 0;\n}\n\n.val {\n    font-size: 48px;\n    font-weight: bold;\n    margin: 10px 0;\n    line-height: 1;\n    font-family: 'Courier New', monospace;\n}\n\n/* ========================================\n   é€²åº¦æ¢ Progress Bar\n   ======================================== */\n.bar {\n    height: 8px;\n    background: #e0e0e0;\n    border-radius: 4px;\n    overflow: hidden;\n    margin-top: 10px;\n    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n.fill {\n    height: 100%;\n    transition: width 0.5s ease;\n    border-radius: 4px;\n}\n\n/* ========================================\n   æ§åˆ¶é¢æ¿ Control Panel\n   ======================================== */\n.ctrl {\n    margin-bottom: 20px;\n}\n\n/* æœ€å¾Œçš„æ§åˆ¶é¢æ¿ä¸ç•™ç©ºç™½ */\n.ctrl:last-child {\n    margin-bottom: 0;\n}\n\n.ctrl h3 {\n    margin-bottom: 15px;\n    color: #2c3e50;\n    font-size: 16px;\n}\n\n.ctrl-buttons {\n    display: flex;\n    gap: 15px;\n    flex-wrap: wrap;\n}\n\n.ctrl-btn {\n    padding: 10px 20px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 600;\n    transition: all 0.3s;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.ctrl-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);\n}\n\n.ctrl-btn:active {\n    transform: translateY(0);\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\n.ctrl-btn-danger {\n    background: #e74c3c;\n    color: white;\n}\n\n.ctrl-btn-danger:hover {\n    background: #c0392b;\n}\n\n.ctrl-btn-warning {\n    background: #f39c12;\n    color: white;\n}\n\n.ctrl-btn-warning:hover {\n    background: #e67e22;\n}\n\n.ctrl-btn-info {\n    background: #3498db;\n    color: white;\n}\n\n.ctrl-btn-info:hover {\n    background: #2980b9;\n}\n\n/* ========================================\n   Factor è¨­å®š Factor Settings\n   ======================================== */\n.factors {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 15px;\n    margin-top: 15px;\n}\n\n.factors label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    color: #2c3e50;\n    font-size: 13px;\n}\n\n.fac-wrap {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 8px;\n    background: #ecf0f1;\n    border-radius: 6px;\n    transition: all 0.3s;\n}\n\n.fac-wrap.lock {\n    background: #f8f9fa;\n    opacity: 0.7;\n}\n\n.fac-wrap:not(.lock) {\n    background: #e8f8f5;\n    border: 2px solid #27ae60;\n}\n\n.fac-wrap input {\n    flex: 1;\n    padding: 8px;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    font-size: 16px;\n    font-family: 'Courier New', monospace;\n}\n\n.fac-wrap input:focus {\n    outline: none;\n    border-color: #3498db;\n    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);\n}\n\n.fac-wrap input:disabled {\n    cursor: not-allowed;\n    opacity: 0.6;\n    background: #f5f5f5;\n}\n\n.lock-btn {\n    cursor: pointer;\n    user-select: none;\n    font-size: 20px;\n    transition: all 0.2s;\n    padding: 5px;\n}\n\n.lock-btn:hover {\n    opacity: 0.7;\n    transform: scale(1.1);\n}\n\n.lock-btn:active {\n    transform: scale(0.95);\n}\n\n.last-update {\n    font-size: 12px;\n    color: #7f8c8d;\n    margin-top: 10px;\n    margin-bottom: 0;\n    font-style: italic;\n}\n\n/* ========================================\n   æ¨¡æ…‹å°è©±æ¡† Modal Dialog\n   ======================================== */\n.modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 1000;\n    animation: fadeIn 0.2s ease-in;\n}\n\n.modal-content {\n    background: white;\n    padding: 30px;\n    border-radius: 12px;\n    min-width: 300px;\n    max-width: 500px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n    animation: slideUp 0.3s ease-out;\n}\n\n.modal-content h3 {\n    margin: 0 0 20px 0;\n    color: #2c3e50;\n    font-size: 18px;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n    }\n\n    to {\n        opacity: 1;\n    }\n}\n\n@keyframes slideUp {\n    from {\n        transform: translateY(50px);\n        opacity: 0;\n    }\n\n    to {\n        transform: translateY(0);\n        opacity: 1;\n    }\n}\n\n/* ========================================\n   éŸ¿æ‡‰å¼è¨­è¨ˆ Responsive Design\n   ======================================== */\n\n/* å¹³æ¿ Tablet (768px - 1024px) */\n@media (max-width: 1024px) {\n\n    .metrics,\n    .eff {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n/* æ‰‹æ©Ÿæ©«å‘ Mobile Landscape (481px - 767px) */\n@media (max-width: 767px) {\n    .solar-dash {\n        padding: 10px;\n    }\n\n    .status-bar {\n        flex-direction: column;\n        gap: 10px;\n        padding: 10px;\n    }\n\n    .metrics,\n    .eff {\n        grid-template-columns: 1fr;\n        gap: 15px;\n    }\n\n    .factors {\n        grid-template-columns: 1fr;\n    }\n\n    .ctrl-buttons {\n        flex-direction: column;\n    }\n\n    .ctrl-btn {\n        width: 100%;\n    }\n\n    .val {\n        font-size: 36px;\n    }\n\n    .card {\n        padding: 15px;\n    }\n}\n\n/* æ‰‹æ©Ÿç›´å‘ Mobile Portrait (max 480px) */\n@media (max-width: 480px) {\n    .solar-dash {\n        padding: 5px;\n    }\n\n    .status-bar {\n        padding: 8px;\n        margin-bottom: 10px;\n    }\n\n    .card {\n        padding: 12px;\n        margin-bottom: 10px;\n    }\n\n    .val {\n        font-size: 28px;\n    }\n\n    .card h3 {\n        font-size: 12px;\n    }\n\n    .ctrl-btn {\n        padding: 8px 16px;\n        font-size: 13px;\n    }\n\n    .factors {\n        gap: 10px;\n    }\n\n    .fac-wrap input {\n        font-size: 14px;\n        padding: 6px;\n    }\n\n    .modal-content {\n        margin: 10px;\n        padding: 20px;\n        min-width: unset;\n        width: calc(100% - 20px);\n    }\n}\n\n/* ========================================\n   å¡ç‰‡å‹•ç•« Card Animations\n   ======================================== */\n.card {\n    animation: fadeInUp 0.3s ease-in;\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* ========================================\n   è¼‰å…¥å‹•ç•« Loading Animations\n   ======================================== */\n.loading {\n    display: inline-block;\n    width: 20px;\n    height: 20px;\n    border: 3px solid rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    border-top-color: #fff;\n    animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n/* ========================================\n   å·¥å…·é¡ Utility Classes\n   ======================================== */\n.text-center {\n    text-align: center;\n}\n\n.text-right {\n    text-align: right;\n}\n\n.mt-10 {\n    margin-top: 10px;\n}\n\n.mt-20 {\n    margin-top: 20px;\n}\n\n.mb-10 {\n    margin-bottom: 10px;\n}\n\n.mb-20 {\n    margin-bottom: 20px;\n}\n\n.gap-10 {\n    gap: 10px;\n}\n\n.gap-20 {\n    gap: 20px;\n}\n\n.flex {\n    display: flex;\n}\n\n.flex-col {\n    flex-direction: column;\n}\n\n.items-center {\n    align-items: center;\n}\n\n.justify-between {\n    justify-content: space-between;\n}\n\n/* ========================================\n   ç„¡éšœç¤™è¨­è¨ˆ Accessibility\n   ======================================== */\n*:focus-visible {\n    outline: 2px solid #3498db;\n    outline-offset: 2px;\n}\n\nbutton:focus-visible {\n    outline: 2px solid #3498db;\n    outline-offset: 2px;\n}\n\n/* é«˜å°æ¯”åº¦æ¨¡å¼ */\n@media (prefers-contrast: high) {\n    .card {\n        border: 2px solid #000;\n    }\n\n    .ctrl-btn {\n        border: 2px solid currentColor;\n    }\n}\n\n/* æ¸›å°‘å‹•ç•« */\n@media (prefers-reduced-motion: reduce) {\n    * {\n        animation-duration: 0.01ms !important;\n        animation-iteration-count: 1 !important;\n        transition-duration: 0.01ms !important;\n    }\n}\n\n/* ========================================\n   æ·±è‰²æ¨¡å¼æ”¯æ´ Dark Mode Support\n   ======================================== */\n@media (prefers-color-scheme: dark) {\n    .solar-dash {\n        background: #1a1a1a;\n        color: #e0e0e0;\n    }\n\n    .card {\n        background: #2c2c2c;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    }\n\n    .status-bar {\n        background: #2c2c2c;\n    }\n\n    .card h3 {\n        color: #b0b0b0;\n    }\n\n    .fac-wrap {\n        background: #3a3a3a;\n    }\n\n    .fac-wrap input {\n        background: #4a4a4a;\n        color: #e0e0e0;\n        border-color: #5a5a5a;\n    }\n\n    .bar {\n        background: #3a3a3a;\n    }\n\n    .modal {\n        background: rgba(0, 0, 0, 0.8);\n    }\n\n    .modal-content {\n        background: #2c2c2c;\n        color: #e0e0e0;\n    }\n}\n\n/* ========================================\n   åˆ—å°æ¨£å¼ Print Styles\n   ======================================== */\n@media print {\n    .solar-dash {\n        background: white;\n        padding: 0;\n    }\n\n    .status-bar,\n    .ctrl,\n    .ctrl-btn,\n    button {\n        display: none !important;\n    }\n\n    .card {\n        box-shadow: none;\n        border: 1px solid #ddd;\n        page-break-inside: avoid;\n    }\n\n    .metrics,\n    .eff {\n        grid-template-columns: repeat(3, 1fr);\n    }\n\n    @page {\n        margin: 2cm;\n    }\n}\n\n/* ========================================\n   ç€è¦½å™¨å…¼å®¹æ€§ Browser Compatibility\n   ======================================== */\n\n/* IE11 Fallback */\n@supports not (display: grid) {\n\n    .metrics,\n    .eff,\n    .factors {\n        display: flex;\n        flex-wrap: wrap;\n    }\n\n    .metrics>*,\n    .eff>*,\n    .factors>* {\n        flex: 1 1 250px;\n        margin: 10px;\n    }\n}\n\n/* Safari Specific */\n@supports (-webkit-appearance: none) {\n    .ctrl-btn {\n        -webkit-appearance: none;\n    }\n}\n\n/* ========================================\n   é¡å¤–å¢å¼· Extra Enhancements\n   ======================================== */\n\n/* æ»¾å‹•æ¢æ¨£å¼ Scrollbar */\n::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n}\n\n::-webkit-scrollbar-track {\n    background: #f1f1f1;\n}\n\n::-webkit-scrollbar-thumb {\n    background: #888;\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: #555;\n}\n\n/* é¸æ“‡æ–‡å­—é¡è‰² */\n::selection {\n    background: #3498db;\n    color: white;\n}\n\n::-moz-selection {\n    background: #3498db;\n    color: white;\n}\n\n/* ========================================\n   é—œéµä¿®å¾©ï¼šå®¹å™¨é«˜åº¦è‡ªé©æ‡‰å…§å®¹\n   ======================================== */\n\n/* å®¹å™¨é«˜åº¦æ ¹æ“šå…§å®¹è‡ªå‹•èª¿æ•´ï¼Œä¸å¼·åˆ¶ä½”æ»¿è¦–çª— */\n.solar-dash {\n    height: auto;\n}\n\n/* ç¢ºä¿æœ€å¾Œä¸€å€‹å…ƒç´ ä¸ç•™å¤šé¤˜é–“è· */\n.solar-dash>*:last-child {\n    margin-bottom: 0;\n}\n\n/* ========================================\n   çµæŸ End of Styles\n   ======================================== */\n/* å¼·åˆ¶æ·ºè‰²æ¨¡å¼ - è¦†è“‹æ‰‹æ©Ÿæ·±è‰²å¸ƒæ™¯ */\n@media (prefers-color-scheme: dark) {\n    .solar-dash {\n        background: #f5f6fa !important;\n        color: #2c3e50 !important;\n    }\n\n    .card {\n        background: #ffffff !important;\n        color: #2c3e50 !important;\n    }\n\n    .status-bar {\n        background: #ffffff !important;\n        color: #2c3e50 !important;\n    }\n\n    .card h3 {\n        color: #7f8c8d !important;\n    }\n\n    .val {\n        color: #2c3e50 !important;\n    }\n\n    .fac-wrap input {\n        background: #f8f9fa !important;\n        color: #2c3e50 !important;\n    }\n}",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 730,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "74034cbe63589d95",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "gpsè§£æå™¨",
        "func": "// =================================================================\n// GPS è§£æå™¨ - å®Œæ•´ç‰ˆ\n// è¼¸å…¥: solar/6002/gps\n// æ ¼å¼: \"25.033671,121.564427,100.5,8\"\n// è¼¸å‡º: \n//   Output 1: è³‡æ–™åº«å¯«å…¥ (msg.query_type = 'upsert_gps_location')\n//   Output 2: Dashboard é¡¯ç¤º (msg.payload = GPSæ•¸æ“š)\n//   Output 3: Debug æ—¥èªŒ\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\n// === å–å¾—è¨­å‚™ ID ===\nlet deviceId = '6002'; // é è¨­å€¼\n\nif (msg.topic) {\n    const topicParts = msg.topic.split('/');\n    // æ ¼å¼: solar/DEVICE_ID/gps\n    if (topicParts.length >= 3 && topicParts[0] === 'solar' && topicParts[2] === 'gps') {\n        deviceId = topicParts[1];\n    }\n}\n\nlog(`[GPS Parser] è™•ç†è¨­å‚™ ${deviceId} çš„ GPS æ•¸æ“š`);\n\n// === è§£æ GPS æ•¸æ“š ===\nlet rawData = msg.payload;\n\n// è™•ç† Buffer\nif (Buffer.isBuffer(rawData)) {\n    rawData = rawData.toString('utf-8');\n}\n\n// è½‰æ›ç‚ºå­—ä¸²\nif (typeof rawData !== 'string') {\n    rawData = String(rawData);\n}\n\n// ç§»é™¤å¼•è™Ÿå’Œç©ºç™½\nconst cleanData = rawData.replace(/[\"\\s]/g, '');\n\nlog(`[GPS Parser] åŸå§‹æ•¸æ“š: ${cleanData}`);\n\n// æª¢æŸ¥æ•¸æ“š\nif (!cleanData || cleanData.length === 0) {\n    log('[GPS Parser] GPS æ•¸æ“šç‚ºç©º');\n    setStatus(\"red\", \"ring\", \"ç©ºæ•¸æ“š\");\n    return null;\n}\n\n// åˆ†å‰²æ•¸æ“š: latitude,longitude,altitude,satellites\nconst parts = cleanData.split(',');\n\nif (parts.length < 2) {\n    log(`[GPS Parser] GPS æ•¸æ“šæ ¼å¼éŒ¯èª¤: é æœŸè‡³å°‘2å€‹æ¬„ä½ï¼Œå¯¦éš›${parts.length}å€‹`);\n    setStatus(\"red\", \"ring\", \"æ ¼å¼éŒ¯èª¤\");\n    return null;\n}\n\n// è§£æåº§æ¨™\nconst latitude = parseFloat(parts[0]);\nconst longitude = parseFloat(parts[1]);\nconst altitude = parts.length > 2 ? parseFloat(parts[2]) : 0;\nconst satellites = parts.length > 3 ? parseInt(parts[3]) : 0;\n\n// é©—è­‰åº§æ¨™\nif (isNaN(latitude) || isNaN(longitude)) {\n    log('[GPS Parser] ç„¡æ•ˆçš„ GPS åº§æ¨™ï¼ˆéæ•¸å­—ï¼‰');\n    setStatus(\"yellow\", \"ring\", \"åº§æ¨™ç„¡æ•ˆ\");\n    return null;\n}\n\n// æª¢æŸ¥åº§æ¨™ç¯„åœ\nif (latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {\n    log(`[GPS Parser] GPS åº§æ¨™è¶…å‡ºç¯„åœ: (${latitude}, ${longitude})`);\n    setStatus(\"yellow\", \"ring\", \"åº§æ¨™è¶…ç¯„åœ\");\n    return null;\n}\n\nlog(`[GPS Parser] âœ… åº§æ¨™: (${latitude.toFixed(6)}, ${longitude.toFixed(6)}), é«˜åº¦: ${altitude}m, è¡›æ˜Ÿ: ${satellites}`);\n\n// === æº–å‚™è³‡æ–™åº«å¯«å…¥æ•¸æ“š ===\nconst dbMsg = {\n    query_type: 'upsert_gps_location',\n    params: [\n        deviceId,\n        latitude,\n        longitude,\n        altitude || 0,\n        satellites || 0,\n        new Date().toISOString()\n    ],\n    device_id: deviceId\n};\n\n// === æº–å‚™ Dashboard æ•¸æ“š ===\nconst dashboardMsg = {\n    topic: `dashboard/gps/${deviceId}`,\n    payload: {\n        device_id: deviceId,\n        type: 'gps',\n        latitude: latitude,\n        longitude: longitude,\n        altitude: altitude,\n        satellites: satellites,\n        timestamp: new Date().toLocaleTimeString('zh-TW'),\n        formatted: `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`\n    }\n};\n\n// === Debug è¨Šæ¯ ===\nconst debugMsg = {\n    payload: `[GPS] ${deviceId} - (${latitude.toFixed(6)}, ${longitude.toFixed(6)}) @ ${altitude}m, ${satellites}é¡†è¡›æ˜Ÿ`\n};\n\n// è¨­å®šç¯€é»ç‹€æ…‹\nsetStatus(\"green\", \"dot\", `GPS: ${satellites}è¡›æ˜Ÿ`);\n\n// === è¿”å›ä¸‰å€‹è¼¸å‡º ===\nreturn [dbMsg, dashboardMsg, debugMsg];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1180,
        "wires": [
            [
                "4d7bb9d2a4c09c70"
            ]
        ]
    },
    {
        "id": "4d7bb9d2a4c09c70",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "SQLç”Ÿæˆå™¨",
        "func": "// =================================================================\n// å‹•æ…‹ SQL ç”Ÿæˆå™¨ - çµ±ä¸€ç‰ˆï¼ˆç§»é™¤ pizeroï¼‰\n// ç‰ˆæœ¬: V5.0\n// é©ç”¨æ–¼ç¨ç«‹ solar_db è³‡æ–™åº«\n// \n// æ•´åˆæ‰€æœ‰ SQL æ“ä½œï¼š\n// - åŠŸç‡æ•¸æ“šã€GPSã€é…ç½®ã€è¨­å‚™ç‹€æ…‹ã€çµ±è¨ˆ\n// =================================================================\n\n// ç¢ºä¿ msg ç‰©ä»¶å­˜åœ¨\nif (!msg) {\n    msg = {};\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºè³‡æ–™åº«æ“ä½œ\nif (!msg.query_type) {\n    return msg;\n}\n\n// æª¢æŸ¥ params æ˜¯å¦å­˜åœ¨\nif (!msg.params) {\n    msg.params = [];\n}\n\n// æ—¥èªŒè¼¸å‡º\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// è¨­å®šç‹€æ…‹\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog(`[SQL] é¡å‹: ${msg.query_type}, åƒæ•¸: ${JSON.stringify(msg.params)}`);\n\ntry {\n    switch (msg.query_type) {\n        // ========================================\n        // ç³»çµ±ç®¡ç† SQL\n        // ========================================\n        case 'test_connection':\n            msg.query = 'SELECT version(), current_database();';\n            msg.params = [];\n            log('[SQL] æ¸¬è©¦è³‡æ–™åº«é€£ç·š');\n            break;\n\n        case 'list_tables':\n            msg.query = `\n                SELECT table_name \n                FROM information_schema.tables \n                WHERE table_schema = 'public' \n                ORDER BY table_name;\n            `;\n            msg.params = [];\n            log('[SQL] åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨');\n            break;\n\n        // ========================================\n        // åŠŸç‡æ•¸æ“šæ“ä½œ\n        // ========================================\n        case 'insert_power_data':\n            // ç¢ºä¿æœ‰ 7 å€‹åƒæ•¸\n            while (msg.params.length < 7) {\n                msg.params.push(null);\n            }\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                    pg = EXCLUDED.pg,\n                    pa = EXCLUDED.pa,\n                    pp = EXCLUDED.pp,\n                    pga_efficiency = EXCLUDED.pga_efficiency,\n                    pgp_efficiency = EXCLUDED.pgp_efficiency\n                RETURNING id;\n            `;\n            log(`[SQL] æ’å…¥åŠŸç‡æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'batch_insert_power_data':\n            // æ‰¹æ¬¡æ’å…¥\n            if (msg.batch_data && Array.isArray(msg.batch_data) && msg.batch_data.length > 0) {\n                const values = msg.batch_data.map((data, idx) => {\n                    const offset = idx * 7;\n                    return `($${offset + 1}, $${offset + 2}, $${offset + 3}, $${offset + 4}, $${offset + 5}, $${offset + 6}, $${offset + 7})`;\n                }).join(',');\n\n                msg.query = `\n                    INSERT INTO power_data \n                    (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                    VALUES ${values}\n                    ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                        pg = EXCLUDED.pg,\n                        pa = EXCLUDED.pa,\n                        pp = EXCLUDED.pp,\n                        pga_efficiency = EXCLUDED.pga_efficiency,\n                        pgp_efficiency = EXCLUDED.pgp_efficiency\n                    RETURNING id;\n                `;\n                msg.params = msg.batch_data.flat();\n                log(`[SQL] æ‰¹æ¬¡æ’å…¥ ${msg.batch_data.length} ç­†æ•¸æ“š`);\n            } else {\n                log('[SQL] æ‰¹æ¬¡æ’å…¥å¤±æ•—ï¼šç„¡æœ‰æ•ˆæ•¸æ“š');\n                msg.query = null;\n            }\n            break;\n\n        case 'get_latest_data':\n            // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹åƒæ•¸\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            if (msg.params.length < 2) {\n                msg.params.push(10);\n            }\n            msg.query = `\n                SELECT * FROM power_data\n                WHERE device_id = $1\n                ORDER BY timestamp DESC\n                LIMIT $2;\n            `;\n            log(`[SQL] æŸ¥è©¢æœ€æ–°æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'get_data_by_timerange':\n            if (msg.params.length < 3) {\n                log('[SQL] æ™‚é–“ç¯„åœæŸ¥è©¢éœ€è¦ 3 å€‹åƒæ•¸');\n                msg.query = null;\n            } else {\n                msg.query = `\n                    SELECT * FROM power_data\n                    WHERE device_id = $1 \n                    AND timestamp BETWEEN $2 AND $3\n                    ORDER BY timestamp DESC;\n                `;\n                log(`[SQL] æŸ¥è©¢æ™‚é–“ç¯„åœæ•¸æ“š: ${msg.params[0]}`);\n            }\n            break;\n\n        // ========================================\n        // è¨­å‚™ç®¡ç†\n        // ========================================\n        case 'update_device_status':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                UPDATE devices \n                SET last_seen = CURRENT_TIMESTAMP\n                WHERE device_id = $1\n                RETURNING device_id, last_seen;\n            `;\n            log(`[SQL] æ›´æ–°è¨­å‚™ç‹€æ…‹: ${msg.params[0]}`);\n            break;\n\n        case 'upsert_device':\n            while (msg.params.length < 3) {\n                msg.params.push('');\n            }\n            msg.query = `\n                INSERT INTO devices (device_id, device_name, location)\n                VALUES ($1, $2, $3)\n                ON CONFLICT (device_id) \n                DO UPDATE SET \n                    device_name = EXCLUDED.device_name,\n                    location = EXCLUDED.location,\n                    last_seen = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] è¨»å†Š/æ›´æ–°è¨­å‚™: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_devices':\n            msg.query = `\n                SELECT \n                    d.*,\n                    c.factor_a,\n                    c.factor_p,\n                    (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                ORDER BY d.device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹');\n            break;\n\n        // ========================================\n        // é…ç½®ç®¡ç†ï¼ˆç§»é™¤ pizeroï¼‰\n        // ========================================\n        case 'get_config':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    device_id,\n                    factor_a,\n                    factor_p,\n                    updated_at\n                FROM config\n                WHERE device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢é…ç½®: ${msg.params[0]}`);\n            break;\n\n        case 'update_config':\n            // ç¢ºä¿æœ‰ 3 å€‹åƒæ•¸ï¼ˆç§»é™¤ pizero_on, pizero_offï¼‰\n            while (msg.params.length < 3) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else {\n                    msg.params.push(1.0);\n                }\n            }\n            msg.query = `\n                INSERT INTO config \n                (device_id, factor_a, factor_p, updated_at)\n                VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    factor_a = EXCLUDED.factor_a,\n                    factor_p = EXCLUDED.factor_p,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] æ›´æ–°é…ç½®: ${msg.params[0]}`);\n            log(`[SQL]   Factor_A: ${msg.params[1]}`);\n            log(`[SQL]   Factor_P: ${msg.params[2]}`);\n            break;\n\n        case 'get_device_info':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    d.device_id,\n                    d.device_name,\n                    d.location,\n                    d.last_seen,\n                    c.factor_a,\n                    c.factor_p\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                WHERE d.device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢è¨­å‚™å®Œæ•´è³‡è¨Š: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // çµ±è¨ˆæŸ¥è©¢\n        // ========================================\n        case 'get_hourly_stats':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE_TRUNC('hour', timestamp) as hour,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    MAX(pg) as max_pg,\n                    MIN(pg) as min_pg,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '24 hours'\n                GROUP BY hour, device_id\n                ORDER BY hour DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢å°æ™‚çµ±è¨ˆ: ${msg.params[0]}`);\n            break;\n\n        case 'get_daily_summary':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE(timestamp) as date,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    SUM(pg) as total_pg,\n                    AVG(pga_efficiency) as avg_pga_eff,\n                    AVG(pgp_efficiency) as avg_pgp_eff,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '30 days'\n                GROUP BY date, device_id\n                ORDER BY date DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢æ¯æ—¥ç¸½çµ: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // GPS ä½ç½®ç®¡ç†\n        // ========================================\n        case 'upsert_gps_location':\n            while (msg.params.length < 6) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else if (msg.params.length <= 2) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 3) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 4) {\n                    msg.params.push(0);\n                } else {\n                    msg.params.push(new Date().toISOString());\n                }\n            }\n\n            msg.query = `\n                INSERT INTO gps_locations \n                (device_id, latitude, longitude, altitude, satellites, timestamp)\n                VALUES ($1, $2, $3, $4, $5, $6)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    latitude = EXCLUDED.latitude,\n                    longitude = EXCLUDED.longitude,\n                    altitude = EXCLUDED.altitude,\n                    satellites = EXCLUDED.satellites,\n                    timestamp = EXCLUDED.timestamp,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n\n            log(`[SQL] æ’å…¥/æ›´æ–° GPS: ${msg.params[0]} (${msg.params[1]}, ${msg.params[2]})`);\n            break;\n\n        case 'get_gps_location':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                WHERE device_id = $1;\n            `;\n\n            log(`[SQL] æŸ¥è©¢ GPS: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_gps_locations':\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                ORDER BY device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰ GPS');\n            break;\n\n        case 'create_gps_table':\n            msg.query = `\n                CREATE TABLE IF NOT EXISTS gps_locations (\n                    id SERIAL PRIMARY KEY,\n                    device_id VARCHAR(50) NOT NULL,\n                    latitude DOUBLE PRECISION NOT NULL,\n                    longitude DOUBLE PRECISION NOT NULL,\n                    altitude DOUBLE PRECISION DEFAULT 0,\n                    satellites INTEGER DEFAULT 0,\n                    timestamp TIMESTAMP NOT NULL,\n                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    CONSTRAINT unique_device_gps UNIQUE (device_id)\n                );\n                \n                CREATE INDEX IF NOT EXISTS idx_gps_device ON gps_locations(device_id);\n                CREATE INDEX IF NOT EXISTS idx_gps_timestamp ON gps_locations(timestamp DESC);\n            `;\n            msg.params = [];\n            log('[SQL] å»ºç«‹ GPS è¡¨æ ¼');\n            break;\n\n        // ========================================\n        // æ¸¬è©¦æ•¸æ“š\n        // ========================================\n        case 'insert_test_data':\n            const now = new Date();\n            const deviceId = msg.params[0] || '6002';\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                RETURNING *;\n            `;\n            msg.params = [\n                deviceId,\n                now.toISOString(),\n                Math.floor(Math.random() * 50) + 150,\n                Math.floor(Math.random() * 50) + 200,\n                Math.floor(Math.random() * 50) + 180,\n                Math.random() * 20 + 30,\n                Math.random() * 20 + 20\n            ];\n            log('[SQL] æ’å…¥æ¸¬è©¦æ•¸æ“š');\n            break;\n\n        default:\n            log(`[SQL] æœªè™•ç†çš„æŸ¥è©¢é¡å‹: ${msg.query_type}`);\n            msg.query = null;\n            break;\n    }\n\n    // è¨­å®šç‹€æ…‹\n    if (msg.query) {\n        setStatus(\"green\", \"dot\", `SQL: ${msg.query_type}`);\n    } else {\n        setStatus(\"yellow\", \"ring\", \"ç„¡ SQL\");\n    }\n\n} catch (error) {\n    log(`[SQL] éŒ¯èª¤: ${error.message}`);\n    msg.error = error.message;\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n}\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„æŸ¥è©¢é¡å‹æ¸…å–®\n// =================================================================\n//\n// ã€ç³»çµ±ç®¡ç†ã€‘\n//   test_connection, list_tables, create_gps_table\n//\n// ã€åŠŸç‡æ•¸æ“šã€‘\n//   insert_power_data, batch_insert_power_data, \n//   get_latest_data, get_data_by_timerange\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   update_device_status, upsert_device, get_all_devices\n//\n// ã€é…ç½®ç®¡ç†ã€‘ï¼ˆç§»é™¤ pizeroï¼‰\n//   get_config, update_config, get_device_info\n//\n// ã€çµ±è¨ˆæŸ¥è©¢ã€‘\n//   get_hourly_stats, get_daily_summary\n//\n// ã€GPS ä½ç½®ã€‘\n//   upsert_gps_location, get_gps_location, get_all_gps_locations\n//\n// ã€æ¸¬è©¦ã€‘\n//   insert_test_data\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 1180,
        "wires": [
            [
                "c64aee4cdae4761a"
            ]
        ]
    },
    {
        "id": "26326e9c4ff0218a",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "UI->MQTTè½‰æ›",
        "func": "// =================================================================\n// UIâ†’MQTTè½‰æ› V4.1 - æ”¯æ´å–®å±¤å’Œé›™å±¤ payload\n// è¼¸å‡ºæ•¸é‡: 2\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nlog('========================================');\nlog('[UIâ†’MQTT] V4.1 å•Ÿå‹•');\n\n// ========== æ­¥é©Ÿ 1: æ™ºèƒ½è­˜åˆ¥ payload æ ¼å¼ ==========\nlet event;\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºé›™å±¤ payload (Dashboard 2.0 æ ¼å¼)\nif (msg.payload && msg.payload.payload && typeof msg.payload.payload === 'object') {\n    event = msg.payload.payload;\n    log('[UIâ†’MQTT] âœ… è­˜åˆ¥ç‚º Dashboard 2.0 æ ¼å¼ï¼ˆé›™å±¤ payloadï¼‰');\n}\n// æª¢æŸ¥æ˜¯å¦ç‚ºå–®å±¤ payload (ç›´æ¥æ³¨å…¥æ ¼å¼)\nelse if (msg.payload && msg.payload.action) {\n    event = msg.payload;\n    log('[UIâ†’MQTT] âœ… è­˜åˆ¥ç‚ºç›´æ¥æ³¨å…¥æ ¼å¼ï¼ˆå–®å±¤ payloadï¼‰');\n}\n// ç„¡æ•ˆæ ¼å¼\nelse {\n    log('[UIâ†’MQTT] âŒ ç„¡æœ‰æ•ˆ payload');\n    log('[UIâ†’MQTT] msg.payload å…§å®¹: ' + JSON.stringify(msg.payload));\n    node.status({ fill: \"red\", shape: \"ring\", text: \"ç„¡æ•ˆæ ¼å¼\" });\n    return [null, null];\n}\n\n// ========== æ­¥é©Ÿ 2: æå–è¨­å‚™ IDï¼ˆæ”¯æ´å¤šç¨®å¯«æ³•ï¼‰==========\nconst deviceId = event.device_id || event.deviceId || event.DEVICE_ID || '6002';\n\nlog(`[UIâ†’MQTT] ğŸ“± è¨­å‚™: ${deviceId}`);\nlog(`[UIâ†’MQTT] ğŸ¯ æŒ‡ä»¤: ${event.action || 'unknown'}`);\n\n// ========== æ­¥é©Ÿ 3: åˆå§‹åŒ–è¼¸å‡º ==========\nlet mqttMsg = null;  // Output 1: ç™¼é€åˆ° MQTT Broker\nlet dbMsg = null;    // Output 2: ç™¼é€åˆ°è³‡æ–™åº«\n\n// ========== æ­¥é©Ÿ 4: æ ¹æ“šä¸åŒæŒ‡ä»¤è™•ç† ==========\nswitch (event.action) {\n    // ========== MQTT æ§åˆ¶é¡ ==========\n    case 'reboot':\n        mqttMsg = {\n            topic: `solar/${deviceId}/control`,\n            payload: 'reboot',\n            qos: 1\n        };\n        log(`[UIâ†’MQTT] ğŸ”„ ç™¼é€é‡å•ŸæŒ‡ä»¤åˆ°è¨­å‚™ ${deviceId}`);\n        node.status({ fill: \"blue\", shape: \"dot\", text: `é‡å•Ÿ ${deviceId}` });\n        break;\n\n    case 'ota':\n        mqttMsg = {\n            topic: `solar/${deviceId}/admin/run_ota`,\n            payload: 'start',\n            qos: 1\n        };\n        log(`[UIâ†’MQTT] ğŸ“¡ ç™¼é€ OTA æŒ‡ä»¤åˆ°è¨­å‚™ ${deviceId}`);\n        node.status({ fill: \"yellow\", shape: \"dot\", text: `OTA ${deviceId}` });\n        break;\n\n    case 'request_gps':\n        mqttMsg = {\n            topic: `solar/${deviceId}/control`,\n            payload: 'get_gps',\n            qos: 1\n        };\n        log(`[UIâ†’MQTT] ğŸ“ è«‹æ±‚ GPS å®šä½: ${deviceId}`);\n        node.status({ fill: \"green\", shape: \"dot\", text: `GPS ${deviceId}` });\n        break;\n\n    // ========== è³‡æ–™åº«æ“ä½œé¡ ==========\n    case 'update_config':\n        // ç¢ºä¿æ•¸å€¼ç‚ºæµ®é»æ•¸\n        const config = {\n            factor_a: parseFloat(event.factor_a) || 1.0,\n            factor_p: parseFloat(event.factor_p) || 1.0\n        };\n\n        dbMsg = {\n            query_type: 'update_config',\n            params: [\n                deviceId,\n                config.factor_a,\n                config.factor_p\n            ],\n            device_id: deviceId,\n            _source: 'ui_config_update',\n            _config: config\n        };\n\n        log(`[UIâ†’MQTT] ğŸ”§ æ›´æ–°è¨­å‚™ ${deviceId} é…ç½®`);\n        log(`[UIâ†’MQTT]   â”œâ”€ Factor_A: ${config.factor_a}`);\n        log(`[UIâ†’MQTT]   â””â”€ Factor_P: ${config.factor_p}`);\n        node.status({ fill: \"green\", shape: \"dot\", text: `Config ${deviceId}` });\n        break;\n\n    case 'get_config':\n        dbMsg = {\n            query_type: 'get_config',\n            params: [deviceId],\n            device_id: deviceId,\n            _source: 'ui_get_config',\n            _return_to_ui: true\n        };\n\n        log(`[UIâ†’MQTT] ğŸ“– è®€å–è¨­å‚™ ${deviceId} é…ç½®`);\n        node.status({ fill: \"blue\", shape: \"ring\", text: `è®€å– ${deviceId}` });\n        break;\n\n    case 'get_latest':\n    case 'get_latest_data':\n        const limit = event.limit || 1;\n        dbMsg = {\n            query_type: 'get_latest_data',\n            params: [deviceId, limit],\n            device_id: deviceId,\n            _source: 'ui_get_data',\n            _return_to_ui: true\n        };\n\n        log(`[UIâ†’MQTT] ğŸ“Š å–å¾—è¨­å‚™ ${deviceId} æœ€æ–°æ•¸æ“šï¼ˆ${limit}ç­†ï¼‰`);\n        node.status({ fill: \"blue\", shape: \"ring\", text: `æ•¸æ“š ${deviceId}` });\n        break;\n\n    case 'get_device_info':\n        dbMsg = {\n            query_type: 'get_device_info',\n            params: [deviceId],\n            device_id: deviceId,\n            _source: 'ui_get_info',\n            _return_to_ui: true\n        };\n\n        log(`[UIâ†’MQTT] â„¹ï¸ å–å¾—è¨­å‚™ ${deviceId} è³‡è¨Š`);\n        node.status({ fill: \"blue\", shape: \"ring\", text: `è³‡è¨Š ${deviceId}` });\n        break;\n\n    case 'refresh_data':\n        // é‡æ–°è¼‰å…¥æœ€æ–°æ•¸æ“š\n        dbMsg = {\n            query_type: 'get_latest_data',\n            params: [deviceId, 1],\n            device_id: deviceId,\n            _source: 'ui_refresh',\n            _return_to_ui: true\n        };\n\n        log(`[UIâ†’MQTT] ğŸ”„ åˆ·æ–°è¨­å‚™ ${deviceId} æ•¸æ“š`);\n        node.status({ fill: \"green\", shape: \"dot\", text: `åˆ·æ–° ${deviceId}` });\n        break;\n\n    default:\n        log(`[UIâ†’MQTT] âŒ æœªçŸ¥çš„æ§åˆ¶æŒ‡ä»¤: ${event.action}`);\n        log(`[UIâ†’MQTT] å®Œæ•´ event: ${JSON.stringify(event)}`);\n        node.status({ fill: \"red\", shape: \"ring\", text: \"æœªçŸ¥æŒ‡ä»¤\" });\n        return [null, null];\n}\n\n// ========== æ­¥é©Ÿ 5: è¼¸å‡ºæ—¥èªŒ ==========\nif (mqttMsg) {\n    log('[UIâ†’MQTT] âœ… Output 1 (MQTT): ' + JSON.stringify(mqttMsg));\n}\nif (dbMsg) {\n    log('[UIâ†’MQTT] âœ… Output 2 (Database): ' + JSON.stringify(dbMsg));\n}\nlog('========================================');\n\n// ========== æ­¥é©Ÿ 6: è¿”å›å…©å€‹è¼¸å‡º ==========\nreturn [mqttMsg, dbMsg];\n\n// =================================================================\n// ğŸ“‹ ä½¿ç”¨èªªæ˜\n// =================================================================\n//\n// æ”¯æ´çš„ payload æ ¼å¼ï¼š\n//\n// æ ¼å¼ 1: Dashboard 2.0 (é›™å±¤)\n// {\n//     \"payload\": {\n//         \"payload\": {\n//             \"action\": \"update_config\",\n//             \"device_id\": \"6002\",\n//             \"factor_a\": 1.5,\n//             \"factor_p\": 2.0\n//         }\n//     }\n// }\n//\n// æ ¼å¼ 2: ç›´æ¥æ³¨å…¥ (å–®å±¤)\n// {\n//     \"action\": \"update_config\",\n//     \"device_id\": \"6002\",\n//     \"factor_a\": 1.5,\n//     \"factor_p\": 2.0\n// }\n//\n// å…©ç¨®æ ¼å¼éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œï¼\n//\n// =================================================================\n// ğŸ”Œ é€£ç·šæ–¹å¼\n// =================================================================\n//\n// [Template ç¯€é»] æˆ– [Inject ç¯€é»]\n//     â†“\n// [æ­¤ç¯€é»: UIâ†’MQTT è½‰æ›]\n//     â”œâ”€ Output 1 â†’ [MQTT Out] (æ§åˆ¶æŒ‡ä»¤)\n//     â””â”€ Output 2 â†’ [SQLç”Ÿæˆå™¨] â†’ [PostgreSQL] (è³‡æ–™åº«æ“ä½œ)\n//\n// =================================================================\n// âš™ï¸ ç¯€é»è¨­å®š\n// =================================================================\n//\n// åç¨±: UIâ†’MQTTè½‰æ›\n// é¡å‹: function\n// è¼¸å‡ºæ•¸é‡: 2\n//\n// =================================================================\n// ğŸ“ ç‰ˆæœ¬æ­·å²\n// =================================================================\n//\n// V4.1 (2025-10-16):\n// - âœ… æ”¯æ´å–®å±¤å’Œé›™å±¤ payload æ ¼å¼\n// - âœ… æ›´è©³ç´°çš„æ—¥èªŒè¼¸å‡º\n// - âœ… æ›´å¥½çš„éŒ¯èª¤è™•ç†\n// - âœ… æ”¯æ´ device_id å’Œ deviceId å…©ç¨®å¯«æ³•\n// - âœ… æ–°å¢ refresh_data æŒ‡ä»¤\n//\n// V4.0:\n// - å¤šè¨­å‚™ç‰ˆæœ¬\n// - é›™è¼¸å‡ºè¨­è¨ˆ\n//\n// =================================================================",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 1060,
        "wires": [
            [
                "a6fe76759d78c315"
            ],
            [
                "d96f189b2b19cb3d"
            ]
        ]
    },
    {
        "id": "c75e089718b69008",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "MQTT->UIè½‰æ›",
        "func": "// =================================================================\n// MQTT->UIè½‰æ› V3.0 - å³æ™‚æ•¸å€¼é¡¯ç¤ºå°ˆç”¨\n// ä½ç½®ï¼šæ•¸æ“šè§£æå™¨ Output 3 â†’ [é€™è£¡] â†’ [template]\n// \n// åŠŸèƒ½ï¼šæ¥æ”¶å³æ™‚æ•¸æ“šä¸¦è½‰ç™¼çµ¦ Dashboard\n// è¼¸å…¥ï¼šä¾†è‡ªæ•¸æ“šè§£æå™¨çš„å³æ™‚æ•¸æ“š\n// è¼¸å‡ºï¼š1å€‹ï¼ˆç™¼é€åˆ° templateï¼‰\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog('[UIè½‰æ›] ========================================');\n\n// ========== æ­¥é©Ÿ 1: é©—è­‰è¼¸å…¥ ==========\nif (!msg || !msg.payload) {\n    log('[UIè½‰æ›] âŒ ç„¡ payload');\n    setStatus(\"red\", \"ring\", \"ç„¡æ•¸æ“š\");\n    return null;\n}\n\nconst data = msg.payload;\n\n// ========== æ­¥é©Ÿ 2: é©—è­‰æ•¸æ“šé¡å‹ ==========\nif (data.type !== 'realtime') {\n    log(`[UIè½‰æ›] âš ï¸ æ•¸æ“šé¡å‹éŒ¯èª¤: ${data.type || 'undefined'}`);\n    log('[UIè½‰æ›] é æœŸ: realtime');\n    setStatus(\"yellow\", \"ring\", \"é¡å‹éŒ¯èª¤\");\n    return null;\n}\n\n// ========== æ­¥é©Ÿ 3: é©—è­‰å¿…è¦æ¬„ä½ ==========\nconst requiredFields = ['device_id', 'pg', 'pa', 'pp', 'pag', 'ppg'];\nconst missingFields = [];\n\nfor (const field of requiredFields) {\n    if (data[field] === undefined || data[field] === null) {\n        missingFields.push(field);\n    }\n}\n\nif (missingFields.length > 0) {\n    log(`[UIè½‰æ›] âŒ ç¼ºå°‘å¿…è¦æ¬„ä½: ${missingFields.join(', ')}`);\n    setStatus(\"red\", \"ring\", \"æ¬„ä½ç¼ºå¤±\");\n    return null;\n}\n\n// ========== æ­¥é©Ÿ 4: é©—è­‰æ•¸æ“šç¯„åœ ==========\nconst deviceId = data.device_id;\nconst pg = parseInt(data.pg) || 0;\nconst pa = parseInt(data.pa) || 0;\nconst pp = parseInt(data.pp) || 0;\nconst pag = parseFloat(data.pag) || 0;\nconst ppg = parseFloat(data.ppg) || 0;\n\n// é©—è­‰åŠŸç‡ç¯„åœï¼ˆ0-10000Wï¼‰\nif (pg < 0 || pg > 10000 || pa < 0 || pa > 10000 || pp < 0 || pp > 10000) {\n    log(`[UIè½‰æ›] âš ï¸ åŠŸç‡å€¼è¶…å‡ºç¯„åœ: PG=${pg}, PA=${pa}, PP=${pp}`);\n}\n\n// é©—è­‰æ•ˆç‡ç¯„åœï¼ˆ-100% ~ 200%ï¼‰\nif (pag < -100 || pag > 200 || ppg < -100 || ppg > 200) {\n    log(`[UIè½‰æ›] âš ï¸ æ•ˆç‡å€¼è¶…å‡ºç¯„åœ: PAG=${pag}%, PPG=${ppg}%`);\n}\n\n// ========== æ­¥é©Ÿ 5: è¼¸å‡ºè©³ç´°æ—¥èªŒ ==========\nlog(`[UIè½‰æ›] è¨­å‚™: ${deviceId}`);\nlog(`[UIè½‰æ›] æ™‚é–“: ${data.lastUpdate || 'æœªçŸ¥'}`);\nlog(`[UIè½‰æ›] ç‹€æ…‹: ${data.online ? 'åœ¨ç·š' : 'é›¢ç·š'}`);\nlog('[UIè½‰æ›] ----------------------------------------');\nlog('[UIè½‰æ›] åŠŸç‡æ•¸æ“š:');\nlog(`[UIè½‰æ›]   PG (ç™¼é›»): ${pg} W`);\nlog(`[UIè½‰æ›]   PA (è² è¼‰A): ${pa} W`);\nlog(`[UIè½‰æ›]   PP (è² è¼‰P): ${pp} W`);\nlog('[UIè½‰æ›] ----------------------------------------');\nlog('[UIè½‰æ›] æ•ˆç‡æ•¸æ“š:');\nlog(`[UIè½‰æ›]   PAG (è² è¼‰Aæ•ˆç‡): ${pag.toFixed(2)} %`);\nlog(`[UIè½‰æ›]   PPG (è² è¼‰Pæ•ˆç‡): ${ppg.toFixed(2)} %`);\nlog('[UIè½‰æ›] ========================================');\n\n// ========== æ­¥é©Ÿ 6: æº–å‚™è¼¸å‡ºæ•¸æ“š ==========\n// ç¢ºä¿æ•¸æ“šæ ¼å¼æ­£ç¢º\nmsg.payload = {\n    type: 'realtime',\n    device_id: deviceId,\n    online: data.online !== false,  // é è¨­ç‚º true\n    lastUpdate: data.lastUpdate || new Date().toLocaleTimeString('zh-TW'),\n    pg: pg,\n    pa: pa,\n    pp: pp,\n    pag: parseFloat(pag.toFixed(2)),\n    ppg: parseFloat(ppg.toFixed(2)),\n    timestamp: data.timestamp || new Date().toISOString()\n};\n\n// ========== æ­¥é©Ÿ 7: è¨­ç½®ç¯€é»ç‹€æ…‹ ==========\nconst statusText = `${deviceId}: PG=${pg}W PA=${pa}W PP=${pp}W`;\nsetStatus(\"green\", \"dot\", statusText);\n\nlog(`[UIè½‰æ›] âœ… æ•¸æ“šå·²æº–å‚™å®Œæˆï¼Œç™¼é€åˆ° template`);\n\n// ========== æ­¥é©Ÿ 8: è¿”å›æ•¸æ“š ==========\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ è¼¸å‡ºæ ¼å¼\n// =================================================================\n//\n// msg.payload = {\n//     type: 'realtime',\n//     device_id: '6002',\n//     online: true,\n//     lastUpdate: 'ä¸‹åˆ4:04:47',\n//     pg: 150,\n//     pa: 200,\n//     pp: 180,\n//     pag: 33.33,\n//     ppg: 20.00,\n//     timestamp: '2025-10-13 16:04:47'\n// }\n//\n// =================================================================\n// ğŸ”Œ é€£ç·šæ–¹å¼\n// =================================================================\n//\n// [æ•¸æ“šè§£æå™¨ Output 3]\n//     â†“\n// [æ­¤ç¯€é»]\n//     â†“\n// [template] + [CSS]\n//\n// =================================================================\n// âš™ï¸ ç¯€é»è¨­å®š\n// =================================================================\n//\n// åç¨±: MQTT->UIè½‰æ›\n// è¼¸å‡ºæ•¸é‡: 1\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 980,
        "wires": [
            [
                "fcfafba4b015bc1e"
            ]
        ]
    },
    {
        "id": "307a7b38f08e38bc",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 320,
        "wires": [
            [
                "d992ce3e081aa0bf"
            ]
        ]
    },
    {
        "id": "1d1b5a9205c437c7",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 260,
        "wires": [
            [
                "624e02a3dcdcb213"
            ]
        ]
    },
    {
        "id": "c64d3f0e17cc876f",
        "type": "mqtt in",
        "z": "4f2c9b23a074cc9b",
        "name": "GPS DATA INPUT",
        "topic": "solar/+/gps",
        "qos": "1",
        "datatype": "auto-detect",
        "broker": "1de931c467a32710",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 250,
        "y": 1180,
        "wires": [
            [
                "74034cbe63589d95"
            ]
        ]
    },
    {
        "id": "a6fe76759d78c315",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "Send control",
        "topic": "",
        "qos": "1",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 510,
        "y": 1040,
        "wires": []
    },
    {
        "id": "b71bb8b4f401e6c3",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "SQLç”Ÿæˆå™¨",
        "func": "// =================================================================\n// å‹•æ…‹ SQL ç”Ÿæˆå™¨ - çµ±ä¸€ç‰ˆï¼ˆç§»é™¤ pizeroï¼‰\n// ç‰ˆæœ¬: V5.0\n// é©ç”¨æ–¼ç¨ç«‹ solar_db è³‡æ–™åº«\n// \n// æ•´åˆæ‰€æœ‰ SQL æ“ä½œï¼š\n// - åŠŸç‡æ•¸æ“šã€GPSã€é…ç½®ã€è¨­å‚™ç‹€æ…‹ã€çµ±è¨ˆ\n// =================================================================\n\n// ç¢ºä¿ msg ç‰©ä»¶å­˜åœ¨\nif (!msg) {\n    msg = {};\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºè³‡æ–™åº«æ“ä½œ\nif (!msg.query_type) {\n    return msg;\n}\n\n// æª¢æŸ¥ params æ˜¯å¦å­˜åœ¨\nif (!msg.params) {\n    msg.params = [];\n}\n\n// æ—¥èªŒè¼¸å‡º\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// è¨­å®šç‹€æ…‹\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog(`[SQL] é¡å‹: ${msg.query_type}, åƒæ•¸: ${JSON.stringify(msg.params)}`);\n\ntry {\n    switch (msg.query_type) {\n        // ========================================\n        // ç³»çµ±ç®¡ç† SQL\n        // ========================================\n        case 'test_connection':\n            msg.query = 'SELECT version(), current_database();';\n            msg.params = [];\n            log('[SQL] æ¸¬è©¦è³‡æ–™åº«é€£ç·š');\n            break;\n\n        case 'list_tables':\n            msg.query = `\n                SELECT table_name \n                FROM information_schema.tables \n                WHERE table_schema = 'public' \n                ORDER BY table_name;\n            `;\n            msg.params = [];\n            log('[SQL] åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨');\n            break;\n\n        // ========================================\n        // åŠŸç‡æ•¸æ“šæ“ä½œ\n        // ========================================\n        case 'insert_power_data':\n            // ç¢ºä¿æœ‰ 7 å€‹åƒæ•¸\n            while (msg.params.length < 7) {\n                msg.params.push(null);\n            }\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                    pg = EXCLUDED.pg,\n                    pa = EXCLUDED.pa,\n                    pp = EXCLUDED.pp,\n                    pga_efficiency = EXCLUDED.pga_efficiency,\n                    pgp_efficiency = EXCLUDED.pgp_efficiency\n                RETURNING id;\n            `;\n            log(`[SQL] æ’å…¥åŠŸç‡æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'batch_insert_power_data':\n            // æ‰¹æ¬¡æ’å…¥\n            if (msg.batch_data && Array.isArray(msg.batch_data) && msg.batch_data.length > 0) {\n                const values = msg.batch_data.map((data, idx) => {\n                    const offset = idx * 7;\n                    return `($${offset + 1}, $${offset + 2}, $${offset + 3}, $${offset + 4}, $${offset + 5}, $${offset + 6}, $${offset + 7})`;\n                }).join(',');\n\n                msg.query = `\n                    INSERT INTO power_data \n                    (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                    VALUES ${values}\n                    ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                        pg = EXCLUDED.pg,\n                        pa = EXCLUDED.pa,\n                        pp = EXCLUDED.pp,\n                        pga_efficiency = EXCLUDED.pga_efficiency,\n                        pgp_efficiency = EXCLUDED.pgp_efficiency\n                    RETURNING id;\n                `;\n                msg.params = msg.batch_data.flat();\n                log(`[SQL] æ‰¹æ¬¡æ’å…¥ ${msg.batch_data.length} ç­†æ•¸æ“š`);\n            } else {\n                log('[SQL] æ‰¹æ¬¡æ’å…¥å¤±æ•—ï¼šç„¡æœ‰æ•ˆæ•¸æ“š');\n                msg.query = null;\n            }\n            break;\n\n        case 'get_latest_data':\n            // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹åƒæ•¸\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            if (msg.params.length < 2) {\n                msg.params.push(10);\n            }\n            msg.query = `\n                SELECT * FROM power_data\n                WHERE device_id = $1\n                ORDER BY timestamp DESC\n                LIMIT $2;\n            `;\n            log(`[SQL] æŸ¥è©¢æœ€æ–°æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'get_data_by_timerange':\n            if (msg.params.length < 3) {\n                log('[SQL] æ™‚é–“ç¯„åœæŸ¥è©¢éœ€è¦ 3 å€‹åƒæ•¸');\n                msg.query = null;\n            } else {\n                msg.query = `\n                    SELECT * FROM power_data\n                    WHERE device_id = $1 \n                    AND timestamp BETWEEN $2 AND $3\n                    ORDER BY timestamp DESC;\n                `;\n                log(`[SQL] æŸ¥è©¢æ™‚é–“ç¯„åœæ•¸æ“š: ${msg.params[0]}`);\n            }\n            break;\n\n        // ========================================\n        // è¨­å‚™ç®¡ç†\n        // ========================================\n        case 'update_device_status':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                UPDATE devices \n                SET last_seen = CURRENT_TIMESTAMP\n                WHERE device_id = $1\n                RETURNING device_id, last_seen;\n            `;\n            log(`[SQL] æ›´æ–°è¨­å‚™ç‹€æ…‹: ${msg.params[0]}`);\n            break;\n\n        case 'upsert_device':\n            while (msg.params.length < 3) {\n                msg.params.push('');\n            }\n            msg.query = `\n                INSERT INTO devices (device_id, device_name, location)\n                VALUES ($1, $2, $3)\n                ON CONFLICT (device_id) \n                DO UPDATE SET \n                    device_name = EXCLUDED.device_name,\n                    location = EXCLUDED.location,\n                    last_seen = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] è¨»å†Š/æ›´æ–°è¨­å‚™: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_devices':\n            msg.query = `\n                SELECT \n                    d.*,\n                    c.factor_a,\n                    c.factor_p,\n                    (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                ORDER BY d.device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹');\n            break;\n\n        // ========================================\n        // é…ç½®ç®¡ç†ï¼ˆç§»é™¤ pizeroï¼‰\n        // ========================================\n        case 'get_config':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    device_id,\n                    factor_a,\n                    factor_p,\n                    updated_at\n                FROM config\n                WHERE device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢é…ç½®: ${msg.params[0]}`);\n            break;\n\n        case 'update_config':\n            // ç¢ºä¿æœ‰ 3 å€‹åƒæ•¸ï¼ˆç§»é™¤ pizero_on, pizero_offï¼‰\n            while (msg.params.length < 3) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else {\n                    msg.params.push(1.0);\n                }\n            }\n            msg.query = `\n                INSERT INTO config \n                (device_id, factor_a, factor_p, updated_at)\n                VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    factor_a = EXCLUDED.factor_a,\n                    factor_p = EXCLUDED.factor_p,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] æ›´æ–°é…ç½®: ${msg.params[0]}`);\n            log(`[SQL]   Factor_A: ${msg.params[1]}`);\n            log(`[SQL]   Factor_P: ${msg.params[2]}`);\n            break;\n\n        case 'get_device_info':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    d.device_id,\n                    d.device_name,\n                    d.location,\n                    d.last_seen,\n                    c.factor_a,\n                    c.factor_p\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                WHERE d.device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢è¨­å‚™å®Œæ•´è³‡è¨Š: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // çµ±è¨ˆæŸ¥è©¢\n        // ========================================\n        case 'get_hourly_stats':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE_TRUNC('hour', timestamp) as hour,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    MAX(pg) as max_pg,\n                    MIN(pg) as min_pg,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '24 hours'\n                GROUP BY hour, device_id\n                ORDER BY hour DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢å°æ™‚çµ±è¨ˆ: ${msg.params[0]}`);\n            break;\n\n        case 'get_daily_summary':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE(timestamp) as date,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    SUM(pg) as total_pg,\n                    AVG(pga_efficiency) as avg_pga_eff,\n                    AVG(pgp_efficiency) as avg_pgp_eff,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '30 days'\n                GROUP BY date, device_id\n                ORDER BY date DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢æ¯æ—¥ç¸½çµ: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // GPS ä½ç½®ç®¡ç†\n        // ========================================\n        case 'upsert_gps_location':\n            while (msg.params.length < 6) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else if (msg.params.length <= 2) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 3) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 4) {\n                    msg.params.push(0);\n                } else {\n                    msg.params.push(new Date().toISOString());\n                }\n            }\n\n            msg.query = `\n                INSERT INTO gps_locations \n                (device_id, latitude, longitude, altitude, satellites, timestamp)\n                VALUES ($1, $2, $3, $4, $5, $6)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    latitude = EXCLUDED.latitude,\n                    longitude = EXCLUDED.longitude,\n                    altitude = EXCLUDED.altitude,\n                    satellites = EXCLUDED.satellites,\n                    timestamp = EXCLUDED.timestamp,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n\n            log(`[SQL] æ’å…¥/æ›´æ–° GPS: ${msg.params[0]} (${msg.params[1]}, ${msg.params[2]})`);\n            break;\n\n        case 'get_gps_location':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                WHERE device_id = $1;\n            `;\n\n            log(`[SQL] æŸ¥è©¢ GPS: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_gps_locations':\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                ORDER BY device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰ GPS');\n            break;\n\n        case 'create_gps_table':\n            msg.query = `\n                CREATE TABLE IF NOT EXISTS gps_locations (\n                    id SERIAL PRIMARY KEY,\n                    device_id VARCHAR(50) NOT NULL,\n                    latitude DOUBLE PRECISION NOT NULL,\n                    longitude DOUBLE PRECISION NOT NULL,\n                    altitude DOUBLE PRECISION DEFAULT 0,\n                    satellites INTEGER DEFAULT 0,\n                    timestamp TIMESTAMP NOT NULL,\n                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    CONSTRAINT unique_device_gps UNIQUE (device_id)\n                );\n                \n                CREATE INDEX IF NOT EXISTS idx_gps_device ON gps_locations(device_id);\n                CREATE INDEX IF NOT EXISTS idx_gps_timestamp ON gps_locations(timestamp DESC);\n            `;\n            msg.params = [];\n            log('[SQL] å»ºç«‹ GPS è¡¨æ ¼');\n            break;\n\n        // ========================================\n        // æ¸¬è©¦æ•¸æ“š\n        // ========================================\n        case 'insert_test_data':\n            const now = new Date();\n            const deviceId = msg.params[0] || '6002';\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                RETURNING *;\n            `;\n            msg.params = [\n                deviceId,\n                now.toISOString(),\n                Math.floor(Math.random() * 50) + 150,\n                Math.floor(Math.random() * 50) + 200,\n                Math.floor(Math.random() * 50) + 180,\n                Math.random() * 20 + 30,\n                Math.random() * 20 + 20\n            ];\n            log('[SQL] æ’å…¥æ¸¬è©¦æ•¸æ“š');\n            break;\n\n        default:\n            log(`[SQL] æœªè™•ç†çš„æŸ¥è©¢é¡å‹: ${msg.query_type}`);\n            msg.query = null;\n            break;\n    }\n\n    // è¨­å®šç‹€æ…‹\n    if (msg.query) {\n        setStatus(\"green\", \"dot\", `SQL: ${msg.query_type}`);\n    } else {\n        setStatus(\"yellow\", \"ring\", \"ç„¡ SQL\");\n    }\n\n} catch (error) {\n    log(`[SQL] éŒ¯èª¤: ${error.message}`);\n    msg.error = error.message;\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n}\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„æŸ¥è©¢é¡å‹æ¸…å–®\n// =================================================================\n//\n// ã€ç³»çµ±ç®¡ç†ã€‘\n//   test_connection, list_tables, create_gps_table\n//\n// ã€åŠŸç‡æ•¸æ“šã€‘\n//   insert_power_data, batch_insert_power_data, \n//   get_latest_data, get_data_by_timerange\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   update_device_status, upsert_device, get_all_devices\n//\n// ã€é…ç½®ç®¡ç†ã€‘ï¼ˆç§»é™¤ pizeroï¼‰\n//   get_config, update_config, get_device_info\n//\n// ã€çµ±è¨ˆæŸ¥è©¢ã€‘\n//   get_hourly_stats, get_daily_summary\n//\n// ã€GPS ä½ç½®ã€‘\n//   upsert_gps_location, get_gps_location, get_all_gps_locations\n//\n// ã€æ¸¬è©¦ã€‘\n//   insert_test_data\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 700,
        "wires": [
            [
                "400276d4bcaa5d90"
            ]
        ]
    },
    {
        "id": "d96f189b2b19cb3d",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "SQLç”Ÿæˆå™¨",
        "func": "// =================================================================\n// å‹•æ…‹ SQL ç”Ÿæˆå™¨ - çµ±ä¸€ç‰ˆï¼ˆç§»é™¤ pizeroï¼‰\n// ç‰ˆæœ¬: V5.0\n// é©ç”¨æ–¼ç¨ç«‹ solar_db è³‡æ–™åº«\n// \n// æ•´åˆæ‰€æœ‰ SQL æ“ä½œï¼š\n// - åŠŸç‡æ•¸æ“šã€GPSã€é…ç½®ã€è¨­å‚™ç‹€æ…‹ã€çµ±è¨ˆ\n// =================================================================\n\n// ç¢ºä¿ msg ç‰©ä»¶å­˜åœ¨\nif (!msg) {\n    msg = {};\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºè³‡æ–™åº«æ“ä½œ\nif (!msg.query_type) {\n    return msg;\n}\n\n// æª¢æŸ¥ params æ˜¯å¦å­˜åœ¨\nif (!msg.params) {\n    msg.params = [];\n}\n\n// æ—¥èªŒè¼¸å‡º\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// è¨­å®šç‹€æ…‹\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog(`[SQL] é¡å‹: ${msg.query_type}, åƒæ•¸: ${JSON.stringify(msg.params)}`);\n\ntry {\n    switch (msg.query_type) {\n        // ========================================\n        // ç³»çµ±ç®¡ç† SQL\n        // ========================================\n        case 'test_connection':\n            msg.query = 'SELECT version(), current_database();';\n            msg.params = [];\n            log('[SQL] æ¸¬è©¦è³‡æ–™åº«é€£ç·š');\n            break;\n\n        case 'list_tables':\n            msg.query = `\n                SELECT table_name \n                FROM information_schema.tables \n                WHERE table_schema = 'public' \n                ORDER BY table_name;\n            `;\n            msg.params = [];\n            log('[SQL] åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨');\n            break;\n\n        // ========================================\n        // åŠŸç‡æ•¸æ“šæ“ä½œ\n        // ========================================\n        case 'insert_power_data':\n            // ç¢ºä¿æœ‰ 7 å€‹åƒæ•¸\n            while (msg.params.length < 7) {\n                msg.params.push(null);\n            }\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                    pg = EXCLUDED.pg,\n                    pa = EXCLUDED.pa,\n                    pp = EXCLUDED.pp,\n                    pga_efficiency = EXCLUDED.pga_efficiency,\n                    pgp_efficiency = EXCLUDED.pgp_efficiency\n                RETURNING id;\n            `;\n            log(`[SQL] æ’å…¥åŠŸç‡æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'batch_insert_power_data':\n            // æ‰¹æ¬¡æ’å…¥\n            if (msg.batch_data && Array.isArray(msg.batch_data) && msg.batch_data.length > 0) {\n                const values = msg.batch_data.map((data, idx) => {\n                    const offset = idx * 7;\n                    return `($${offset + 1}, $${offset + 2}, $${offset + 3}, $${offset + 4}, $${offset + 5}, $${offset + 6}, $${offset + 7})`;\n                }).join(',');\n\n                msg.query = `\n                    INSERT INTO power_data \n                    (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                    VALUES ${values}\n                    ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                        pg = EXCLUDED.pg,\n                        pa = EXCLUDED.pa,\n                        pp = EXCLUDED.pp,\n                        pga_efficiency = EXCLUDED.pga_efficiency,\n                        pgp_efficiency = EXCLUDED.pgp_efficiency\n                    RETURNING id;\n                `;\n                msg.params = msg.batch_data.flat();\n                log(`[SQL] æ‰¹æ¬¡æ’å…¥ ${msg.batch_data.length} ç­†æ•¸æ“š`);\n            } else {\n                log('[SQL] æ‰¹æ¬¡æ’å…¥å¤±æ•—ï¼šç„¡æœ‰æ•ˆæ•¸æ“š');\n                msg.query = null;\n            }\n            break;\n\n        case 'get_latest_data':\n            // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹åƒæ•¸\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            if (msg.params.length < 2) {\n                msg.params.push(10);\n            }\n            msg.query = `\n                SELECT * FROM power_data\n                WHERE device_id = $1\n                ORDER BY timestamp DESC\n                LIMIT $2;\n            `;\n            log(`[SQL] æŸ¥è©¢æœ€æ–°æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'get_data_by_timerange':\n            if (msg.params.length < 3) {\n                log('[SQL] æ™‚é–“ç¯„åœæŸ¥è©¢éœ€è¦ 3 å€‹åƒæ•¸');\n                msg.query = null;\n            } else {\n                msg.query = `\n                    SELECT * FROM power_data\n                    WHERE device_id = $1 \n                    AND timestamp BETWEEN $2 AND $3\n                    ORDER BY timestamp DESC;\n                `;\n                log(`[SQL] æŸ¥è©¢æ™‚é–“ç¯„åœæ•¸æ“š: ${msg.params[0]}`);\n            }\n            break;\n\n        // ========================================\n        // è¨­å‚™ç®¡ç†\n        // ========================================\n        case 'update_device_status':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                UPDATE devices \n                SET last_seen = CURRENT_TIMESTAMP\n                WHERE device_id = $1\n                RETURNING device_id, last_seen;\n            `;\n            log(`[SQL] æ›´æ–°è¨­å‚™ç‹€æ…‹: ${msg.params[0]}`);\n            break;\n\n        case 'upsert_device':\n            while (msg.params.length < 3) {\n                msg.params.push('');\n            }\n            msg.query = `\n                INSERT INTO devices (device_id, device_name, location)\n                VALUES ($1, $2, $3)\n                ON CONFLICT (device_id) \n                DO UPDATE SET \n                    device_name = EXCLUDED.device_name,\n                    location = EXCLUDED.location,\n                    last_seen = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] è¨»å†Š/æ›´æ–°è¨­å‚™: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_devices':\n            msg.query = `\n                SELECT \n                    d.*,\n                    c.factor_a,\n                    c.factor_p,\n                    (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                ORDER BY d.device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹');\n            break;\n\n        // ========================================\n        // é…ç½®ç®¡ç†ï¼ˆç§»é™¤ pizeroï¼‰\n        // ========================================\n        case 'get_config':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    device_id,\n                    factor_a,\n                    factor_p,\n                    updated_at\n                FROM config\n                WHERE device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢é…ç½®: ${msg.params[0]}`);\n            break;\n\n        case 'update_config':\n            // ç¢ºä¿æœ‰ 3 å€‹åƒæ•¸ï¼ˆç§»é™¤ pizero_on, pizero_offï¼‰\n            while (msg.params.length < 3) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else {\n                    msg.params.push(1.0);\n                }\n            }\n            msg.query = `\n                INSERT INTO config \n                (device_id, factor_a, factor_p, updated_at)\n                VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    factor_a = EXCLUDED.factor_a,\n                    factor_p = EXCLUDED.factor_p,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] æ›´æ–°é…ç½®: ${msg.params[0]}`);\n            log(`[SQL]   Factor_A: ${msg.params[1]}`);\n            log(`[SQL]   Factor_P: ${msg.params[2]}`);\n            break;\n\n        case 'get_device_info':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    d.device_id,\n                    d.device_name,\n                    d.location,\n                    d.last_seen,\n                    c.factor_a,\n                    c.factor_p\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                WHERE d.device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢è¨­å‚™å®Œæ•´è³‡è¨Š: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // çµ±è¨ˆæŸ¥è©¢\n        // ========================================\n        case 'get_hourly_stats':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE_TRUNC('hour', timestamp) as hour,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    MAX(pg) as max_pg,\n                    MIN(pg) as min_pg,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '24 hours'\n                GROUP BY hour, device_id\n                ORDER BY hour DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢å°æ™‚çµ±è¨ˆ: ${msg.params[0]}`);\n            break;\n\n        case 'get_daily_summary':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE(timestamp) as date,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    SUM(pg) as total_pg,\n                    AVG(pga_efficiency) as avg_pga_eff,\n                    AVG(pgp_efficiency) as avg_pgp_eff,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '30 days'\n                GROUP BY date, device_id\n                ORDER BY date DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢æ¯æ—¥ç¸½çµ: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // GPS ä½ç½®ç®¡ç†\n        // ========================================\n        case 'upsert_gps_location':\n            while (msg.params.length < 6) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else if (msg.params.length <= 2) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 3) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 4) {\n                    msg.params.push(0);\n                } else {\n                    msg.params.push(new Date().toISOString());\n                }\n            }\n\n            msg.query = `\n                INSERT INTO gps_locations \n                (device_id, latitude, longitude, altitude, satellites, timestamp)\n                VALUES ($1, $2, $3, $4, $5, $6)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    latitude = EXCLUDED.latitude,\n                    longitude = EXCLUDED.longitude,\n                    altitude = EXCLUDED.altitude,\n                    satellites = EXCLUDED.satellites,\n                    timestamp = EXCLUDED.timestamp,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n\n            log(`[SQL] æ’å…¥/æ›´æ–° GPS: ${msg.params[0]} (${msg.params[1]}, ${msg.params[2]})`);\n            break;\n\n        case 'get_gps_location':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                WHERE device_id = $1;\n            `;\n\n            log(`[SQL] æŸ¥è©¢ GPS: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_gps_locations':\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                ORDER BY device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰ GPS');\n            break;\n\n        case 'create_gps_table':\n            msg.query = `\n                CREATE TABLE IF NOT EXISTS gps_locations (\n                    id SERIAL PRIMARY KEY,\n                    device_id VARCHAR(50) NOT NULL,\n                    latitude DOUBLE PRECISION NOT NULL,\n                    longitude DOUBLE PRECISION NOT NULL,\n                    altitude DOUBLE PRECISION DEFAULT 0,\n                    satellites INTEGER DEFAULT 0,\n                    timestamp TIMESTAMP NOT NULL,\n                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    CONSTRAINT unique_device_gps UNIQUE (device_id)\n                );\n                \n                CREATE INDEX IF NOT EXISTS idx_gps_device ON gps_locations(device_id);\n                CREATE INDEX IF NOT EXISTS idx_gps_timestamp ON gps_locations(timestamp DESC);\n            `;\n            msg.params = [];\n            log('[SQL] å»ºç«‹ GPS è¡¨æ ¼');\n            break;\n\n        // ========================================\n        // æ¸¬è©¦æ•¸æ“š\n        // ========================================\n        case 'insert_test_data':\n            const now = new Date();\n            const deviceId = msg.params[0] || '6002';\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                RETURNING *;\n            `;\n            msg.params = [\n                deviceId,\n                now.toISOString(),\n                Math.floor(Math.random() * 50) + 150,\n                Math.floor(Math.random() * 50) + 200,\n                Math.floor(Math.random() * 50) + 180,\n                Math.random() * 20 + 30,\n                Math.random() * 20 + 20\n            ];\n            log('[SQL] æ’å…¥æ¸¬è©¦æ•¸æ“š');\n            break;\n\n        default:\n            log(`[SQL] æœªè™•ç†çš„æŸ¥è©¢é¡å‹: ${msg.query_type}`);\n            msg.query = null;\n            break;\n    }\n\n    // è¨­å®šç‹€æ…‹\n    if (msg.query) {\n        setStatus(\"green\", \"dot\", `SQL: ${msg.query_type}`);\n    } else {\n        setStatus(\"yellow\", \"ring\", \"ç„¡ SQL\");\n    }\n\n} catch (error) {\n    log(`[SQL] éŒ¯èª¤: ${error.message}`);\n    msg.error = error.message;\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n}\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„æŸ¥è©¢é¡å‹æ¸…å–®\n// =================================================================\n//\n// ã€ç³»çµ±ç®¡ç†ã€‘\n//   test_connection, list_tables, create_gps_table\n//\n// ã€åŠŸç‡æ•¸æ“šã€‘\n//   insert_power_data, batch_insert_power_data, \n//   get_latest_data, get_data_by_timerange\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   update_device_status, upsert_device, get_all_devices\n//\n// ã€é…ç½®ç®¡ç†ã€‘ï¼ˆç§»é™¤ pizeroï¼‰\n//   get_config, update_config, get_device_info\n//\n// ã€çµ±è¨ˆæŸ¥è©¢ã€‘\n//   get_hourly_stats, get_daily_summary\n//\n// ã€GPS ä½ç½®ã€‘\n//   upsert_gps_location, get_gps_location, get_all_gps_locations\n//\n// ã€æ¸¬è©¦ã€‘\n//   insert_test_data\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 510,
        "y": 1100,
        "wires": [
            [
                "76b49a369e222f62"
            ]
        ]
    },
    {
        "id": "76b49a369e222f62",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 690,
        "y": 1100,
        "wires": [
            [
                "7da3f2087ba1505c",
                "c64de7ea6674c63a"
            ]
        ]
    },
    {
        "id": "c64aee4cdae4761a",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 930,
        "y": 1180,
        "wires": [
            [
                "12d85328bb538f23"
            ]
        ]
    },
    {
        "id": "7da3f2087ba1505c",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "é…ç½®åŒæ­¥å™¨",
        "func": "// é…ç½®åŒæ­¥å™¨ V3.0 - ç§»é™¤ pizero åŠŸèƒ½\n// è¼¸å…¥: PostgreSQL æŸ¥è©¢çµæœ\n// è¼¸å‡º: 1å€‹ (MQTT é€šçŸ¥)\n\nconst log = (msg) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(msg);\n    }\n};\n\n// ========== 1. æª¢æŸ¥æŸ¥è©¢çµæœ ==========\nif (!msg.payload || msg.payload.length === 0) {\n    log('[Config] ç„¡é…ç½®è³‡æ–™ï¼Œä½¿ç”¨é è¨­å€¼');\n\n    const defaultConfig = {\n        device_id: msg.params ? msg.params[0] : '6002',\n        factor_a: 1.0,\n        factor_p: 1.0\n    };\n\n    msg.payload = [defaultConfig];\n}\n\n// ========== 2. å–å¾—é…ç½® ==========\nconst config = msg.payload[0];\nconst deviceId = config.device_id || '6002';\nconst factorA = parseFloat(config.factor_a) || 1.0;\nconst factorP = parseFloat(config.factor_p) || 1.0;\n\nlog(`[Config] è¨­å‚™: ${deviceId}`);\nlog(`[Config] Factor_A: ${factorA}`);\nlog(`[Config] Factor_P: ${factorP}`);\n\n// ========== 3. å„²å­˜åˆ° flow context ==========\nconst factorKey = `factor_${deviceId}`;\nconst configData = {\n    factor_a: factorA,\n    factor_p: factorP,\n    updated_at: new Date().toISOString()\n};\n\nflow.set(factorKey, configData);\n\nlog(`[Config] âœ… å·²å„²å­˜åˆ° flow.${factorKey}`);\n\n// ========== 4. æº–å‚™ MQTT é€šçŸ¥ ==========\nconst mqttOutput = {\n    topic: `solar/${deviceId}/config/updated`,\n    payload: JSON.stringify({\n        device_id: deviceId,\n        factor_a: factorA,\n        factor_p: factorP,\n        timestamp: configData.updated_at,\n        message: 'é…ç½®å·²æ›´æ–°'\n    }),\n    qos: 1,\n    retain: false\n};\n\n// ========== 5. è¨­å®šç¯€é»ç‹€æ…‹ ==========\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `âœ… ${deviceId}: A=${factorA} P=${factorP}`\n});\n\nlog(`[Config] âœ… é…ç½®åŒæ­¥å®Œæˆ`);\n\n// ========== 6. è¿”å›è¼¸å‡º ==========\nreturn mqttOutput;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1000,
        "wires": [
            [
                "a55e6d02d1b233b9"
            ]
        ]
    },
    {
        "id": "a55e6d02d1b233b9",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "Send Config",
        "topic": "",
        "qos": "1",
        "retain": "true",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 1090,
        "y": 1000,
        "wires": []
    },
    {
        "id": "7daaff891e9f2c6c",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "GPSæ•¸æ“šæ¨¡æ“¬å™¨",
        "func": "// ====================================================================\n// GPS æ•¸æ“šæ¨¡æ“¬å™¨ - æ¨¡æ“¬ Pico W ç™¼é€åˆ° solar/6002/gps\n// æ”¾ç½®ä½ç½®: Injectç¯€é» â†’ [é€™è£¡] â†’ MQTT Out (solar/6002/gps)\n// è¼¸å‡ºæ ¼å¼: \"25.033671,121.564427,100.5,8\"\n// ====================================================================\n\n// === è¨­å®š ===\nconst DEVICE_ID = \"6002\";  // è¨­å‚™ ID\nconst USE_RANDOM_LOCATION = false;  // true=éš¨æ©Ÿä½ç½®ï¼Œfalse=å›ºå®šä½ç½®\n\n// === å›ºå®šä½ç½®ï¼ˆå°åŒ—ï¼‰ ===\nlet latitude = 25.033671;\nlet longitude = 121.564427;\nlet altitude = 100.5;\nlet satellites = 8;\n\n// === æˆ–ä½¿ç”¨éš¨æ©Ÿä½ç½®ï¼ˆæ¨¡æ“¬GPSæ¼‚ç§»ï¼‰===\nif (USE_RANDOM_LOCATION) {\n    // å°ç£ç¯„åœå…§éš¨æ©Ÿä½ç½®\n    latitude = 22.0 + Math.random() * 3.5;   // 22-25.5N\n    longitude = 120.0 + Math.random() * 2.5;  // 120-122.5E\n    altitude = Math.random() * 200;           // 0-200m\n    satellites = Math.floor(6 + Math.random() * 6);  // 6-12 é¡†è¡›æ˜Ÿ\n}\n\n// æ¨¡æ“¬å°å¹…åº¦GPSæ¼‚ç§»ï¼ˆÂ±10ç±³ï¼‰\nif (!USE_RANDOM_LOCATION) {\n    latitude += (Math.random() - 0.5) * 0.0001;  // Â±10m\n    longitude += (Math.random() - 0.5) * 0.0001;\n}\n\n// === çµ„åˆ GPS æ•¸æ“š ===\n// æ ¼å¼: \"ç·¯åº¦,ç¶“åº¦,æµ·æ‹”,è¡›æ˜Ÿæ•¸\"\nconst payload = `${latitude.toFixed(6)},${longitude.toFixed(6)},${altitude.toFixed(1)},${satellites}`;\n\n// === è¨­å®š MQTT è¨Šæ¯ ===\nmsg.topic = `solar/${DEVICE_ID}/gps`;\nmsg.payload = payload;  // æ³¨æ„ï¼šä¸è¦åŠ å¼•è™Ÿï¼\nmsg.qos = 1;\n\n// === æ—¥èªŒè¼¸å‡º ===\nnode.warn(`[GPS Sim] è¨­å‚™: ${DEVICE_ID}`);\nnode.warn(`[GPS Sim] åº§æ¨™: (${latitude.toFixed(6)}, ${longitude.toFixed(6)})`);\nnode.warn(`[GPS Sim] é«˜åº¦: ${altitude.toFixed(1)}m`);\nnode.warn(`[GPS Sim] è¡›æ˜Ÿ: ${satellites} é¡†`);\nnode.warn(`[GPS Sim] å®Œæ•´æ•¸æ“š: ${payload}`);\n\n// è¨­å®šç¯€é»ç‹€æ…‹\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: `GPS: ${satellites}è¡›æ˜Ÿ`\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 300,
        "wires": [
            [
                "112962b56cd7b80e"
            ]
        ]
    },
    {
        "id": "c51a3a1234503394",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "è¨­å‚™ç‹€æ…‹æ¨¡æ“¬å™¨",
        "func": "// ====================================================================\n// è¨­å‚™ç‹€æ…‹æ¨¡æ“¬å™¨ - æ¨¡æ“¬ Pico W ç™¼é€åˆ° solar/6002/status\n// æ”¾ç½®ä½ç½®: Injectç¯€é» â†’ [é€™è£¡] â†’ MQTT Out (solar/6002/status)\n// è¼¸å‡ºæ ¼å¼: \"online\" æˆ– \"sleeping\"\n// ====================================================================\n\n// === è¨­å®š ===\nconst DEVICE_ID = \"6002\";\n\n// === æ ¹æ“šæ™‚é–“åˆ¤æ–·ç‹€æ…‹ ===\nconst hour = new Date().getHours();\nlet status;\n\n// å¤œé–“ä¼‘çœ ï¼ˆ19:00 - 06:00ï¼‰\nif (hour >= 19 || hour < 6) {\n    status = \"sleeping\";\n} else {\n    status = \"online\";\n}\n\n// === è¨­å®š MQTT è¨Šæ¯ ===\nmsg.topic = `solar/${DEVICE_ID}/status`;\nmsg.payload = status;\nmsg.qos = 1;\n\n// === æ—¥èªŒè¼¸å‡º ===\nnode.warn(`[Status Sim] è¨­å‚™: ${DEVICE_ID}`);\nnode.warn(`[Status Sim] ç‹€æ…‹: ${status}`);\nnode.warn(`[Status Sim] æ™‚é–“: ${hour}:00`);\n\n// è¨­å®šç¯€é»ç‹€æ…‹\nconst statusColor = status === \"online\" ? \"green\" : \"yellow\";\nnode.status({\n    fill: statusColor,\n    shape: \"dot\",\n    text: status\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 360,
        "wires": [
            [
                "75f46cbb8bd96ba9"
            ]
        ]
    },
    {
        "id": "112962b56cd7b80e",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "MQTT GPS TEST",
        "topic": "solar/6002/gps",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 590,
        "y": 300,
        "wires": []
    },
    {
        "id": "75f46cbb8bd96ba9",
        "type": "mqtt out",
        "z": "4f2c9b23a074cc9b",
        "name": "MQTT STATUS TEST",
        "topic": "solar/6002/status",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "1de931c467a32710",
        "x": 600,
        "y": 360,
        "wires": []
    },
    {
        "id": "8d088dee2736b11f",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 300,
        "wires": [
            [
                "7daaff891e9f2c6c"
            ]
        ]
    },
    {
        "id": "71391105925abf49",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 360,
        "wires": [
            [
                "c51a3a1234503394"
            ]
        ]
    },
    {
        "id": "6b7b65eeb11cd30f",
        "type": "ui-chart",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "name": "PG ",
        "label": "chart",
        "order": 2,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "0",
        "ymax": "500",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": "4",
        "showLegend": true,
        "removeOlder": "60",
        "removeOlderUnit": "60",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#0095ff"
        ],
        "gridColorDefault": false,
        "width": 4,
        "height": 5,
        "className": "",
        "interpolation": "linear",
        "x": 650,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "b8c1b92e2877575f",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æ ¼å¼åŒ–åœ–è¡¨æ•¸æ“š",
        "func": "// =================================================================\n// æ ¼å¼åŒ–å›¾è¡¨æ•°æ® - é…å¥—è§£æå™¨è¾“å‡ºç‰ˆ V10.0\n// ä½ç½®ï¼šæ•°æ®è§£æå™¨ Output 2 â†’ [è¿™é‡Œ] â†’ 5ä¸ª ui-chart\n// \n// è¾“å…¥æ ¼å¼ï¼šmsg.payload = {\n//     deviceId, timestamp, unixTimestamp, pg, pa, pp, pag, ppg\n// }\n// \n// è¾“å‡ºæ•°é‡ï¼š5\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\n// ========== æ­¥éª¤ 1: éªŒè¯è¾“å…¥ ==========\nif (!msg.payload) {\n    log('[Chart Formatter] âŒ msg.payload ä¸å­˜åœ¨');\n    setStatus(\"red\", \"ring\", \"æ— æ•°æ®\");\n    return [null, null, null, null, null];\n}\n\nconst data = msg.payload;\n\nlog('[Chart Formatter] ========================================');\nlog('[Chart Formatter] å¼€å§‹æ ¼å¼åŒ–å›¾è¡¨æ•°æ®');\nlog('[Chart Formatter] ========================================');\n\n// åˆ—å‡ºæ•°æ®å­—æ®µ\nlog('[Chart Formatter] ğŸ“¦ æ¥æ”¶åˆ°çš„æ•°æ®:');\nObject.keys(data).forEach(key => {\n    log(`[Chart Formatter]    ${key}: ${data[key]}`);\n});\n\n// ========== æ­¥éª¤ 2: æå–æ—¶é—´æˆ³ ==========\nlet timestampValue;\n\n// ä¼˜å…ˆä½¿ç”¨ unixTimestampï¼ˆæ¯«ç§’ï¼‰\nif (data.unixTimestamp) {\n    timestampValue = data.unixTimestamp;\n    log(`[Chart Formatter] â° ä½¿ç”¨ unixTimestamp: ${timestampValue}`);\n}\n// å¤‡é€‰ï¼šä½¿ç”¨ timestamp å­—ç¬¦ä¸²\nelse if (data.timestamp) {\n    try {\n        timestampValue = new Date(data.timestamp).getTime();\n        log(`[Chart Formatter] â° ä» timestamp è½¬æ¢: ${timestampValue}`);\n    } catch (error) {\n        log(`[Chart Formatter] âŒ æ—¶é—´æˆ³è½¬æ¢å¤±è´¥: ${error.message}`);\n        timestampValue = Date.now();\n    }\n}\n// æœ€åå¤‡é€‰ï¼šå½“å‰æ—¶é—´\nelse {\n    log('[Chart Formatter] âš ï¸ æ— æ—¶é—´æˆ³ï¼Œä½¿ç”¨å½“å‰æ—¶é—´');\n    timestampValue = Date.now();\n}\n\n// éªŒè¯æ—¶é—´æˆ³\nif (isNaN(timestampValue) || timestampValue <= 0) {\n    log(`[Chart Formatter] âŒ æ—¶é—´æˆ³æ— æ•ˆ: ${timestampValue}`);\n    setStatus(\"red\", \"ring\", \"æ—¶é—´é”™è¯¯\");\n    return [null, null, null, null, null];\n}\n\n// ç¡®ä¿æ˜¯æ¯«ç§’çº§\nif (timestampValue < 10000000000) {\n    timestampValue = timestampValue * 1000;\n    log(`[Chart Formatter] â° ç§’çº§è½¬æ¯«ç§’: ${timestampValue}`);\n}\n\nconst formattedTime = new Date(timestampValue).toLocaleString('zh-TW');\nlog(`[Chart Formatter] âœ… æ—¶é—´æˆ³: ${timestampValue} (${formattedTime})`);\n\n// ========== æ­¥éª¤ 3: æå–åŠŸç‡å’Œæ•ˆç‡å€¼ ==========\nconst pgValue = parseInt(data.pg) || 0;\nconst paValue = parseInt(data.pa) || 0;\nconst ppValue = parseInt(data.pp) || 0;\nconst pagValue = parseFloat(data.pag) || 0;\nconst ppgValue = parseFloat(data.ppg) || 0;\n\nlog('[Chart Formatter] âš¡ æ•°æ®å€¼:');\nlog(`[Chart Formatter]    PG: ${pgValue}W`);\nlog(`[Chart Formatter]    PA: ${paValue}W`);\nlog(`[Chart Formatter]    PP: ${ppValue}W`);\nlog(`[Chart Formatter]    PAG: ${pagValue.toFixed(2)}%`);\nlog(`[Chart Formatter]    PPG: ${ppgValue.toFixed(2)}%`);\n\n// ========== æ­¥éª¤ 4: æ„å»ºè¾“å‡º ==========\n// å®Œå…¨åŒ¹é… ui-chart Line å›¾çš„é…ç½®ï¼š\n// - Series: msg.topic\n// - X: timestamp\n// - Y: msg.payload\n\nconst output1 = {\n    topic: 'PG',\n    timestamp: timestampValue,\n    payload: pgValue\n};\n\nconst output2 = {\n    topic: 'PA',\n    timestamp: timestampValue,\n    payload: paValue\n};\n\nconst output3 = {\n    topic: 'PP',\n    timestamp: timestampValue,\n    payload: ppValue\n};\n\nconst output4 = {\n    topic: 'PAG',\n    timestamp: timestampValue,\n    payload: pagValue\n};\n\nconst output5 = {\n    topic: 'PPG',\n    timestamp: timestampValue,\n    payload: ppgValue\n};\n\n// ========== æ­¥éª¤ 5: éªŒè¯è¾“å‡º ==========\nlog('[Chart Formatter] ========================================');\nlog('[Chart Formatter] è¾“å‡ºéªŒè¯:');\n\nconst outputs = [\n    [output1, 'PG'],\n    [output2, 'PA'],\n    [output3, 'PP'],\n    [output4, 'PAG'],\n    [output5, 'PPG']\n];\n\nlet allValid = true;\n\noutputs.forEach(([output, name]) => {\n    const checks = {\n        'topicæ˜¯å­—ç¬¦ä¸²': typeof output.topic === 'string',\n        'timestampæ˜¯æ•°å­—': typeof output.timestamp === 'number',\n        'payloadæ˜¯æ•°å­—': typeof output.payload === 'number',\n        'timestampæ˜¯æ¯«ç§’çº§': output.timestamp > 1000000000000,\n        'payloadä¸æ˜¯NaN': !isNaN(output.payload)\n    };\n\n    const valid = Object.values(checks).every(v => v === true);\n\n    if (valid) {\n        log(`[Chart Formatter] âœ… ${name}: éªŒè¯é€šè¿‡`);\n    } else {\n        log(`[Chart Formatter] âŒ ${name}: éªŒè¯å¤±è´¥`);\n        Object.entries(checks).forEach(([desc, pass]) => {\n            if (!pass) {\n                log(`[Chart Formatter]    âœ— ${desc}`);\n            }\n        });\n        allValid = false;\n    }\n});\n\n// ========== æ­¥éª¤ 6: è®¾ç½®çŠ¶æ€ ==========\nif (allValid) {\n    const timeStr = new Date(timestampValue).toLocaleTimeString('zh-TW');\n    setStatus(\"green\", \"dot\", `âœ… ${timeStr} | PG:${pgValue}W`);\n    log('[Chart Formatter] ========================================');\n    log('[Chart Formatter] âœ… å¤„ç†å®Œæˆï¼Œæ‰€æœ‰è¾“å‡ºæœ‰æ•ˆ');\n    log('[Chart Formatter] ========================================');\n} else {\n    setStatus(\"yellow\", \"ring\", \"âš ï¸ éƒ¨åˆ†è¾“å‡ºå¼‚å¸¸\");\n    log('[Chart Formatter] ========================================');\n    log('[Chart Formatter] âš ï¸ å¤„ç†å®Œæˆï¼Œä½†æœ‰è­¦å‘Š');\n    log('[Chart Formatter] ========================================');\n}\n\n// ========== æ­¥éª¤ 7: è¿”å› 5 ä¸ªè¾“å‡º ==========\nreturn [output1, output2, output3, output4, output5];\n\n// =================================================================\n// ğŸ“‹ è¾“å‡ºæ ¼å¼\n// =================================================================\n//\n// æ¯ä¸ªè¾“å‡ºçš„æ ¼å¼ï¼š\n// {\n//     topic: \"PG\",              // å­—ç¬¦ä¸²ï¼šç³»åˆ—åç§°\n//     timestamp: 1697198400000, // æ•°å­—ï¼šUnix æ¯«ç§’æ—¶é—´æˆ³\n//     payload: 146              // æ•°å­—ï¼šåŠŸç‡å€¼æˆ–æ•ˆç‡å€¼\n// }\n//\n// =================================================================\n// ğŸ”Œ è¿æ¥æ–¹å¼\n// =================================================================\n//\n// [æ•°æ®è§£æå™¨ Output 2]\n//     â†“\n// [æ­¤èŠ‚ç‚¹]\n//     â”œâ”€ Output 1 â†’ [ui-chart PG]\n//     â”œâ”€ Output 2 â†’ [ui-chart PA]\n//     â”œâ”€ Output 3 â†’ [ui-chart PP]\n//     â”œâ”€ Output 4 â†’ [ui-chart PAG]\n//     â””â”€ Output 5 â†’ [ui-chart PPG]\n//\n// =================================================================\n// ğŸ¯ ui-chart é…ç½®è¦æ±‚ï¼ˆæ‰€æœ‰ 5 ä¸ªå›¾è¡¨ï¼‰\n// =================================================================\n//\n// Type: Line\n// X-Axis Type: Timescale\n// \n// Properties:\n// - Series: msg.topic\n// - X: timestamp\n// - Y: msg.payload\n//\n// =================================================================",
        "outputs": 5,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 600,
        "wires": [
            [
                "6b7b65eeb11cd30f"
            ],
            [
                "ec08f1b1cac94cbb"
            ],
            [
                "395a7464f335bc68"
            ],
            [
                "f7f7a46fe14de896"
            ],
            [
                "b3deaed4fa918fb4"
            ]
        ]
    },
    {
        "id": "ec08f1b1cac94cbb",
        "type": "ui-chart",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "name": "PA",
        "label": "chart",
        "order": 3,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "0",
        "ymax": "500",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#ff0000"
        ],
        "gridColorDefault": false,
        "width": 4,
        "height": 5,
        "className": "",
        "interpolation": "linear",
        "x": 650,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "395a7464f335bc68",
        "type": "ui-chart",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "name": "PP",
        "label": "chart",
        "order": 4,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "0",
        "ymax": "500",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#ff7f0e"
        ],
        "gridColorDefault": false,
        "width": 4,
        "height": 5,
        "className": "",
        "interpolation": "linear",
        "x": 650,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "f7f7a46fe14de896",
        "type": "ui-chart",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "name": "PAG ",
        "label": "chart",
        "order": 5,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "0",
        "ymax": "100",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#2ca02c"
        ],
        "gridColorDefault": false,
        "width": 6,
        "height": 4,
        "className": "",
        "interpolation": "step",
        "x": 650,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "b3deaed4fa918fb4",
        "type": "ui-chart",
        "z": "4f2c9b23a074cc9b",
        "group": "24c6ae5a937a533f",
        "name": "PPG ",
        "label": "chart",
        "order": 6,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "0",
        "ymax": "100",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#a347e1"
        ],
        "gridColorDefault": false,
        "width": 6,
        "height": 4,
        "className": "",
        "interpolation": "step",
        "x": 650,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "12d85328bb538f23",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æ ¼å¼åŒ–GPS",
        "func": "// =================================================================\n// æ ¼å¼åŒ–GPSçµ¦worldmap - å®Œæ•´ç‰ˆ V3.0\n// ä½ç½®ï¼šSQLç”Ÿæˆå™¨-GPS â†’ PostgreSQL â†’ [é€™è£¡] â†’ worldmap\n// \n// åŠŸèƒ½ï¼šå°‡è³‡æ–™åº«çš„ GPS æ•¸æ“šè½‰æ›ç‚º worldmap æ ¼å¼\n// è¼¸å…¥ï¼šPostgreSQL åŸ·è¡Œçµæœï¼ˆåŒ…å« msg._gps_dataï¼‰\n// è¼¸å‡ºï¼šworldmap æ ¼å¼çš„æ•¸æ“š\n// =================================================================\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog('[GPS Format] ========================================');\n\n// ========== æ­¥é©Ÿ 1: é©—è­‰ PostgreSQL çµæœ ==========\nif (!msg.payload) {\n    log('[GPS Format] âŒ msg.payload ä¸å­˜åœ¨');\n    setStatus(\"red\", \"ring\", \"ç„¡çµæœ\");\n    return null;\n}\n\nif (Array.isArray(msg.payload) && msg.payload.length === 0) {\n    log('[GPS Format] âš ï¸ PostgreSQL è¿”å›ç©ºé™£åˆ—');\n    setStatus(\"yellow\", \"ring\", \"ç„¡æ•¸æ“š\");\n    return null;\n}\n\n// ========== æ­¥é©Ÿ 2: å–å¾— GPS æ•¸æ“š ==========\n// å„ªå…ˆå¾ msg._gps_data å–å¾—ï¼ˆSQLç”Ÿæˆå™¨ä¿å­˜çš„åŸå§‹æ•¸æ“šï¼‰\nlet gps = msg._gps_data;\n\n// å¦‚æœæ²’æœ‰ _gps_dataï¼Œå˜—è©¦å¾ payload å–å¾—\nif (!gps && Array.isArray(msg.payload) && msg.payload.length > 0) {\n    gps = msg.payload[0];  // å–ç¬¬ä¸€ç­†\n    log('[GPS Format] âš ï¸ å¾ payload å–å¾— GPS æ•¸æ“šï¼ˆå‚™æ´ï¼‰');\n}\n\n// æœ€çµ‚é©—è­‰\nif (!gps) {\n    log('[GPS Format] âŒ ç„¡ GPS æ•¸æ“šå¯ç”¨');\n    setStatus(\"red\", \"ring\", \"ç„¡GPS\");\n    return null;\n}\n\n// ========== æ­¥é©Ÿ 3: é©—è­‰ GPS æ•¸æ“šå®Œæ•´æ€§ ==========\nconst requiredFields = ['device_id', 'latitude', 'longitude'];\nconst missingFields = [];\n\nfor (const field of requiredFields) {\n    if (gps[field] === undefined || gps[field] === null) {\n        missingFields.push(field);\n    }\n}\n\nif (missingFields.length > 0) {\n    log(`[GPS Format] âŒ ç¼ºå°‘å¿…è¦æ¬„ä½: ${missingFields.join(', ')}`);\n    setStatus(\"red\", \"ring\", \"æ¬„ä½ç¼ºå¤±\");\n    return null;\n}\n\n// ========== æ­¥é©Ÿ 4: æå–ä¸¦é©—è­‰æ•¸æ“š ==========\nconst deviceId = String(gps.device_id);\nconst latitude = parseFloat(gps.latitude);\nconst longitude = parseFloat(gps.longitude);\nconst altitude = parseFloat(gps.altitude) || 0;\nconst satellites = parseInt(gps.satellites) || 0;\n\n// é©—è­‰åº§æ¨™ç¯„åœ\nif (isNaN(latitude) || isNaN(longitude)) {\n    log('[GPS Format] âŒ åº§æ¨™å€¼ç„¡æ•ˆï¼ˆNaNï¼‰');\n    setStatus(\"red\", \"ring\", \"åº§æ¨™ç„¡æ•ˆ\");\n    return null;\n}\n\nif (latitude < -90 || latitude > 90) {\n    log(`[GPS Format] âŒ ç·¯åº¦è¶…å‡ºç¯„åœ: ${latitude}`);\n    setStatus(\"red\", \"ring\", \"ç·¯åº¦éŒ¯èª¤\");\n    return null;\n}\n\nif (longitude < -180 || longitude > 180) {\n    log(`[GPS Format] âŒ ç¶“åº¦è¶…å‡ºç¯„åœ: ${longitude}`);\n    setStatus(\"red\", \"ring\", \"ç¶“åº¦éŒ¯èª¤\");\n    return null;\n}\n\nlog('[GPS Format] ----------------------------------------');\nlog(`[GPS Format] è¨­å‚™: ${deviceId}`);\nlog(`[GPS Format] åº§æ¨™: (${latitude.toFixed(6)}, ${longitude.toFixed(6)})`);\nlog(`[GPS Format] é«˜åº¦: ${altitude.toFixed(1)} m`);\nlog(`[GPS Format] è¡›æ˜Ÿ: ${satellites} é¡†`);\n\n// ========== æ­¥é©Ÿ 5: æº–å‚™ worldmap æ ¼å¼æ•¸æ“š ==========\n// worldmap è¦æ±‚çš„æ ¼å¼\nmsg.payload = {\n    // === å¿…è¦æ¬„ä½ ===\n    name: `è¨­å‚™${deviceId}`,  // å”¯ä¸€è­˜åˆ¥ç¢¼\n    lat: latitude,\n    lon: longitude,\n\n    // === åœ–æ¨™è¨­å®š ===\n    // é¸é … 1: ç¶“å…¸å®šä½æ¨™è¨˜ï¼ˆæ¨è–¦ï¼‰âœ…\n    icon: \"map-marker\",       // Font Awesome åœ–æ¨™\n    iconColor: \"red\",         // å¯é¸ï¼šred, blue, green, orange, yellow, violet, grey, black\n\n    // é¸é … 2: GPS ç®­é ­ï¼ˆå¦‚æœè¨­å‚™æœƒç§»å‹•ï¼‰\n    // icon: \"arrow\",\n    // iconColor: \"blue\",\n    // bearing: 0,            // æ–¹å‘ï¼ˆ0-360åº¦ï¼‰\n\n    // é¸é … 3: ä¸æŒ‡å®šï¼ˆä½¿ç”¨é è¨­ç´…è‰² markerï¼‰\n    // è¨»è§£æ‰ä¸Šé¢çš„ icon å’Œ iconColor\n\n    // === åœ–å±¤è¨­å®šï¼ˆå¯é¸ï¼‰===\n    layer: \"è¨­å‚™ä½ç½®\",        // åœ¨ worldmap ä¸Šçš„åœ–å±¤åç¨±\n\n    // === Popup å…§å®¹ ===\n    popup: `\n        <div style=\"font-family: Arial, sans-serif; min-width: 200px;\">\n            <h3 style=\"margin: 0 0 10px 0; color: #2196F3;\">\n                ğŸ”‹ è¨­å‚™ ${deviceId}\n            </h3>\n            <table style=\"width: 100%; font-size: 13px;\">\n                <tr>\n                    <td style=\"padding: 3px 0;\"><strong>ğŸ“ åº§æ¨™</strong></td>\n                    <td style=\"padding: 3px 0; text-align: right;\">\n                        ${latitude.toFixed(6)}, ${longitude.toFixed(6)}\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"padding: 3px 0;\"><strong>ğŸ“ é«˜åº¦</strong></td>\n                    <td style=\"padding: 3px 0; text-align: right;\">\n                        ${altitude.toFixed(1)} m\n                    </td>\n                </tr>\n                <tr>\n                    <td style=\"padding: 3px 0;\"><strong>ğŸ›°ï¸ è¡›æ˜Ÿ</strong></td>\n                    <td style=\"padding: 3px 0; text-align: right;\">\n                        ${satellites} é¡†\n                    </td>\n                </tr>\n                <tr>\n                    <td colspan=\"2\" style=\"padding: 8px 0 0 0; border-top: 1px solid #eee;\">\n                        <small style=\"color: #666;\">\n                            â° æ›´æ–°æ™‚é–“: ${new Date().toLocaleString('zh-TW')}\n                        </small>\n                    </td>\n                </tr>\n            </table>\n        </div>\n    `,\n\n    // === å…¶ä»–å¯é¸æ¬„ä½ ===\n    // tooltip: `è¨­å‚™${deviceId}`,  // æ»‘é¼ æ‡¸åœé¡¯ç¤º\n    // draggable: false,             // æ˜¯å¦å¯æ‹–å‹•\n    // addtoheatmap: false,          // æ˜¯å¦åŠ å…¥ç†±åŠ›åœ–\n};\n\n// ========== æ­¥é©Ÿ 6: è¼¸å‡ºæ—¥èªŒ ==========\nlog('[GPS Format] ----------------------------------------');\nlog('[GPS Format] worldmap æ•¸æ“šå·²æº–å‚™:');\nlog(`[GPS Format]   åç¨±: ${msg.payload.name}`);\nlog(`[GPS Format]   åœ–æ¨™: ${msg.payload.icon}`);\nlog(`[GPS Format]   é¡è‰²: ${msg.payload.iconColor}`);\nlog(`[GPS Format]   åœ–å±¤: ${msg.payload.layer}`);\n\n// ========== æ­¥é©Ÿ 7: è¨­ç½®ç¯€é»ç‹€æ…‹ ==========\nconst statusText = `ğŸ“ ${deviceId} (${satellites}è¡›æ˜Ÿ)`;\nsetStatus(\"green\", \"dot\", statusText);\n\nlog('[GPS Format] ========================================');\nlog('[GPS Format] âœ… æ ¼å¼åŒ–å®Œæˆï¼Œç™¼é€åˆ° worldmap');\n\n// ========== æ­¥é©Ÿ 8: è¿”å›æ•¸æ“š ==========\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ è¼¸å‡ºæ ¼å¼èªªæ˜\n// =================================================================\n//\n// msg.payload = {\n//     name: \"è¨­å‚™6002\",                    // å”¯ä¸€è­˜åˆ¥ç¢¼\n//     lat: 25.033671,                      // ç·¯åº¦\n//     lon: 121.564427,                     // ç¶“åº¦\n//     icon: \"map-marker\",                  // Font Awesome åœ–æ¨™\n//     iconColor: \"red\",                    // åœ–æ¨™é¡è‰²\n//     layer: \"è¨­å‚™ä½ç½®\",                    // åœ–å±¤åç¨±\n//     popup: \"<div>...</div>\"              // é»æ“Šæ™‚é¡¯ç¤ºçš„ HTML\n// }\n//\n// =================================================================\n// ğŸ”Œ é€£ç·šæ–¹å¼\n// =================================================================\n//\n// [GPSè§£æå™¨] \n//     â†“\n// [SQLç”Ÿæˆå™¨-GPS] (ä¿å­˜ msg._gps_data)\n//     â†“\n// [PostgreSQL]\n//     â†“\n// [æ­¤ç¯€é»: æ ¼å¼åŒ–GPS]\n//     â†“\n// [worldmap ç¯€é»]\n//\n// =================================================================\n// ğŸ¨ åœ–æ¨™é¸é …\n// =================================================================\n//\n// Font Awesome åœ–æ¨™ï¼ˆä¸å¸¶ fa- å‰ç¶´ï¼Œæœƒé¡¯ç¤ºåœ¨åœ“å½¢æ¨™è¨˜å…§ï¼‰:\n// - \"map-marker\"      ğŸ“ ç¶“å…¸åœ°åœ–æ¨™è¨˜ï¼ˆæ¨è–¦ï¼‰\n// - \"location-arrow\"  ğŸ§­ æ–¹å‘ç®­é ­\n// - \"crosshairs\"      âŠ• åå­—æº–æ˜Ÿ\n// - \"map-pin\"         ğŸ“Œ åœ–é‡˜\n//\n// å…§å»ºç‰¹æ®Šåœ–æ¨™ï¼ˆæœƒæ ¹æ“šæ–¹å‘æ—‹è½‰ï¼‰:\n// - \"arrow\"           GPS ç®­é ­ï¼ˆæ¨è–¦ç§»å‹•è¨­å‚™ï¼‰\n// - \"plane\"           é£›æ©Ÿ\n// - \"ship\"            èˆ¹\n// - \"car\"             æ±½è»Š\n// - \"uav\"             ç„¡äººæ©Ÿ\n//\n// ä¸æŒ‡å®š iconï¼šä½¿ç”¨é è¨­ç´…è‰² marker\n//\n// =================================================================\n// ğŸ¨ é¡è‰²é¸é …\n// =================================================================\n//\n// iconColor å¯é¸å€¼:\n// \"red\", \"blue\", \"green\", \"orange\", \"yellow\", \n// \"violet\", \"grey\", \"black\"\n//\n// =================================================================\n// âš™ï¸ ç¯€é»è¨­å®š\n// =================================================================\n//\n// åç¨±: æ ¼å¼åŒ–GPS\n// è¼¸å‡ºæ•¸é‡: 1\n//\n// =================================================================\n// ğŸ” æ•…éšœæ’é™¤\n// =================================================================\n//\n// 1. å¦‚æœåœ–æ¨™æ²’é¡¯ç¤ºï¼š\n//    - æª¢æŸ¥ icon å€¼æ˜¯å¦æ­£ç¢º\n//    - æª¢æŸ¥æ˜¯å¦æœ‰æ‹¼å­—éŒ¯èª¤\n//    - å˜—è©¦ä¸æŒ‡å®š iconï¼ˆä½¿ç”¨é è¨­ï¼‰\n//\n// 2. å¦‚æœé¡è‰²æ²’è®Šï¼š\n//    - ç¢ºèª iconColor å€¼åœ¨æ”¯æ´åˆ—è¡¨ä¸­\n//    - æª¢æŸ¥æ‹¼å­—ï¼ˆè‹±æ–‡ï¼‰\n//\n// 3. å¦‚æœåœ°åœ–ä¸Šæ²’æœ‰æ¨™è¨˜ï¼š\n//    - æª¢æŸ¥åº§æ¨™æ˜¯å¦åœ¨åˆç†ç¯„åœå…§\n//    - æª¢æŸ¥ worldmap ç¯€é»æ˜¯å¦æ­£å¸¸é‹è¡Œ\n//    - æŸ¥çœ‹ worldmap é é¢çš„ç€è¦½å™¨ console\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 1180,
        "wires": [
            [
                "2457b6b04c309152"
            ]
        ]
    },
    {
        "id": "2457b6b04c309152",
        "type": "worldmap",
        "z": "4f2c9b23a074cc9b",
        "name": "GPS åœ°åœ–",
        "lat": "25.033",
        "lon": "121.564",
        "zoom": "13",
        "layer": "OSMC",
        "cluster": "",
        "maxage": "",
        "usermenu": "show",
        "layers": "hide",
        "panit": "false",
        "panlock": "false",
        "zoomlock": "false",
        "hiderightclick": "false",
        "coords": "none",
        "showgrid": "false",
        "showruler": "false",
        "allowFileDrop": "false",
        "path": "/worldmap",
        "overlist": "DR,CO,RA,DN",
        "maplist": "OSMG,OSMC,EsriC,EsriS,UKOS",
        "mapname": "",
        "mapurl": "",
        "mapopt": "",
        "mapwms": false,
        "x": 1100,
        "y": 1240,
        "wires": []
    },
    {
        "id": "937523cb226ecabb",
        "type": "ui-iframe",
        "z": "4f2c9b23a074cc9b",
        "name": "Worldmap",
        "group": "24c6ae5a937a533f",
        "order": 7,
        "src": "/worldmap",
        "width": 6,
        "height": 8,
        "x": 930,
        "y": 1240,
        "wires": []
    },
    {
        "id": "c64de7ea6674c63a",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "é…ç½®å›å‚³å™¨",
        "func": "// é…ç½®å›å‚³å™¨ V2.0 - æ”¯æ´å¤šè¨­å‚™\n// ä½ç½®ï¼šPostgreSQL-æŸ¥è©¢ â†’ [é€™è£¡] â†’ template\n\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// æª¢æŸ¥æ˜¯å¦éœ€è¦è¿”å› UI\nif (!msg._return_to_ui) {\n    return null;\n}\n\n// å–å¾—è¨­å‚™ ID\nconst deviceId = msg.device_id || '6002';\n\nlog(`[Config Return] è™•ç†è¨­å‚™ ${deviceId} çš„æ•¸æ“šè¿”å›`);\n\n// æ ¹æ“šæŸ¥è©¢é¡å‹è™•ç†\nif (msg._source === 'ui_get_config') {\n    // é…ç½®æ•¸æ“š\n    if (!msg.payload || msg.payload.length === 0) {\n        log(`[Config Return] è¨­å‚™ ${deviceId} ç„¡é…ç½®ï¼Œä½¿ç”¨é è¨­å€¼`);\n\n        return {\n            payload: {\n                type: 'config',\n                device_id: deviceId,\n                factor_a: 1.0,\n                factor_p: 1.0\n            }\n        };\n    }\n\n    const config = msg.payload[0];\n\n    return {\n        payload: {\n            type: 'config',\n            device_id: deviceId,\n            factor_a: parseFloat(config.factor_a) || 1.0,\n            factor_p: parseFloat(config.factor_p) || 1.0\n        }\n    };\n}\n\nif (msg._source === 'ui_get_data') {\n    // æœ€æ–°åŠŸç‡æ•¸æ“š\n    if (!msg.payload || msg.payload.length === 0) {\n        log(`[Config Return] è¨­å‚™ ${deviceId} ç„¡æ•¸æ“š`);\n\n        return {\n            payload: {\n                type: 'realtime',\n                device_id: deviceId,\n                online: false,\n                pg: 0,\n                pa: 0,\n                pp: 0,\n                pag: 0,\n                ppg: 0,\n                lastUpdate: 'ç„¡æ•¸æ“š'\n            }\n        };\n    }\n\n    const data = msg.payload[0];\n\n    return {\n        payload: {\n            type: 'realtime',\n            device_id: deviceId,\n            online: true,\n            pg: parseInt(data.pg) || 0,\n            pa: parseInt(data.pa) || 0,\n            pp: parseInt(data.pp) || 0,\n            pag: parseFloat(data.pga_efficiency) || 0,\n            ppg: parseFloat(data.pgp_efficiency) || 0,\n            lastUpdate: new Date(data.timestamp).toLocaleTimeString('zh-TW')\n        }\n    };\n}\n\nif (msg._source === 'ui_get_info') {\n    // è¨­å‚™è³‡è¨Š\n    if (!msg.payload || msg.payload.length === 0) {\n        return {\n            payload: {\n                type: 'device_info',\n                device_id: deviceId,\n                device_name: `è¨­å‚™ ${deviceId}`,\n                location: 'æœªè¨­å®š'\n            }\n        };\n    }\n\n    const info = msg.payload[0];\n\n    return {\n        payload: {\n            type: 'device_info',\n            device_id: deviceId,\n            device_name: info.device_name || `è¨­å‚™ ${deviceId}`,\n            location: info.location || 'æœªè¨­å®š'\n        }\n    };\n}\n\nlog(`[Config Return] æœªçŸ¥çš„ä¾†æº: ${msg._source}`);\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1100,
        "wires": [
            [
                "fcfafba4b015bc1e"
            ]
        ]
    },
    {
        "id": "d992ce3e081aa0bf",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "creat config table",
        "func": "// ============================================================\n// å»ºç«‹ config è¡¨ + ç¢ºä¿è¨­å‚™å­˜åœ¨\n// ============================================================\n\nmsg.query = `\n    -- æ­¥é©Ÿ 1: å…ˆç¢ºä¿ devices è¡¨ä¸­æœ‰è¨­å‚™ï¼ˆä¸å­˜åœ¨æ‰æ’å…¥ï¼‰\n    INSERT INTO devices (device_id, device_name, location)\n    VALUES \n        ('6001', 'SolarSDGs 6001', 'æœªè¨­å®š'),\n        ('6002', 'SolarSDGs 6002', 'æœªè¨­å®š'),\n        ('6003', 'SolarSDGs 6003', 'æœªè¨­å®š')\n    ON CONFLICT (device_id) DO NOTHING;\n    \n    -- æ­¥é©Ÿ 2: å»ºç«‹ config è¡¨\n    CREATE TABLE IF NOT EXISTS config (\n        device_id VARCHAR(50) PRIMARY KEY REFERENCES devices(device_id),\n        factor_a DOUBLE PRECISION DEFAULT 1.0,\n        factor_p DOUBLE PRECISION DEFAULT 1.0,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n    );\n    \n    -- æ­¥é©Ÿ 3: å»ºç«‹ç´¢å¼•\n    CREATE INDEX IF NOT EXISTS idx_config_device ON config(device_id);\n    \n    -- æ­¥é©Ÿ 4: æ’å…¥é è¨­é…ç½®\n    INSERT INTO config (device_id, factor_a, factor_p)\n    VALUES \n        ('6001', 1.0, 1.0),\n        ('6002', 1.0, 1.0),\n        ('6003', 1.0, 1.0)\n    ON CONFLICT (device_id) DO NOTHING;\n`;\n\nmsg.params = [];\n\nnode.warn('ğŸ”§ å»ºç«‹ config è¡¨æ ¼ï¼ˆå«è¨­å‚™æª¢æŸ¥ï¼‰');\nnode.warn('   æ­¥é©Ÿ 1: ç¢ºä¿è¨­å‚™å­˜åœ¨æ–¼ devices è¡¨');\nnode.warn('   æ­¥é©Ÿ 2: å»ºç«‹ config è¡¨ï¼ˆå«å¤–éµï¼‰');\nnode.warn('   æ­¥é©Ÿ 3: å»ºç«‹ç´¢å¼•');\nnode.warn('   æ­¥é©Ÿ 4: æ’å…¥é è¨­é…ç½®');\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 320,
        "wires": [
            [
                "9a4df4aae613c3cf"
            ]
        ]
    },
    {
        "id": "465c8800dd2a282d",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 260,
        "wires": []
    },
    {
        "id": "f9aba0132dba17df",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1540,
        "y": 320,
        "wires": []
    },
    {
        "id": "9596483be8b41939",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "check config",
        "func": "// Function: CHECK_CONFIG\n// æŸ¥è©¢ config è¡¨å…§å®¹\n\nmsg.query = `\n    SELECT \n        device_id,\n        factor_a,\n        factor_p,\n        updated_at\n    FROM config \n    ORDER BY device_id;\n`;\n\nmsg.params = [];\n\nnode.warn('ğŸ“Š æŸ¥è©¢ config è¡¨å…§å®¹');\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 200,
        "wires": [
            [
                "c461e4bb1ef3981c"
            ]
        ]
    },
    {
        "id": "a708e970e2089467",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 200,
        "wires": [
            [
                "9596483be8b41939"
            ]
        ]
    },
    {
        "id": "5c65df98cba2b5d5",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 200,
        "wires": []
    },
    {
        "id": "c589e2866244d2cf",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "check flow_context",
        "func": "// Function: CHECK_FLOW_CONTEXT\nconst deviceIds = ['6001', '6002', '6003'];\nconst result = {};\n\ndeviceIds.forEach(id => {\n    const factorKey = `factor_${id}`;\n    const config = flow.get(factorKey);\n    result[id] = config || 'NOT FOUND';\n});\n\nmsg.payload = result;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 80,
        "wires": [
            [
                "671cbe2c85da8f1d"
            ]
        ]
    },
    {
        "id": "7dbbd45d950dc221",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 80,
        "wires": [
            [
                "c589e2866244d2cf"
            ]
        ]
    },
    {
        "id": "671cbe2c85da8f1d",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 560,
        "y": 80,
        "wires": []
    },
    {
        "id": "a7346c19c2ba206f",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æŸ¥è©¢æ‰€æœ‰é…ç½®",
        "func": "// Function: ç›´æ¥æŸ¥è©¢é…ç½®\n// åç¨±: DB-æŸ¥è©¢æ‰€æœ‰é…ç½®\n\nmsg.query = `\n    SELECT \n        device_id,\n        factor_a,\n        factor_p,\n        updated_at,\n        EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - updated_at))/60 as minutes_ago\n    FROM config \n    ORDER BY device_id;\n`;\nmsg.params = [];\n\nnode.warn('[DB Query] æŸ¥è©¢æ‰€æœ‰è¨­å‚™é…ç½®');\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 120,
        "wires": [
            [
                "1f45208567bbf61f"
            ]
        ]
    },
    {
        "id": "1f45208567bbf61f",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 550,
        "y": 120,
        "wires": [
            [
                "676d3dab5fe63781"
            ]
        ]
    },
    {
        "id": "c4adbfc262a989d7",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "a7346c19c2ba206f"
            ]
        ]
    },
    {
        "id": "676d3dab5fe63781",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 120,
        "wires": []
    },
    {
        "id": "dc0ff4ccba4378ad",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æº–å‚™æŸ¥è©¢",
        "func": "const deviceId = '6002';\n\nnode.warn(`[Init] è¼‰å…¥é…ç½®: ${deviceId}`);\n\nmsg.query_type = 'get_config';\nmsg.params = [deviceId];\nmsg.device_id = deviceId;\nmsg._send_to_ui = true;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 900,
        "wires": [
            [
                "849a5c2380d839b8"
            ]
        ]
    },
    {
        "id": "8ae10212ef9bcf23",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "ç³»çµ±åˆå§‹åŒ–",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 900,
        "wires": [
            [
                "dc0ff4ccba4378ad"
            ]
        ]
    },
    {
        "id": "89b11649a31bc4f0",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æ ¼å¼åŒ–",
        "func": "// åªè™•ç†åˆå§‹åŒ–çš„è¨Šæ¯\nif (!msg._send_to_ui) {\n    return null;\n}\n\n// å–å¾—é…ç½®\nlet config;\n\nif (msg.payload && msg.payload.length > 0) {\n    config = msg.payload[0];\n    node.warn(`[Init] é…ç½®: A=${config.factor_a}, P=${config.factor_p}`);\n} else {\n    config = {\n        device_id: '6002',\n        factor_a: 1.0,\n        factor_p: 1.0\n    };\n    node.warn(`[Init] ç„¡é…ç½®ï¼Œç”¨é è¨­å€¼`);\n}\n\n// æ ¼å¼åŒ–æˆ Template å¯æ¥æ”¶çš„æ ¼å¼\nmsg.payload = {\n    type: 'config',\n    device_id: config.device_id,\n    factor_a: parseFloat(config.factor_a) || 1.0,\n    factor_p: parseFloat(config.factor_p) || 1.0\n};\n\nnode.warn(`[Init] ç™¼é€: ${JSON.stringify(msg.payload)}`);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 900,
        "wires": [
            [
                "fcfafba4b015bc1e"
            ]
        ]
    },
    {
        "id": "849a5c2380d839b8",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "SQLç”Ÿæˆå™¨",
        "func": "// =================================================================\n// å‹•æ…‹ SQL ç”Ÿæˆå™¨ - çµ±ä¸€ç‰ˆï¼ˆç§»é™¤ pizeroï¼‰\n// ç‰ˆæœ¬: V5.0\n// é©ç”¨æ–¼ç¨ç«‹ solar_db è³‡æ–™åº«\n// \n// æ•´åˆæ‰€æœ‰ SQL æ“ä½œï¼š\n// - åŠŸç‡æ•¸æ“šã€GPSã€é…ç½®ã€è¨­å‚™ç‹€æ…‹ã€çµ±è¨ˆ\n// =================================================================\n\n// ç¢ºä¿ msg ç‰©ä»¶å­˜åœ¨\nif (!msg) {\n    msg = {};\n}\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºè³‡æ–™åº«æ“ä½œ\nif (!msg.query_type) {\n    return msg;\n}\n\n// æª¢æŸ¥ params æ˜¯å¦å­˜åœ¨\nif (!msg.params) {\n    msg.params = [];\n}\n\n// æ—¥èªŒè¼¸å‡º\nconst log = (message) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(message);\n    }\n};\n\n// è¨­å®šç‹€æ…‹\nconst setStatus = (fill, shape, text) => {\n    if (typeof node !== 'undefined' && node.status) {\n        node.status({ fill, shape, text });\n    }\n};\n\nlog(`[SQL] é¡å‹: ${msg.query_type}, åƒæ•¸: ${JSON.stringify(msg.params)}`);\n\ntry {\n    switch (msg.query_type) {\n        // ========================================\n        // ç³»çµ±ç®¡ç† SQL\n        // ========================================\n        case 'test_connection':\n            msg.query = 'SELECT version(), current_database();';\n            msg.params = [];\n            log('[SQL] æ¸¬è©¦è³‡æ–™åº«é€£ç·š');\n            break;\n\n        case 'list_tables':\n            msg.query = `\n                SELECT table_name \n                FROM information_schema.tables \n                WHERE table_schema = 'public' \n                ORDER BY table_name;\n            `;\n            msg.params = [];\n            log('[SQL] åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨');\n            break;\n\n        // ========================================\n        // åŠŸç‡æ•¸æ“šæ“ä½œ\n        // ========================================\n        case 'insert_power_data':\n            // ç¢ºä¿æœ‰ 7 å€‹åƒæ•¸\n            while (msg.params.length < 7) {\n                msg.params.push(null);\n            }\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                    pg = EXCLUDED.pg,\n                    pa = EXCLUDED.pa,\n                    pp = EXCLUDED.pp,\n                    pga_efficiency = EXCLUDED.pga_efficiency,\n                    pgp_efficiency = EXCLUDED.pgp_efficiency\n                RETURNING id;\n            `;\n            log(`[SQL] æ’å…¥åŠŸç‡æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'batch_insert_power_data':\n            // æ‰¹æ¬¡æ’å…¥\n            if (msg.batch_data && Array.isArray(msg.batch_data) && msg.batch_data.length > 0) {\n                const values = msg.batch_data.map((data, idx) => {\n                    const offset = idx * 7;\n                    return `($${offset + 1}, $${offset + 2}, $${offset + 3}, $${offset + 4}, $${offset + 5}, $${offset + 6}, $${offset + 7})`;\n                }).join(',');\n\n                msg.query = `\n                    INSERT INTO power_data \n                    (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                    VALUES ${values}\n                    ON CONFLICT (device_id, timestamp) DO UPDATE SET\n                        pg = EXCLUDED.pg,\n                        pa = EXCLUDED.pa,\n                        pp = EXCLUDED.pp,\n                        pga_efficiency = EXCLUDED.pga_efficiency,\n                        pgp_efficiency = EXCLUDED.pgp_efficiency\n                    RETURNING id;\n                `;\n                msg.params = msg.batch_data.flat();\n                log(`[SQL] æ‰¹æ¬¡æ’å…¥ ${msg.batch_data.length} ç­†æ•¸æ“š`);\n            } else {\n                log('[SQL] æ‰¹æ¬¡æ’å…¥å¤±æ•—ï¼šç„¡æœ‰æ•ˆæ•¸æ“š');\n                msg.query = null;\n            }\n            break;\n\n        case 'get_latest_data':\n            // ç¢ºä¿è‡³å°‘æœ‰ 2 å€‹åƒæ•¸\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            if (msg.params.length < 2) {\n                msg.params.push(10);\n            }\n            msg.query = `\n                SELECT * FROM power_data\n                WHERE device_id = $1\n                ORDER BY timestamp DESC\n                LIMIT $2;\n            `;\n            log(`[SQL] æŸ¥è©¢æœ€æ–°æ•¸æ“š: ${msg.params[0]}`);\n            break;\n\n        case 'get_data_by_timerange':\n            if (msg.params.length < 3) {\n                log('[SQL] æ™‚é–“ç¯„åœæŸ¥è©¢éœ€è¦ 3 å€‹åƒæ•¸');\n                msg.query = null;\n            } else {\n                msg.query = `\n                    SELECT * FROM power_data\n                    WHERE device_id = $1 \n                    AND timestamp BETWEEN $2 AND $3\n                    ORDER BY timestamp DESC;\n                `;\n                log(`[SQL] æŸ¥è©¢æ™‚é–“ç¯„åœæ•¸æ“š: ${msg.params[0]}`);\n            }\n            break;\n\n        // ========================================\n        // è¨­å‚™ç®¡ç†\n        // ========================================\n        case 'update_device_status':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                UPDATE devices \n                SET last_seen = CURRENT_TIMESTAMP\n                WHERE device_id = $1\n                RETURNING device_id, last_seen;\n            `;\n            log(`[SQL] æ›´æ–°è¨­å‚™ç‹€æ…‹: ${msg.params[0]}`);\n            break;\n\n        case 'upsert_device':\n            while (msg.params.length < 3) {\n                msg.params.push('');\n            }\n            msg.query = `\n                INSERT INTO devices (device_id, device_name, location)\n                VALUES ($1, $2, $3)\n                ON CONFLICT (device_id) \n                DO UPDATE SET \n                    device_name = EXCLUDED.device_name,\n                    location = EXCLUDED.location,\n                    last_seen = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] è¨»å†Š/æ›´æ–°è¨­å‚™: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_devices':\n            msg.query = `\n                SELECT \n                    d.*,\n                    c.factor_a,\n                    c.factor_p,\n                    (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                ORDER BY d.device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹');\n            break;\n\n        // ========================================\n        // é…ç½®ç®¡ç†ï¼ˆç§»é™¤ pizeroï¼‰\n        // ========================================\n        case 'get_config':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    device_id,\n                    factor_a,\n                    factor_p,\n                    updated_at\n                FROM config\n                WHERE device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢é…ç½®: ${msg.params[0]}`);\n            break;\n\n        case 'update_config':\n            // ç¢ºä¿æœ‰ 3 å€‹åƒæ•¸ï¼ˆç§»é™¤ pizero_on, pizero_offï¼‰\n            while (msg.params.length < 3) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else {\n                    msg.params.push(1.0);\n                }\n            }\n            msg.query = `\n                INSERT INTO config \n                (device_id, factor_a, factor_p, updated_at)\n                VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    factor_a = EXCLUDED.factor_a,\n                    factor_p = EXCLUDED.factor_p,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n            log(`[SQL] æ›´æ–°é…ç½®: ${msg.params[0]}`);\n            log(`[SQL]   Factor_A: ${msg.params[1]}`);\n            log(`[SQL]   Factor_P: ${msg.params[2]}`);\n            break;\n\n        case 'get_device_info':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    d.device_id,\n                    d.device_name,\n                    d.location,\n                    d.last_seen,\n                    c.factor_a,\n                    c.factor_p\n                FROM devices d\n                LEFT JOIN config c ON d.device_id = c.device_id\n                WHERE d.device_id = $1;\n            `;\n            log(`[SQL] æŸ¥è©¢è¨­å‚™å®Œæ•´è³‡è¨Š: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // çµ±è¨ˆæŸ¥è©¢\n        // ========================================\n        case 'get_hourly_stats':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE_TRUNC('hour', timestamp) as hour,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    MAX(pg) as max_pg,\n                    MIN(pg) as min_pg,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '24 hours'\n                GROUP BY hour, device_id\n                ORDER BY hour DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢å°æ™‚çµ±è¨ˆ: ${msg.params[0]}`);\n            break;\n\n        case 'get_daily_summary':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n            msg.query = `\n                SELECT \n                    DATE(timestamp) as date,\n                    device_id,\n                    AVG(pg) as avg_pg,\n                    AVG(pa) as avg_pa,\n                    AVG(pp) as avg_pp,\n                    SUM(pg) as total_pg,\n                    AVG(pga_efficiency) as avg_pga_eff,\n                    AVG(pgp_efficiency) as avg_pgp_eff,\n                    COUNT(*) as data_points\n                FROM power_data\n                WHERE device_id = $1\n                AND timestamp > NOW() - INTERVAL '30 days'\n                GROUP BY date, device_id\n                ORDER BY date DESC;\n            `;\n            log(`[SQL] æŸ¥è©¢æ¯æ—¥ç¸½çµ: ${msg.params[0]}`);\n            break;\n\n        // ========================================\n        // GPS ä½ç½®ç®¡ç†\n        // ========================================\n        case 'upsert_gps_location':\n            while (msg.params.length < 6) {\n                if (msg.params.length === 0) {\n                    msg.params.push('6002');\n                } else if (msg.params.length <= 2) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 3) {\n                    msg.params.push(0);\n                } else if (msg.params.length === 4) {\n                    msg.params.push(0);\n                } else {\n                    msg.params.push(new Date().toISOString());\n                }\n            }\n\n            msg.query = `\n                INSERT INTO gps_locations \n                (device_id, latitude, longitude, altitude, satellites, timestamp)\n                VALUES ($1, $2, $3, $4, $5, $6)\n                ON CONFLICT (device_id)\n                DO UPDATE SET\n                    latitude = EXCLUDED.latitude,\n                    longitude = EXCLUDED.longitude,\n                    altitude = EXCLUDED.altitude,\n                    satellites = EXCLUDED.satellites,\n                    timestamp = EXCLUDED.timestamp,\n                    updated_at = CURRENT_TIMESTAMP\n                RETURNING *;\n            `;\n\n            log(`[SQL] æ’å…¥/æ›´æ–° GPS: ${msg.params[0]} (${msg.params[1]}, ${msg.params[2]})`);\n            break;\n\n        case 'get_gps_location':\n            if (msg.params.length < 1) {\n                msg.params = ['6002'];\n            }\n\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                WHERE device_id = $1;\n            `;\n\n            log(`[SQL] æŸ¥è©¢ GPS: ${msg.params[0]}`);\n            break;\n\n        case 'get_all_gps_locations':\n            msg.query = `\n                SELECT \n                    device_id,\n                    latitude,\n                    longitude,\n                    altitude,\n                    satellites,\n                    timestamp,\n                    updated_at,\n                    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - timestamp))/3600 as hours_ago\n                FROM gps_locations\n                ORDER BY device_id;\n            `;\n            msg.params = [];\n            log('[SQL] æŸ¥è©¢æ‰€æœ‰ GPS');\n            break;\n\n        case 'create_gps_table':\n            msg.query = `\n                CREATE TABLE IF NOT EXISTS gps_locations (\n                    id SERIAL PRIMARY KEY,\n                    device_id VARCHAR(50) NOT NULL,\n                    latitude DOUBLE PRECISION NOT NULL,\n                    longitude DOUBLE PRECISION NOT NULL,\n                    altitude DOUBLE PRECISION DEFAULT 0,\n                    satellites INTEGER DEFAULT 0,\n                    timestamp TIMESTAMP NOT NULL,\n                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                    CONSTRAINT unique_device_gps UNIQUE (device_id)\n                );\n                \n                CREATE INDEX IF NOT EXISTS idx_gps_device ON gps_locations(device_id);\n                CREATE INDEX IF NOT EXISTS idx_gps_timestamp ON gps_locations(timestamp DESC);\n            `;\n            msg.params = [];\n            log('[SQL] å»ºç«‹ GPS è¡¨æ ¼');\n            break;\n\n        // ========================================\n        // æ¸¬è©¦æ•¸æ“š\n        // ========================================\n        case 'insert_test_data':\n            const now = new Date();\n            const deviceId = msg.params[0] || '6002';\n            msg.query = `\n                INSERT INTO power_data \n                (device_id, timestamp, pg, pa, pp, pga_efficiency, pgp_efficiency)\n                VALUES ($1, $2, $3, $4, $5, $6, $7)\n                RETURNING *;\n            `;\n            msg.params = [\n                deviceId,\n                now.toISOString(),\n                Math.floor(Math.random() * 50) + 150,\n                Math.floor(Math.random() * 50) + 200,\n                Math.floor(Math.random() * 50) + 180,\n                Math.random() * 20 + 30,\n                Math.random() * 20 + 20\n            ];\n            log('[SQL] æ’å…¥æ¸¬è©¦æ•¸æ“š');\n            break;\n\n        default:\n            log(`[SQL] æœªè™•ç†çš„æŸ¥è©¢é¡å‹: ${msg.query_type}`);\n            msg.query = null;\n            break;\n    }\n\n    // è¨­å®šç‹€æ…‹\n    if (msg.query) {\n        setStatus(\"green\", \"dot\", `SQL: ${msg.query_type}`);\n    } else {\n        setStatus(\"yellow\", \"ring\", \"ç„¡ SQL\");\n    }\n\n} catch (error) {\n    log(`[SQL] éŒ¯èª¤: ${error.message}`);\n    msg.error = error.message;\n    setStatus(\"red\", \"ring\", \"éŒ¯èª¤\");\n}\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„æŸ¥è©¢é¡å‹æ¸…å–®\n// =================================================================\n//\n// ã€ç³»çµ±ç®¡ç†ã€‘\n//   test_connection, list_tables, create_gps_table\n//\n// ã€åŠŸç‡æ•¸æ“šã€‘\n//   insert_power_data, batch_insert_power_data, \n//   get_latest_data, get_data_by_timerange\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   update_device_status, upsert_device, get_all_devices\n//\n// ã€é…ç½®ç®¡ç†ã€‘ï¼ˆç§»é™¤ pizeroï¼‰\n//   get_config, update_config, get_device_info\n//\n// ã€çµ±è¨ˆæŸ¥è©¢ã€‘\n//   get_hourly_stats, get_daily_summary\n//\n// ã€GPS ä½ç½®ã€‘\n//   upsert_gps_location, get_gps_location, get_all_gps_locations\n//\n// ã€æ¸¬è©¦ã€‘\n//   insert_test_data\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 900,
        "wires": [
            [
                "824c8d0bde4ff147"
            ]
        ]
    },
    {
        "id": "824c8d0bde4ff147",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 790,
        "y": 900,
        "wires": [
            [
                "89b11649a31bc4f0"
            ]
        ]
    },
    {
        "id": "d01108365be2a956",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"action\":\"update_config\",\"deviceId\":\"6002\",\"factor_a\":1,\"factor_p\":5}",
        "payloadType": "json",
        "x": 150,
        "y": 1120,
        "wires": [
            [
                "26326e9c4ff0218a"
            ]
        ]
    },
    {
        "id": "53c096d139c0fbe9",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 1040,
        "wires": []
    },
    {
        "id": "1f67587604d21083",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "creat customer table",
        "func": "// =================================================================\n// å»ºç«‹å®¢æˆ¶ç®¡ç†è¡¨ - ç°¡å–®ç‰ˆ\n// =================================================================\n\n// è¨­å®šæŸ¥è©¢é¡å‹\nmsg.query_type = 'create_customers_table';\n\n// å»ºç«‹å®¢æˆ¶è¡¨çš„ SQL\nmsg.query = `\n-- åˆªé™¤èˆŠè¡¨ï¼ˆé–‹ç™¼éšæ®µä½¿ç”¨ï¼Œæ­£å¼ç’°å¢ƒè¦å°å¿ƒï¼‰\nDROP TABLE IF EXISTS customers CASCADE;\n\n-- å»ºç«‹å®¢æˆ¶è¡¨\nCREATE TABLE IF NOT EXISTS customers (\n    id SERIAL PRIMARY KEY,\n    customer_code VARCHAR(20) UNIQUE NOT NULL,   -- A001, B001, admin\n    customer_name VARCHAR(100) NOT NULL,         -- å…¬å¸åç¨±\n    password VARCHAR(100) NOT NULL,              -- å¯†ç¢¼ï¼ˆæš«æ™‚æ˜ç¢¼ï¼‰\n    devices TEXT[],                              -- è¨­å‚™é™£åˆ— ['6001','6002']\n    is_active BOOLEAN DEFAULT true,              -- æ˜¯å¦å•Ÿç”¨\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP,                        -- æœ€å¾Œç™»å…¥æ™‚é–“\n    login_count INTEGER DEFAULT 0                -- ç™»å…¥æ¬¡æ•¸\n);\n\n-- å»ºç«‹ç´¢å¼•\nCREATE INDEX IF NOT EXISTS idx_customer_code ON customers(customer_code);\nCREATE INDEX IF NOT EXISTS idx_active ON customers(is_active);\n\n-- æ’å…¥åˆå§‹è³‡æ–™\nINSERT INTO customers (customer_code, customer_name, password, devices) VALUES\n('admin', 'ç³»çµ±ç®¡ç†å“¡', '82767419', ARRAY['ALL']),\n('Solarsdgs', 'åŠ åŠ æ¸›æ¸›', '96762364', ARRAY['6001', '6002']),\n('TEST', 'æ¸¬è©¦å®¢æˆ¶', 'test123', ARRAY['6001', '6002']),\n('A001', 'å°ç©é›»', 'tsmc2024', ARRAY['6001']),\n('B001', 'å‹é”å…‰é›»', 'auo2024', ARRAY['6002']),\n('C001', 'ç¾¤å‰µå…‰é›»', 'innolux2024', ARRAY['6003'])\nON CONFLICT (customer_code) DO NOTHING;\n\n-- å»ºç«‹ç™»å…¥æ—¥èªŒè¡¨ï¼ˆé¸ç”¨ï¼‰\nCREATE TABLE IF NOT EXISTS login_logs (\n    id SERIAL PRIMARY KEY,\n    customer_code VARCHAR(20),\n    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    login_ip VARCHAR(50),\n    user_agent TEXT,\n    status VARCHAR(20)  -- success/failed\n);\n`;\n\nmsg.params = [];\n\n// è¨­å®šç¯€é»ç‹€æ…‹\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: \"å»ºç«‹å®¢æˆ¶è¡¨\"\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 380,
        "wires": [
            [
                "61996cdb8aa50bfb"
            ]
        ]
    },
    {
        "id": "7ca95deb8b051ca2",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 380,
        "wires": [
            [
                "1f67587604d21083"
            ]
        ]
    },
    {
        "id": "61996cdb8aa50bfb",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1370,
        "y": 380,
        "wires": [
            [
                "eba99367f3134470"
            ]
        ]
    },
    {
        "id": "eba99367f3134470",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1560,
        "y": 380,
        "wires": []
    },
    {
        "id": "054a07ba89e15327",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "list all customers",
        "func": "// =================================================================\n// æŸ¥è©¢æ‰€æœ‰å®¢æˆ¶è³‡æ–™\n// =================================================================\n\nmsg.query = `\n    SELECT \n        id,\n        customer_code,\n        customer_name,\n        array_length(devices, 1) as device_count,\n        devices,\n        is_active,\n        last_login,\n        login_count,\n        created_at\n    FROM customers\n    ORDER BY \n        CASE \n            WHEN customer_code = 'admin' THEN 0\n            ELSE 1\n        END,\n        customer_code ASC;\n`;\n\nmsg.params = [];\n\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: \"æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨\"\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 440,
        "wires": [
            [
                "c5b4e5382f04f893"
            ]
        ]
    },
    {
        "id": "04e932d5ea51cb3d",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 970,
        "y": 440,
        "wires": [
            [
                "054a07ba89e15327"
            ]
        ]
    },
    {
        "id": "c5b4e5382f04f893",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1370,
        "y": 440,
        "wires": [
            [
                "a9490ca0f025a3e3"
            ]
        ]
    },
    {
        "id": "a9490ca0f025a3e3",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1540,
        "y": 440,
        "wires": []
    },
    {
        "id": "df344886164dbd15",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "é©—è­‰å¯†ç¢¼",
        "func": "// =================================================================\n// é©—è­‰å¯†ç¢¼ Function - å°ˆé–€é©—è­‰å¯†ç¢¼ï¼ˆä¿®æ­£ç‰ˆï¼‰\n// ä½ç½®ï¼šPostgreSQL â†’ [é€™è£¡] â†’ è™•ç†ç™»å…¥é©—è­‰\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\nnode.warn('=====================================');\nnode.warn('[é©—è­‰å¯†ç¢¼] é–‹å§‹é©—è­‰');\nnode.warn('=====================================');\n\n// æª¢æŸ¥æ˜¯å¦ç‚ºç™»å…¥å‹•ä½œ\nif (!msg._original_request || msg._original_request.action !== 'customer_login') {\n    node.warn('[é©—è­‰å¯†ç¢¼] ä¸æ˜¯ç™»å…¥å‹•ä½œï¼Œç›´æ¥å‚³é');\n    return msg;\n}\n\nconst requestedCode = msg._original_request.customer_code;\nconst requestedPassword = msg._original_request.password;\n\nnode.warn('[é©—è­‰å¯†ç¢¼] é©—è­‰å®¢æˆ¶: ' + requestedCode);\nnode.warn('[é©—è­‰å¯†ç¢¼] è¼¸å…¥å¯†ç¢¼: ' + requestedPassword);\n\n// åˆå§‹åŒ– login_check\nmsg.login_check = {\n    requested_code: requestedCode,\n    requested_password: requestedPassword,\n    success: false,\n    customer_data: null,\n    message: ''\n};\n\n// æª¢æŸ¥æŸ¥è©¢çµæœ\nif (!msg.payload || msg.payload.length === 0) {\n    // å®¢æˆ¶ä¸å­˜åœ¨\n    msg.login_check.success = false;\n    msg.login_check.message = 'å®¢æˆ¶ä»£ç¢¼ä¸å­˜åœ¨æˆ–å·²åœç”¨';\n\n    node.warn('[é©—è­‰å¯†ç¢¼] âŒ å®¢æˆ¶ä¸å­˜åœ¨');\n    node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"å®¢æˆ¶ä¸å­˜åœ¨\"\n    });\n} else {\n    // å®¢æˆ¶å­˜åœ¨ï¼Œæ¯”å°å¯†ç¢¼\n    const customer = msg.payload[0];\n\n    node.warn('[é©—è­‰å¯†ç¢¼] æ‰¾åˆ°å®¢æˆ¶: ' + customer.customer_name);\n    node.warn('[é©—è­‰å¯†ç¢¼] è³‡æ–™åº«å¯†ç¢¼: ' + customer.password);\n\n    if (customer.password === requestedPassword) {\n        // å¯†ç¢¼æ­£ç¢º\n        msg.login_check.success = true;\n        msg.login_check.customer_data = customer;\n        msg.login_check.message = 'ç™»å…¥æˆåŠŸ';\n\n        node.warn('[é©—è­‰å¯†ç¢¼] âœ… å¯†ç¢¼æ­£ç¢º');\n        node.warn('[é©—è­‰å¯†ç¢¼] è¨­ç½® login_check.success = true');\n\n        node.status({\n            fill: \"green\",\n            shape: \"dot\",\n            text: \"å¯†ç¢¼æ­£ç¢º\"\n        });\n    } else {\n        // å¯†ç¢¼éŒ¯èª¤\n        msg.login_check.success = false;\n        msg.login_check.message = 'å¯†ç¢¼éŒ¯èª¤';\n\n        node.warn('[é©—è­‰å¯†ç¢¼] âŒ å¯†ç¢¼éŒ¯èª¤');\n        node.status({\n            fill: \"red\",\n            shape: \"dot\",\n            text: \"å¯†ç¢¼éŒ¯èª¤\"\n        });\n    }\n}\n\nnode.warn('[é©—è­‰å¯†ç¢¼] é©—è­‰å®Œæˆï¼Œå‚³éåˆ°ä¸‹ä¸€å€‹ç¯€é»');\nnode.warn('=====================================');\n\n// å‚³éåˆ°ä¸‹ä¸€å€‹ç¯€é»\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 1380,
        "wires": [
            [
                "513266156844f26e"
            ]
        ]
    },
    {
        "id": "513266156844f26e",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "è™•ç†ç™»å…¥é©—è­‰",
        "func": "// =================================================================\n// è™•ç†ç™»å…¥é©—è­‰ Functionï¼ˆå®Œæ•´é™¤éŒ¯ç‰ˆï¼‰\n// ä½ç½®ï¼šé©—è­‰å¯†ç¢¼ â†’ [é€™è£¡] â†’ åˆ†æµ\n// è¼¸å‡ºæ•¸ï¼š2\n// =================================================================\n\nnode.warn('=====================================');\nnode.warn('[è™•ç†ç™»å…¥] é–‹å§‹è™•ç†');\nnode.warn('=====================================');\n\n// é¡¯ç¤ºæ”¶åˆ°çš„å®Œæ•´è¨Šæ¯\nnode.warn('[è™•ç†ç™»å…¥] å®Œæ•´ msg:');\nnode.warn(JSON.stringify({\n    login_check: msg.login_check,\n    _original_request: msg._original_request,\n    payload: msg.payload\n}, null, 2));\n\n// æª¢æŸ¥æ˜¯å¦æœ‰ login_check\nif (!msg.login_check) {\n    node.warn('[è™•ç†ç™»å…¥] âŒ æ²’æœ‰ login_checkï¼Œé€™ä¸æ˜¯ç™»å…¥è«‹æ±‚');\n\n    // æª¢æŸ¥æ˜¯å¦ç‚ºå…¶ä»–æ“ä½œ\n    if (msg._original_request && msg._original_request.target === 'admin_page') {\n        node.warn('[è™•ç†ç™»å…¥] é€™æ˜¯ç®¡ç†å“¡æ“ä½œï¼Œå‚³åˆ° Output 2');\n        return [null, msg];\n    }\n\n    node.warn('[è™•ç†ç™»å…¥] æœªçŸ¥è«‹æ±‚ï¼Œå‚³åˆ° Output 2');\n    return [null, msg];\n}\n\nnode.warn('[è™•ç†ç™»å…¥] âœ… æœ‰ login_checkï¼Œé–‹å§‹è™•ç†ç™»å…¥é©—è­‰');\n\n// å–å¾— request_id\nconst requestId = msg._original_request?.request_id || null;\nnode.warn(`[è™•ç†ç™»å…¥] Request ID: ${requestId}`);\n\n// æª¢æŸ¥ç™»å…¥çµæœ\nconst success = msg.login_check.success;\nconst message = msg.login_check.message;\n\nnode.warn(`[è™•ç†ç™»å…¥] ç™»å…¥çµæœ: ${success ? 'æˆåŠŸ' : 'å¤±æ•—'}`);\nnode.warn(`[è™•ç†ç™»å…¥] è¨Šæ¯: ${message}`);\n\n// æº–å‚™å›å‚³çµ¦ç™»å…¥é é¢çš„è¨Šæ¯\nconst loginResponse = {\n    payload: {\n        login_result: {\n            success: success,\n            message: message\n        },\n        request_id: requestId\n    }\n};\n\nif (success) {\n    // ç™»å…¥æˆåŠŸ\n    const customer = msg.login_check.customer_data;\n\n    node.warn('[è™•ç†ç™»å…¥] âœ… ç™»å…¥æˆåŠŸè™•ç†');\n    node.warn(`[è™•ç†ç™»å…¥] å®¢æˆ¶ä»£ç¢¼: ${customer.customer_code}`);\n    node.warn(`[è™•ç†ç™»å…¥] å®¢æˆ¶åç¨±: ${customer.customer_name}`);\n    node.warn(`[è™•ç†ç™»å…¥] è¨­å‚™åˆ—è¡¨: ${JSON.stringify(customer.devices)}`);\n\n    loginResponse.payload.login_result.customer_code = customer.customer_code;\n    loginResponse.payload.login_result.customer_name = customer.customer_name;\n    loginResponse.payload.login_result.devices = customer.devices;\n\n    node.warn('[è™•ç†ç™»å…¥] æº–å‚™å›å‚³è¨Šæ¯:');\n    node.warn(JSON.stringify(loginResponse, null, 2));\n\n    // æº–å‚™è¨˜éŒ„ç™»å…¥çš„è¨Šæ¯\n    const logMsg = {\n        action: 'log_login',\n        customer_code: customer.customer_code,\n        need_log: true\n    };\n\n    node.warn('[è™•ç†ç™»å…¥] æº–å‚™è¨˜éŒ„ç™»å…¥:');\n    node.warn(JSON.stringify(logMsg, null, 2));\n\n    node.status({\n        fill: \"green\",\n        shape: \"dot\",\n        text: `âœ… ${customer.customer_code} ç™»å…¥æˆåŠŸ`\n    });\n\n    node.warn('[è™•ç†ç™»å…¥] Output 1: å›ç™»å…¥é é¢ï¼ˆæˆåŠŸï¼‰');\n    node.warn('[è™•ç†ç™»å…¥] Output 2: è¨˜éŒ„ç™»å…¥');\n    node.warn('=====================================');\n\n    // Output 1: å›ç™»å…¥é é¢ï¼ˆæˆåŠŸï¼‰\n    // Output 2: è¨˜éŒ„ç™»å…¥\n    return [loginResponse, logMsg];\n\n} else {\n    // ç™»å…¥å¤±æ•—\n    node.warn('[è™•ç†ç™»å…¥] âŒ ç™»å…¥å¤±æ•—è™•ç†');\n    node.warn(`[è™•ç†ç™»å…¥] å¤±æ•—åŸå› : ${message}`);\n\n    node.warn('[è™•ç†ç™»å…¥] æº–å‚™å›å‚³å¤±æ•—è¨Šæ¯:');\n    node.warn(JSON.stringify(loginResponse, null, 2));\n\n    node.status({\n        fill: \"red\",\n        shape: \"dot\",\n        text: \"ç™»å…¥å¤±æ•—\"\n    });\n\n    node.warn('[è™•ç†ç™»å…¥] Output 1: å›ç™»å…¥é é¢ï¼ˆå¤±æ•—ï¼‰');\n    node.warn('[è™•ç†ç™»å…¥] Output 2: null');\n    node.warn('=====================================');\n\n    // Output 1: å›ç™»å…¥é é¢ï¼ˆå¤±æ•—ï¼‰\n    // Output 2: nullï¼ˆä¸éœ€è¦è¨˜éŒ„ï¼‰\n    return [loginResponse, null];\n}",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 1380,
        "wires": [
            [
                "76465af65d0a586c"
            ],
            [
                "aa53009946c82bc4"
            ]
        ]
    },
    {
        "id": "aa53009946c82bc4",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "ç´€éŒ„ç™»å…¥",
        "func": "// =================================================================\n// è¨˜éŒ„ç™»å…¥ Function\n// ä½ç½®ï¼šè™•ç†ç™»å…¥é©—è­‰(Output2) â†’ [é€™è£¡] â†’ PostgreSQL â†’ ç™»å…¥Template\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\n// å¾ä¸Šä¸€å€‹ç¯€é»å–å¾—è³‡è¨Š\nconst loginResult = msg.payload?.login_result;\n\nif (!loginResult || !loginResult.success) {\n    node.warn('[è¨˜éŒ„ç™»å…¥] ç„¡æœ‰æ•ˆçš„ç™»å…¥è³‡è¨Š');\n    return null;\n}\n\nnode.warn(`[è¨˜éŒ„ç™»å…¥] è¨˜éŒ„å®¢æˆ¶ç™»å…¥: ${loginResult.customer_code}`);\n\n// æº–å‚™æ›´æ–°ç™»å…¥è¨˜éŒ„çš„ SQL\nmsg.query = `\n    UPDATE customers \n    SET last_login = CURRENT_TIMESTAMP,\n        login_count = COALESCE(login_count, 0) + 1\n    WHERE customer_code = $1\n    RETURNING customer_code, last_login, login_count;\n`;\n\nmsg.params = [loginResult.customer_code];\n\n// ä¿å­˜ç™»å…¥çµæœï¼Œä»¥ä¾¿æœ€å¾Œå›å‚³çµ¦å‰ç«¯\nmsg._login_result = loginResult;\n\nnode.status({\n    fill: \"blue\",\n    shape: \"ring\",\n    text: `è¨˜éŒ„: ${loginResult.customer_code}`\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 1460,
        "wires": [
            [
                "50077bd7027a9f6b"
            ]
        ]
    },
    {
        "id": "751f2d49f9d3373d",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "UI->SQL(ç™»å…¥)",
        "func": "// =================================================================\n// UIâ†’SQL è½‰æ›å™¨ - ä¿®æ­£å¤§å°å¯«å•é¡Œ\n// åœ¨ Node-RED çš„ UI->SQL ç¯€é»ä¸­ä¿®æ”¹\n// =================================================================\n\nconst action = msg.payload?.action;\n\nif (!action) {\n    node.warn('ç„¡å‹•ä½œé¡å‹');\n    return null;\n}\n\nnode.warn(`[UIâ†’SQL] å‹•ä½œ: ${action}`);\n\nswitch (action) {\n    // ========== å®¢æˆ¶ç™»å…¥æŸ¥è©¢ï¼ˆä¸åˆ†å¤§å°å¯«ç‰ˆï¼‰==========\n    case 'customer_login':\n        // ä¿æŒåŸå§‹è¼¸å…¥ï¼Œä¸è½‰æ›å¤§å°å¯«\n        let customerCode = msg.payload.customer_code;\n\n        // ä½¿ç”¨ä¸åˆ†å¤§å°å¯«çš„ SQL æŸ¥è©¢\n        msg.query = `\n            SELECT \n                customer_code,\n                customer_name,\n                password,\n                devices,\n                is_active\n            FROM customers\n            WHERE LOWER(customer_code) = LOWER($1)\n            AND is_active = true;\n        `;\n        msg.params = [customerCode];\n\n        // ä¿å­˜åŸå§‹è«‹æ±‚è³‡æ–™ï¼ˆåŒ…æ‹¬ request_idï¼‰\n        msg._original_request = {\n            action: 'customer_login',\n            customer_code: customerCode,  // ä¿æŒåŸå§‹å¤§å°å¯«\n            password: msg.payload.password,\n            request_id: msg.payload.request_id\n        };\n\n        node.warn(`[UIâ†’SQL] æŸ¥è©¢å®¢æˆ¶: ${customerCode} (ä¸åˆ†å¤§å°å¯«)`);\n        if (msg.payload.request_id) {\n            node.warn(`[UIâ†’SQL] Request ID: ${msg.payload.request_id}`);\n        }\n        break;\n\n    // ========== æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨ ==========\n    case 'list_customers':\n        msg.query = `\n            SELECT \n                customer_code,\n                customer_name,\n                array_length(devices, 1) as device_count,\n                devices,\n                is_active,\n                last_login,\n                login_count\n            FROM customers\n            WHERE LOWER(customer_code) != 'admin'\n            ORDER BY customer_code;\n        `;\n        msg.params = [];\n        msg._original_request = {\n            action: 'list_customers',\n            target: 'admin_page'\n        };\n        break;\n\n    // ========== æ–°å¢å®¢æˆ¶ ==========\n    case 'add_customer':\n        msg.query = `\n            INSERT INTO customers \n            (customer_code, customer_name, password, devices)\n            VALUES (UPPER($1), $2, $3, $4)\n            ON CONFLICT (customer_code) DO NOTHING\n            RETURNING *;\n        `;\n        msg.params = [\n            msg.payload.customer_code,  // SQL ä¸­è½‰å¤§å¯«\n            msg.payload.customer_name,\n            msg.payload.password || 'default123',\n            msg.payload.devices || []\n        ];\n        msg._original_request = {\n            action: 'add_customer',\n            target: 'admin_page'\n        };\n        break;\n\n    default:\n        node.warn(`æœªè™•ç†çš„å‹•ä½œ: ${action}`);\n        return null;\n}\n\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: action\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 1380,
        "wires": [
            [
                "965b781c3c3ac72e"
            ]
        ]
    },
    {
        "id": "50077bd7027a9f6b",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 1050,
        "y": 1460,
        "wires": [
            [
                "bb6030318f19580d"
            ]
        ]
    },
    {
        "id": "965b781c3c3ac72e",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 550,
        "y": 1380,
        "wires": [
            [
                "37c26e67b16a93cc"
            ]
        ]
    },
    {
        "id": "0fd0fd6e38884b98",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "UI->SQL(ç®¡ç†å“¡)",
        "func": "// =================================================================\n// UIâ†’SQL è½‰æ›å™¨ï¼ˆç®¡ç†å“¡å®Œæ•´ç‰ˆï¼‰\n// ä½ç½®ï¼šTemplate(ç®¡ç†ç•«é¢) â†’ [é€™è£¡] â†’ PostgreSQL\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\nconst action = msg.payload?.action;\n\nif (!action) {\n    node.warn('[UIâ†’SQL] ç„¡å‹•ä½œé¡å‹');\n    return null;\n}\n\nnode.warn('[UIâ†’SQL] å‹•ä½œ: ' + action);\n\nswitch (action) {\n    // ========== å®¢æˆ¶ç™»å…¥æŸ¥è©¢ ==========\n    case 'customer_login':\n        let customerCode = msg.payload.customer_code;\n        msg.query = `\n            SELECT \n                customer_code,\n                customer_name,\n                password,\n                devices,\n                is_active\n            FROM customers\n            WHERE LOWER(customer_code) = LOWER($1)\n            AND is_active = true;\n        `;\n        msg.params = [customerCode];\n        msg._original_request = {\n            action: 'customer_login',\n            customer_code: customerCode,\n            password: msg.payload.password,\n            request_id: msg.payload.request_id\n        };\n        node.warn('[UIâ†’SQL] æŸ¥è©¢å®¢æˆ¶: ' + customerCode);\n        break;\n\n    // ========== æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨ ==========\n    case 'list_customers':\n        msg.query = `\n            SELECT \n                customer_code,\n                customer_name,\n                array_length(devices, 1) as device_count,\n                devices,\n                is_active,\n                last_login,\n                login_count,\n                created_at\n            FROM customers\n            WHERE LOWER(customer_code) != 'admin'\n            ORDER BY customer_code;\n        `;\n        msg.params = [];\n        msg._original_request = {\n            action: 'list_customers',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨');\n        break;\n\n    // ========== æ–°å¢å®¢æˆ¶ ==========\n    case 'add_customer':\n        msg.query = `\n            INSERT INTO customers \n            (customer_code, customer_name, password, devices, is_active)\n            VALUES (UPPER($1), $2, $3, $4, true)\n            ON CONFLICT (customer_code) DO NOTHING\n            RETURNING *;\n        `;\n        msg.params = [\n            msg.payload.customer_code,\n            msg.payload.customer_name,\n            msg.payload.password || 'default123',\n            msg.payload.devices || []\n        ];\n        msg._original_request = {\n            action: 'add_customer',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æ–°å¢å®¢æˆ¶: ' + msg.payload.customer_code);\n        break;\n\n    // ========== æ›´æ–°å®¢æˆ¶è³‡æ–™ ==========\n    case 'update_customer':\n        if (msg.payload.password && msg.payload.password.trim() !== '') {\n            msg.query = `\n                UPDATE customers \n                SET customer_name = $2,\n                    password = $3,\n                    devices = $4,\n                    updated_at = CURRENT_TIMESTAMP\n                WHERE customer_code = $1\n                RETURNING *;\n            `;\n            msg.params = [\n                msg.payload.customer_code,\n                msg.payload.customer_name,\n                msg.payload.password,\n                msg.payload.devices || []\n            ];\n        } else {\n            msg.query = `\n                UPDATE customers \n                SET customer_name = $2,\n                    devices = $3,\n                    updated_at = CURRENT_TIMESTAMP\n                WHERE customer_code = $1\n                RETURNING *;\n            `;\n            msg.params = [\n                msg.payload.customer_code,\n                msg.payload.customer_name,\n                msg.payload.devices || []\n            ];\n        }\n        msg._original_request = {\n            action: 'update_customer',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æ›´æ–°å®¢æˆ¶: ' + msg.payload.customer_code);\n        break;\n\n    // ========== å•Ÿç”¨/åœç”¨å®¢æˆ¶ ==========\n    case 'toggle_customer':\n        msg.query = `\n            UPDATE customers \n            SET is_active = $2,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE customer_code = $1\n            RETURNING *;\n        `;\n        msg.params = [\n            msg.payload.customer_code,\n            msg.payload.is_active\n        ];\n        msg._original_request = {\n            action: 'toggle_customer',\n            target: 'admin_page'\n        };\n        const status = msg.payload.is_active ? 'å•Ÿç”¨' : 'åœç”¨';\n        node.warn('[UIâ†’SQL] ' + status + 'å®¢æˆ¶: ' + msg.payload.customer_code);\n        break;\n\n    // ========== æŸ¥è©¢æ‰€æœ‰è¨­å‚™ ==========\n    case 'list_all_devices':\n        msg.query = `\n            SELECT \n                d.device_id,\n                d.device_name,\n                d.location,\n                d.last_seen,\n                d.created_at,\n                (SELECT COUNT(*) FROM power_data WHERE device_id = d.device_id) as data_count,\n                (SELECT MAX(timestamp) FROM power_data WHERE device_id = d.device_id) as last_data_time\n            FROM devices d\n            ORDER BY d.device_id;\n        `;\n        msg.params = [];\n        msg._original_request = {\n            action: 'list_all_devices',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æŸ¥è©¢æ‰€æœ‰è¨­å‚™åˆ—è¡¨');\n        break;\n\n    // ========== æ–°å¢è¨­å‚™ ==========\n    case 'add_device':\n        msg.query = `\n            INSERT INTO devices (device_id, device_name, location, created_at)\n            VALUES ($1, $2, $3, CURRENT_TIMESTAMP)\n            ON CONFLICT (device_id) DO NOTHING\n            RETURNING *;\n        `;\n        msg.params = [\n            msg.payload.device_id,\n            msg.payload.device_name || '',\n            msg.payload.location || ''\n        ];\n        msg._original_request = {\n            action: 'add_device',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æ–°å¢è¨­å‚™: ' + msg.payload.device_id);\n        break;\n\n    // ========== æ›´æ–°è¨­å‚™ ==========\n    case 'update_device':\n        msg.query = `\n            UPDATE devices \n            SET device_name = $2,\n                location = $3,\n                last_seen = CURRENT_TIMESTAMP\n            WHERE device_id = $1\n            RETURNING *;\n        `;\n        msg.params = [\n            msg.payload.device_id,\n            msg.payload.device_name || '',\n            msg.payload.location || ''\n        ];\n        msg._original_request = {\n            action: 'update_device',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] æ›´æ–°è¨­å‚™: ' + msg.payload.device_id);\n        break;\n\n    // ========== åˆªé™¤è¨­å‚™ ==========\n    case 'delete_device':\n        msg.query = `\n            DELETE FROM devices\n            WHERE device_id = $1\n            RETURNING *;\n        `;\n        msg.params = [msg.payload.device_id];\n        msg._original_request = {\n            action: 'delete_device',\n            target: 'admin_page'\n        };\n        node.warn('[UIâ†’SQL] åˆªé™¤è¨­å‚™: ' + msg.payload.device_id);\n        break;\n\n    default:\n        node.warn('[UIâ†’SQL] æœªè™•ç†çš„å‹•ä½œ: ' + action);\n        return null;\n}\n\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: action\n});\n\nreturn msg;\n\n// =================================================================\n// ğŸ“‹ æ”¯æ´çš„å‹•ä½œæ¸…å–®\n// =================================================================\n//\n// ã€å®¢æˆ¶ç®¡ç†ã€‘\n//   customer_login       - å®¢æˆ¶ç™»å…¥é©—è­‰\n//   list_customers       - æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨\n//   add_customer         - æ–°å¢å®¢æˆ¶\n//   update_customer      - æ›´æ–°å®¢æˆ¶è³‡æ–™\n//   toggle_customer      - å•Ÿç”¨/åœç”¨å®¢æˆ¶\n//\n// ã€è¨­å‚™ç®¡ç†ã€‘\n//   list_all_devices     - æŸ¥è©¢æ‰€æœ‰è¨­å‚™\n//   add_device           - æ–°å¢è¨­å‚™\n//   update_device        - æ›´æ–°è¨­å‚™\n//   delete_device        - åˆªé™¤è¨­å‚™\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1600,
        "wires": [
            [
                "46fe9de1e088f31d"
            ]
        ]
    },
    {
        "id": "46fe9de1e088f31d",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 610,
        "y": 1600,
        "wires": [
            [
                "6131c7aa6f672e7d"
            ]
        ]
    },
    {
        "id": "6131c7aa6f672e7d",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "ç®¡ç†å“¡çµæœè™•ç†",
        "func": "// =================================================================\n// ç®¡ç†å“¡çµæœè™•ç†ç¨‹å¼ï¼ˆå®Œæ•´ç‰ˆï¼‰\n// ä½ç½®ï¼šPostgreSQL â†’ [é€™è£¡] â†’ UI Template\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\nconst log = (msg) => {\n    if (typeof node !== 'undefined' && node.warn) {\n        node.warn(msg);\n    }\n};\n\nlog('=====================================');\nlog('[ç®¡ç†å“¡çµæœ] é–‹å§‹è™•ç†');\nlog('=====================================');\n\n// ========== æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡æ“ä½œ ==========\nconst isAdminOperation = msg._original_request?.target === 'admin_page';\n\nif (!isAdminOperation) {\n    log('[ç®¡ç†å“¡çµæœ] ä¸æ˜¯ç®¡ç†å“¡æ“ä½œï¼Œè·³é');\n    return null;\n}\n\nconst action = msg._original_request.action;\nlog(`[ç®¡ç†å“¡çµæœ] è™•ç†å‹•ä½œ: ${action}`);\n\n// ========== æª¢æŸ¥ PostgreSQL éŒ¯èª¤ ==========\nif (msg.error) {\n    log(`[ç®¡ç†å“¡çµæœ] âŒ è³‡æ–™åº«éŒ¯èª¤: ${msg.error}`);\n\n    return {\n        payload: {\n            action: action,\n            error: msg.error,\n            success: false\n        }\n    };\n}\n\n// ========== æª¢æŸ¥æŸ¥è©¢çµæœ ==========\nif (!msg.payload) {\n    log('[ç®¡ç†å“¡çµæœ] âš ï¸ payload ç‚ºç©º');\n\n    return {\n        payload: {\n            action: action,\n            data: [],\n            success: true\n        }\n    };\n}\n\n// ========== è™•ç†ä¸åŒçš„å‹•ä½œ ==========\nlet result;\n\nif (Array.isArray(msg.payload)) {\n    // é™£åˆ—çµæœï¼ˆåˆ—è¡¨æŸ¥è©¢ï¼‰\n    log(`[ç®¡ç†å“¡çµæœ] âœ… æŸ¥è©¢åˆ° ${msg.payload.length} ç­†è³‡æ–™`);\n\n    result = {\n        payload: msg.payload  // ç›´æ¥å›å‚³ PostgreSQL çµæœ\n    };\n\n} else if (msg.payload && typeof msg.payload === 'object') {\n    // ç‰©ä»¶çµæœï¼ˆå–®ç­†æ“ä½œï¼‰\n    log('[ç®¡ç†å“¡çµæœ] âœ… æ“ä½œæˆåŠŸ');\n\n    result = {\n        payload: {\n            action: action,\n            data: msg.payload,\n            success: true\n        }\n    };\n\n} else {\n    // å…¶ä»–æƒ…æ³\n    log('[ç®¡ç†å“¡çµæœ] âš ï¸ æœªçŸ¥çš„çµæœæ ¼å¼');\n\n    result = {\n        payload: {\n            action: action,\n            data: msg.payload,\n            success: true\n        }\n    };\n}\n\n// ========== é™¤éŒ¯è³‡è¨Š ==========\nif (action === 'list_customers') {\n    log('[ç®¡ç†å“¡çµæœ] å®¢æˆ¶åˆ—è¡¨è³‡æ–™:');\n    if (Array.isArray(msg.payload) && msg.payload.length > 0) {\n        log(`  - ç¬¬ä¸€ç­†: ${JSON.stringify(msg.payload[0])}`);\n    }\n}\n\nif (action === 'get_all_devices') {\n    log('[ç®¡ç†å“¡çµæœ] è¨­å‚™åˆ—è¡¨è³‡æ–™:');\n    if (Array.isArray(msg.payload) && msg.payload.length > 0) {\n        log(`  - ç¬¬ä¸€ç­†: ${JSON.stringify(msg.payload[0])}`);\n    }\n}\n\nlog('[ç®¡ç†å“¡çµæœ] å›å‚³è³‡æ–™åˆ° UI Template');\nlog('=====================================');\n\n// ========== è¨­ç½®ç¯€é»ç‹€æ…‹ ==========\nif (typeof node !== 'undefined' && node.status) {\n    let statusText;\n    if (Array.isArray(msg.payload)) {\n        statusText = `âœ… ${action}: ${msg.payload.length}ç­†`;\n    } else {\n        statusText = `âœ… ${action}`;\n    }\n\n    node.status({\n        fill: \"green\",\n        shape: \"dot\",\n        text: statusText\n    });\n}\n\nreturn result;\n\n// =================================================================\n// ğŸ“‹ ä½¿ç”¨èªªæ˜\n// =================================================================\n//\n// 1. åœ¨ Node-RED ä¸­å‰µå»ºä¸€å€‹æ–°çš„ Function ç¯€é»\n// 2. åç¨±ï¼šç®¡ç†å“¡çµæœè™•ç†\n// 3. å°‡æ­¤ç¨‹å¼ç¢¼è¤‡è£½é€²å»\n// 4. è¼¸å‡ºæ•¸ï¼š1\n// 5. é€£ç·šæ–¹å¼ï¼š\n//    [PostgreSQL] â†’ [ç®¡ç†å“¡çµæœè™•ç†] â†’ [UI Template (admin)]\n//\n// =================================================================\n// ğŸ” è™•ç†çš„å‹•ä½œ\n// =================================================================\n//\n// - list_customers      æŸ¥è©¢å®¢æˆ¶åˆ—è¡¨\n// - add_customer        æ–°å¢å®¢æˆ¶\n// - update_customer     æ›´æ–°å®¢æˆ¶\n// - toggle_customer     å•Ÿç”¨/åœç”¨å®¢æˆ¶\n// - delete_customer     åˆªé™¤å®¢æˆ¶\n// - reset_password      é‡è¨­å¯†ç¢¼\n// - get_all_devices     æŸ¥è©¢æ‰€æœ‰è¨­å‚™\n//\n// =================================================================\n// ğŸ“Š å›å‚³æ ¼å¼\n// =================================================================\n//\n// åˆ—è¡¨æŸ¥è©¢ï¼ˆlist_customers, get_all_devicesï¼‰ï¼š\n// {\n//     payload: [\n//         {customer_code: 'A001', ...},\n//         {customer_code: 'B002', ...}\n//     ]\n// }\n//\n// å–®ç­†æ“ä½œï¼ˆadd_customer, update_customerï¼‰ï¼š\n// {\n//     payload: {\n//         action: 'add_customer',\n//         data: {...},\n//         success: true\n//     }\n// }\n//\n// éŒ¯èª¤æƒ…æ³ï¼š\n// {\n//     payload: {\n//         action: 'xxx',\n//         error: 'éŒ¯èª¤è¨Šæ¯',\n//         success: false\n//     }\n// }\n//\n// =================================================================",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 1600,
        "wires": [
            [
                "740d6b27f4e89580"
            ]
        ]
    },
    {
        "id": "bb6030318f19580d",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "ç™»å…¥å®Œæˆè™•ç†",
        "func": "// =================================================================\n// ç™»å…¥å®Œæˆè™•ç† Function\n// ä½ç½®ï¼šPostgreSQL(è¨˜éŒ„ç™»å…¥å¾Œ) â†’ [é€™è£¡] â†’ ç™»å…¥Template\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\n// å–å›åŸå§‹çš„ç™»å…¥çµæœ\nconst loginResult = msg._login_result;\n\nif (!loginResult) {\n    node.warn('[ç™»å…¥å®Œæˆ] ç„¡ç™»å…¥çµæœè³‡è¨Š');\n    return null;\n}\n\nnode.warn(`[ç™»å…¥å®Œæˆ] ç™»å…¥è¨˜éŒ„å·²æ›´æ–°: ${loginResult.customer_code}`);\n\n// å›å‚³æœ€çµ‚çš„æˆåŠŸè¨Šæ¯çµ¦å‰ç«¯\nmsg.payload = {\n    login_result: loginResult\n};\n\nnode.status({\n    fill: \"green\",\n    shape: \"dot\",\n    text: `âœ… å®Œæˆ: ${loginResult.customer_code}`\n});\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 1540,
        "wires": [
            [
                "76465af65d0a586c"
            ]
        ]
    },
    {
        "id": "b861867b1a0c0a32",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "æ¸¬è©¦POSTGRESQL æœƒå“¡ç™»å…¥",
        "func": "// =================================================================\n// æ¸¬è©¦ PostgreSQL é€£æ¥\n// å»ºç«‹ç¨ç«‹æ¸¬è©¦æµç¨‹ï¼š[Inject] â†’ [é€™å€‹Function] â†’ [PostgreSQL] â†’ [Debug]\n// =================================================================\n\n// æ¸¬è©¦ 1: ç°¡å–®æŸ¥è©¢æ‰€æœ‰å®¢æˆ¶\nmsg.query = \"SELECT * FROM customers\";\nmsg.params = [];\n\nnode.warn('ğŸ§ª æ¸¬è©¦ PostgreSQL é€£æ¥');\nnode.warn(`æŸ¥è©¢: ${msg.query}`);\n\nreturn msg;\n\n/* \n// æ¸¬è©¦ 2: æŸ¥è©¢ç‰¹å®š admin\nmsg.query = \"SELECT * FROM customers WHERE customer_code = $1\";\nmsg.params = ['admin'];\n\n// æ¸¬è©¦ 3: å®Œæ•´çš„ç™»å…¥æŸ¥è©¢\nmsg.query = `\n    SELECT \n        customer_code,\n        customer_name,\n        password,\n        devices,\n        is_active\n    FROM customers\n    WHERE customer_code = $1 \n    AND is_active = true\n    LIMIT 1\n`;\nmsg.params = ['admin'];\n*/",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 1740,
        "wires": [
            [
                "a41a376a2e55e3c6"
            ]
        ]
    },
    {
        "id": "adb8d25df3c9ffbf",
        "type": "inject",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 1740,
        "wires": [
            [
                "b861867b1a0c0a32"
            ]
        ]
    },
    {
        "id": "fce49d3641b5d281",
        "type": "debug",
        "z": "4f2c9b23a074cc9b",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 1740,
        "wires": []
    },
    {
        "id": "a41a376a2e55e3c6",
        "type": "postgresql",
        "z": "4f2c9b23a074cc9b",
        "name": "",
        "query": "{{{payload}}}",
        "postgreSQLConfig": "849c2c2e77621376",
        "split": false,
        "rowsPerMsg": 1,
        "outputs": 1,
        "x": 730,
        "y": 1740,
        "wires": [
            [
                "fce49d3641b5d281"
            ]
        ]
    },
    {
        "id": "37c26e67b16a93cc",
        "type": "function",
        "z": "4f2c9b23a074cc9b",
        "name": "Postgresqlçµæœè¨ºæ–·",
        "func": "// =================================================================\n// PostgreSQL çµæœè¨ºæ–· Function\n// ä½ç½®ï¼šPostgreSQL â†’ [é€™è£¡] â†’ é©—è­‰å¯†ç¢¼\n// è¼¸å‡ºæ•¸ï¼š1\n// =================================================================\n\nnode.warn('=====================================');\nnode.warn('[è¨ºæ–·] PostgreSQL çµæœ');\nnode.warn('=====================================');\n\n// æª¢æŸ¥å„ç¨®å¯èƒ½çš„æ ¼å¼\nnode.warn(`[è¨ºæ–·] msg.payload é¡å‹: ${typeof msg.payload}`);\nnode.warn(`[è¨ºæ–·] msg.payload æ˜¯é™£åˆ—: ${Array.isArray(msg.payload)}`);\n\nif (msg.payload === undefined) {\n    node.warn('[è¨ºæ–·] âŒ msg.payload = undefined');\n} else if (msg.payload === null) {\n    node.warn('[è¨ºæ–·] âŒ msg.payload = null');\n} else if (Array.isArray(msg.payload)) {\n    node.warn(`[è¨ºæ–·] âœ… é™£åˆ—é•·åº¦: ${msg.payload.length}`);\n    if (msg.payload.length > 0) {\n        node.warn('[è¨ºæ–·] ç¬¬ä¸€ç­†è³‡æ–™:');\n        node.warn(JSON.stringify(msg.payload[0], null, 2));\n    } else {\n        node.warn('[è¨ºæ–·] âš ï¸ ç©ºé™£åˆ—ï¼ˆæŸ¥ç„¡è³‡æ–™ï¼‰');\n    }\n} else {\n    node.warn('[è¨ºæ–·] å…¶ä»–æ ¼å¼:');\n    node.warn(JSON.stringify(msg.payload, null, 2));\n}\n\n// æª¢æŸ¥åŸå§‹è«‹æ±‚\nif (msg._original_request) {\n    node.warn('[è¨ºæ–·] åŸå§‹è«‹æ±‚è³‡è¨Š:');\n    node.warn(`  action: ${msg._original_request.action}`);\n    node.warn(`  customer_code: ${msg._original_request.customer_code}`);\n    node.warn(`  æœ‰å¯†ç¢¼: ${msg._original_request.password ? 'æ˜¯' : 'å¦'}`);\n} else {\n    node.warn('[è¨ºæ–·] âš ï¸ æ²’æœ‰ _original_request');\n}\n\n// æª¢æŸ¥éŒ¯èª¤\nif (msg.error) {\n    node.warn('[è¨ºæ–·] âŒ æœ‰éŒ¯èª¤:');\n    node.warn(JSON.stringify(msg.error, null, 2));\n}\n\nnode.warn('=====================================');\n\n// åŸå°ä¸å‹•å‚³é\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 1380,
        "wires": [
            [
                "df344886164dbd15"
            ]
        ]
    },
    {
        "id": "76465af65d0a586c",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "c3627b645dc69831",
        "page": "",
        "ui": "",
        "name": "ç™»å…¥ç•«é¢",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <div class=\"login-wrapper\">\n        <div class=\"login-card\">\n            <!-- Logo å€ -->\n            <div class=\"login-header\">\n                <!-- ğŸ¨ LOGO åœ–ç‰‡ï¼ˆéœ€è¦è¨­å®š Base64ï¼‰ -->\n                <img :src=\"logoBase64\" alt=\"SOLARSDGS\" class=\"brand-logo\">\n                <h1>SOLARSDGS</h1>\n                <p>Solar Power Monitoring System</p>\n            </div>\n\n            <!-- ç™»å…¥é¡å‹é¸æ“‡ -->\n            <div class=\"login-type-tabs\">\n                <button @click=\"loginType = 'customer'\"\n                        :class=\"['tab-btn', {active: loginType === 'customer'}]\">\n                    ğŸ¢ å®¢æˆ¶ç™»å…¥\n                </button>\n                <button @click=\"loginType = 'admin'\"\n                        :class=\"['tab-btn', {active: loginType === 'admin'}]\">\n                    ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡ç™»å…¥\n                </button>\n            </div>\n\n            <!-- ç™»å…¥è¡¨å–® -->\n            <div class=\"login-body\">\n                <!-- å®¢æˆ¶ç™»å…¥è¡¨å–® -->\n                <div v-if=\"loginType === 'customer'\">\n                    <div class=\"form-group\">\n                        <label>å®¢æˆ¶ä»£ç¢¼</label>\n                        <input v-model=\"customerCode\"\n                               class=\"form-control\"\n                               placeholder=\"è«‹è¼¸å…¥å®¢æˆ¶ä»£ç¢¼ (å¦‚: A001)\"\n                               @keyup.enter=\"handleCustomerLogin\">\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>å¯†ç¢¼</label>\n                        <input type=\"password\"\n                               v-model=\"password\"\n                               class=\"form-control\"\n                               placeholder=\"è«‹è¼¸å…¥å¯†ç¢¼\"\n                               @keyup.enter=\"handleCustomerLogin\">\n                    </div>\n\n                    <button @click=\"handleCustomerLogin\"\n                            class=\"login-btn\"\n                            :disabled=\"!customerCode || !password || loading\">\n                        {{loading ? 'é©—è­‰ä¸­...' : 'å®¢æˆ¶ç™»å…¥'}}\n                    </button>\n                </div>\n\n                <!-- ç®¡ç†å“¡ç™»å…¥è¡¨å–® -->\n                <div v-if=\"loginType === 'admin'\">\n                    <div class=\"form-group\">\n                        <label>ç®¡ç†å“¡å¯†ç¢¼</label>\n                        <input type=\"password\"\n                               v-model=\"adminPassword\"\n                               class=\"form-control\"\n                               placeholder=\"è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼\"\n                               @keyup.enter=\"handleAdminLogin\">\n                    </div>\n\n                    <button @click=\"handleAdminLogin\"\n                            class=\"login-btn admin-btn\"\n                            :disabled=\"!adminPassword || loading\">\n                        {{loading ? 'é©—è­‰ä¸­...' : 'ç®¡ç†å“¡ç™»å…¥'}}\n                    </button>\n                </div>\n\n                <!-- éŒ¯èª¤è¨Šæ¯ -->\n                <div v-if=\"errorMsg\" class=\"error-msg\">\n                    âš ï¸ {{errorMsg}}\n                </div>\n\n                <!-- æ¸¬è©¦æç¤ºï¼ˆé–‹ç™¼ç”¨ï¼‰-->\n                <div v-if=\"showHint\" class=\"hint-box\">\n                    <small>\n                        ğŸ’¡ æ¸¬è©¦å¸³è™Ÿï¼š<br>\n                        å®¢æˆ¶: A001 / tsmc2024<br>\n                        ç®¡ç†å“¡: 82767419\n                    </small>\n                </div>\n            </div>\n\n            <!-- é å°¾ -->\n            <div class=\"login-footer\">\n                <small>Â© 2025 SOLARSDGS | Solar Power Monitoring System</small>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n    data() {\n        return {\n            // ğŸ¨ åœ¨é€™è£¡è²¼ä¸Šä½ çš„ LOGO Base64 å­—ä¸²\n            logoBase64: 'data:image/png;base64,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',\n            \n            loginType: 'customer',\n            customerCode: '',\n            password: '',\n            adminPassword: '',\n            errorMsg: '',\n            loading: false,\n            showHint: true,\n            loginRequestId: null,\n            waitingForResponse: false\n        }\n    },\n    \n    mounted() {\n        console.log('ğŸš€ SOLARSDGS ç™»å…¥é é¢è¼‰å…¥');\n        console.log('ğŸ“ ç­‰å¾…ç”¨æˆ¶æ“ä½œ');\n        \n        this.waitingForResponse = false;\n        this.loginRequestId = null;\n    },\n    \n    methods: {\n        // å®¢æˆ¶ç™»å…¥\n        handleCustomerLogin() {\n            if (!this.customerCode || !this.password) {\n                this.errorMsg = 'è«‹è¼¸å…¥å®¢æˆ¶ä»£ç¢¼å’Œå¯†ç¢¼';\n                return;\n            }\n            \n            this.errorMsg = '';\n            this.loading = true;\n            \n            this.loginRequestId = `login_${Date.now()}`;\n            this.waitingForResponse = true;\n            \n            console.log(`ğŸ” å®¢æˆ¶ç™»å…¥: ${this.customerCode}`);\n            console.log(`ğŸ†” è«‹æ±‚ ID: ${this.loginRequestId}`);\n            \n            this.send({\n                payload: {\n                    action: 'customer_login',\n                    customer_code: this.customerCode.toUpperCase(),\n                    password: this.password,\n                    request_id: this.loginRequestId\n                }\n            });\n            \n            setTimeout(() => {\n                if (this.loading && this.waitingForResponse) {\n                    this.loading = false;\n                    this.waitingForResponse = false;\n                    this.errorMsg = 'ç™»å…¥è«‹æ±‚è¶…æ™‚ï¼ˆ10ç§’ï¼‰ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';\n                    console.error('â° ç™»å…¥è¶…æ™‚');\n                }\n            }, 10000);\n        },\n        \n        // ç®¡ç†å“¡ç™»å…¥\n        handleAdminLogin() {\n            if (!this.adminPassword) {\n                this.errorMsg = 'è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼';\n                return;\n            }\n            \n            this.errorMsg = '';\n            this.loading = true;\n            \n            this.loginRequestId = `login_${Date.now()}`;\n            this.waitingForResponse = true;\n            \n            console.log('ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡ç™»å…¥å˜—è©¦');\n            console.log(`ğŸ†” è«‹æ±‚ ID: ${this.loginRequestId}`);\n            \n            this.send({\n                payload: {\n                    action: 'customer_login',\n                    customer_code: 'admin',\n                    password: this.adminPassword,\n                    request_id: this.loginRequestId\n                }\n            });\n            \n            setTimeout(() => {\n                if (this.loading && this.waitingForResponse) {\n                    this.loading = false;\n                    this.waitingForResponse = false;\n                    this.errorMsg = 'ç™»å…¥è«‹æ±‚è¶…æ™‚ï¼ˆ10ç§’ï¼‰ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';\n                    console.error('â° ç™»å…¥è¶…æ™‚');\n                }\n            }, 10000);\n        },\n        \n        // å»ºç«‹ session\n        createSession(loginData) {\n            localStorage.setItem('solar_customer', loginData.customer_code);\n            localStorage.setItem('solar_customer_name', loginData.customer_name);\n            localStorage.setItem('solar_devices', JSON.stringify(loginData.devices || []));\n            localStorage.setItem('solar_login_time', Date.now());\n            localStorage.setItem('solar_is_admin', loginData.is_admin || false);\n            \n            console.log(`âœ… Session å·²å»ºç«‹: ${loginData.customer_code}`);\n        },\n        \n        // è·³è½‰åˆ°å°æ‡‰é é¢\n        redirectToDashboard(loginData) {\n            console.log('ğŸš€ æº–å‚™è·³è½‰...');\n            \n            if (loginData.is_admin) {\n                console.log('ğŸ‘¨â€ğŸ’¼ è·³è½‰åˆ°ç®¡ç†å“¡é é¢');\n                window.location.href = '/dashboard/admin';\n            } else {\n                const devices = loginData.devices || [];\n                const firstDevice = devices[0] || '6001';\n                console.log(`ğŸ¢ è·³è½‰åˆ°å®¢æˆ¶ç›£æ§é é¢: ${firstDevice}`);\n                window.location.href = `/dashboard/page1?device=${firstDevice}`;\n            }\n        }\n    },\n    \n    watch: {\n        msg: {\n            handler(msg) {\n                if (!msg || !msg.payload) {\n                    return;\n                }\n                \n                console.log('ğŸ“¥ æ”¶åˆ°è¨Šæ¯:', JSON.stringify(msg, null, 2));\n                \n                if (!this.waitingForResponse) {\n                    console.log('âš ï¸ ç•¶å‰ä¸åœ¨ç­‰å¾…ç™»å…¥å›æ‡‰ç‹€æ…‹ï¼Œå¿½ç•¥æ­¤è¨Šæ¯');\n                    return;\n                }\n                \n                if (msg.payload.login_result) {\n                    const result = msg.payload.login_result;\n                    console.log('ğŸ¯ æ”¶åˆ°ç™»å…¥çµæœ:', result);\n                    \n                    if (msg.payload.request_id && msg.payload.request_id !== this.loginRequestId) {\n                        console.warn('âš ï¸ è«‹æ±‚ ID ä¸åŒ¹é…');\n                        return;\n                    }\n                    \n                    if (result.success) {\n                        console.log('âœ… ç™»å…¥æˆåŠŸï¼');\n                        \n                        this.loading = false;\n                        this.waitingForResponse = false;\n                        this.loginRequestId = null;\n                        \n                        this.createSession({\n                            customer_code: result.customer_code,\n                            customer_name: result.customer_name,\n                            devices: result.devices || [],\n                            is_admin: result.customer_code === 'admin'\n                        });\n                        \n                        setTimeout(() => {\n                            this.redirectToDashboard({\n                                customer_code: result.customer_code,\n                                devices: result.devices || [],\n                                is_admin: result.customer_code === 'admin'\n                            });\n                        }, 100);\n                        \n                    } else {\n                        console.log('âŒ ç™»å…¥å¤±æ•—:', result.message);\n                        \n                        this.errorMsg = result.message || 'ç™»å…¥å¤±æ•—';\n                        this.loading = false;\n                        this.waitingForResponse = false;\n                        this.loginRequestId = null;\n                    }\n                }\n            },\n            deep: true\n        }\n    }\n}\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 180,
        "y": 1380,
        "wires": [
            [
                "751f2d49f9d3373d"
            ]
        ]
    },
    {
        "id": "740d6b27f4e89580",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "7f54281a9ecb8f13",
        "page": "",
        "ui": "",
        "name": "ç®¡ç†ç•«é¢",
        "order": 1,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <div class=\"admin-dashboard\">\n        <!-- Header -->\n        <div class=\"admin-header\">\n            <div style=\"display: flex; align-items: center; gap: 15px;\">\n                <!-- LOGO -->\n                <img :src=\"logoBase64\"\n                     alt=\"SOLARSDGS\"\n                     style=\"height: 40px; filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));\">\n                <h1>SOLARSDGS ç®¡ç†ä¸­å¿ƒ</h1>\n            </div>\n            <button @click=\"logout\" class=\"logout-btn\">ç™»å‡º</button>\n        </div>\n\n        <!-- Tabs -->\n        <div class=\"tabs\">\n            <button v-for=\"tab in tabs\"\n                    :key=\"tab.id\"\n                    @click=\"activeTab = tab.id\"\n                    :class=\"['tab', {active: activeTab === tab.id}]\">\n                {{tab.icon}} {{tab.name}}\n            </button>\n        </div>\n\n        <!-- å®¢æˆ¶ç®¡ç† -->\n        <div v-if=\"activeTab === 'customers'\" class=\"tab-content\">\n            <div class=\"toolbar\">\n                <h2>å®¢æˆ¶ç®¡ç†</h2>\n                <button @click=\"showAddCustomer = true\" class=\"btn-primary\">\n                    â• æ–°å¢å®¢æˆ¶\n                </button>\n            </div>\n\n            <table class=\"data-table\">\n                <thead>\n                    <tr>\n                        <th>å®¢æˆ¶ä»£ç¢¼</th>\n                        <th>å…¬å¸åç¨±</th>\n                        <th>è¨­å‚™æ•¸é‡</th>\n                        <th>ç‹€æ…‹</th>\n                        <th>æ“ä½œ</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr v-for=\"customer in customers\" :key=\"customer.customer_code\">\n                        <td><strong>{{customer.customer_code}}</strong></td>\n                        <td>{{customer.customer_name}}</td>\n                        <td>{{customer.device_count || 0}}</td>\n                        <td>\n                            <span :class=\"['status-badge', customer.is_active ? 'active' : 'inactive']\">\n                                {{customer.is_active ? 'å•Ÿç”¨' : 'åœç”¨'}}\n                            </span>\n                        </td>\n                        <td>\n                            <button @click=\"editCustomer(customer)\" class=\"btn-sm\">ç·¨è¼¯</button>\n                            <button @click=\"toggleCustomer(customer)\" class=\"btn-sm\">\n                                {{customer.is_active ? 'åœç”¨' : 'å•Ÿç”¨'}}\n                            </button>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n\n        <!-- è¨­å‚™ç®¡ç†ï¼ˆæ‰‹å‹•ç‰ˆï¼‰-->\n        <div v-if=\"activeTab === 'devices'\" class=\"tab-content\">\n            <div class=\"toolbar\">\n                <h2>è¨­å‚™ç®¡ç†</h2>\n                <div class=\"toolbar-actions\">\n                    <button @click=\"showAddDevice = true\" class=\"btn-primary\">\n                        â• æ–°å¢è¨­å‚™\n                    </button>\n                    <button @click=\"loadAllDevices\" class=\"btn-secondary\">\n                        ğŸ”„ é‡æ–°è¼‰å…¥\n                    </button>\n                </div>\n            </div>\n\n            <!-- è¼‰å…¥ä¸­ -->\n            <div v-if=\"devicesLoading\" class=\"loading-box\">\n                <p>â³ è¼‰å…¥è¨­å‚™åˆ—è¡¨ä¸­...</p>\n            </div>\n\n            <!-- è¨­å‚™åˆ—è¡¨ -->\n            <div v-else-if=\"allDevices.length > 0\">\n                <table class=\"data-table\">\n                    <thead>\n                        <tr>\n                            <th>è¨­å‚™ç·¨è™Ÿ</th>\n                            <th>è¨­å‚™åç¨±</th>\n                            <th>ä½ç½®</th>\n                            <th>æ“æœ‰è€…</th>\n                            <th>æœ€å¾Œä¸Šç·š</th>\n                            <th>ç‹€æ…‹</th>\n                            <th>æ•¸æ“šç­†æ•¸</th>\n                            <th>æ“ä½œ</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr v-for=\"device in allDevices\" :key=\"device.device_id\">\n                            <td><strong>{{device.device_id}}</strong></td>\n                            <td>{{device.device_name || '-'}}</td>\n                            <td>{{device.location || '-'}}</td>\n                            <td>{{getDeviceOwner(device.device_id)}}</td>\n                            <td>{{formatDateTime(device.last_seen)}}</td>\n                            <td>\n                                <span :class=\"['device-status', isDeviceOnline(device) ? 'online' : 'offline']\">\n                                    {{isDeviceOnline(device) ? 'åœ¨ç·š' : device.last_seen ? 'é›¢ç·š' : 'æœªä¸Šç·š'}}\n                                </span>\n                            </td>\n                            <td>{{device.data_count || 0}}</td>\n                            <td>\n                                <button @click=\"editDevice(device)\" class=\"btn-sm btn-edit\">ç·¨è¼¯</button>\n                                <button @click=\"reassignDevice(device.device_id)\" class=\"btn-sm btn-assign\">åˆ†é…</button>\n                                <button @click=\"goToDeviceMonitor(device.device_id)\" class=\"btn-sm btn-monitor\">ğŸ“Š ç›£æ§</button>\n                                <button @click=\"deleteDevice(device)\" class=\"btn-sm btn-danger\">åˆªé™¤</button>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n\n            <!-- ç„¡è¨­å‚™ -->\n            <div v-else class=\"empty-box\">\n                <p>ğŸ“­ ç›®å‰æ²’æœ‰ä»»ä½•è¨­å‚™</p>\n                <p class=\"text-muted\">é»æ“Šã€Œâ• æ–°å¢è¨­å‚™ã€æŒ‰éˆ•ä¾†æ‰‹å‹•æ·»åŠ è¨­å‚™</p>\n            </div>\n        </div>\n\n        <!-- æ–°å¢/ç·¨è¼¯å®¢æˆ¶å°è©±æ¡† -->\n        <div v-if=\"showAddCustomer || editingCustomer\" class=\"modal\">\n            <div class=\"modal-content\">\n                <h2>{{editingCustomer ? 'ç·¨è¼¯å®¢æˆ¶' : 'æ–°å¢å®¢æˆ¶'}}</h2>\n\n                <div class=\"form-group\">\n                    <label>å®¢æˆ¶ä»£ç¢¼</label>\n                    <input v-model=\"formData.customer_code\"\n                           placeholder=\"å¦‚: D001\"\n                           :disabled=\"!!editingCustomer\"\n                           class=\"form-control\">\n                </div>\n\n                <div class=\"form-group\">\n                    <label>å…¬å¸åç¨±</label>\n                    <input v-model=\"formData.customer_name\"\n                           placeholder=\"å¦‚: å°ç£å¤ªé™½èƒ½ç§‘æŠ€\"\n                           class=\"form-control\">\n                </div>\n\n                <div class=\"form-group\">\n                    <label>ç™»å…¥å¯†ç¢¼</label>\n                    <input v-model=\"formData.password\"\n                           type=\"password\"\n                           :placeholder=\"editingCustomer ? 'ç•™ç©ºè¡¨ç¤ºä¸ä¿®æ”¹' : 'è«‹è¨­å®šå¯†ç¢¼'\"\n                           class=\"form-control\">\n                </div>\n\n                <div class=\"form-group\">\n                    <label>åˆ†é…è¨­å‚™ï¼ˆå¯é¸ï¼‰</label>\n                    <div class=\"device-selector\">\n                        <label v-for=\"device in allDevices\" :key=\"device.device_id\" class=\"checkbox-label\">\n                            <input type=\"checkbox\" \n                                   :value=\"device.device_id\"\n                                   v-model=\"formData.devices\">\n                            {{device.device_id}} - {{device.device_name || 'æœªå‘½å'}}\n                        </label>\n                    </div>\n                </div>\n\n                <div class=\"modal-actions\">\n                    <button @click=\"saveCustomer\" class=\"btn-primary\">å„²å­˜</button>\n                    <button @click=\"closeCustomerModal\" class=\"btn-secondary\">å–æ¶ˆ</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- åˆ†é…è¨­å‚™å°è©±æ¡† -->\n        <div v-if=\"showReassignDialog\" class=\"modal\">\n            <div class=\"modal-content\">\n                <h2>åˆ†é…è¨­å‚™: {{reassignDeviceId}}</h2>\n\n                <div class=\"form-group\">\n                    <label>é¸æ“‡å®¢æˆ¶</label>\n                    <select v-model=\"reassignToCustomer\" class=\"form-control\">\n                        <option value=\"\">-- ç§»é™¤åˆ†é…ï¼ˆè¨­ç‚ºæœªåˆ†é…ï¼‰--</option>\n                        <option v-for=\"customer in customers\" \n                                :key=\"customer.customer_code\"\n                                :value=\"customer.customer_code\">\n                            {{customer.customer_code}} - {{customer.customer_name}}\n                        </option>\n                    </select>\n                </div>\n\n                <div class=\"modal-actions\">\n                    <button @click=\"confirmReassign\" class=\"btn-primary\">ç¢ºå®šåˆ†é…</button>\n                    <button @click=\"showReassignDialog = false\" class=\"btn-secondary\">å–æ¶ˆ</button>\n                </div>\n            </div>\n        </div>\n\n        <!-- æ–°å¢/ç·¨è¼¯è¨­å‚™å°è©±æ¡† -->\n        <div v-if=\"showAddDevice || editingDevice\" class=\"modal\">\n            <div class=\"modal-content\">\n                <h2>{{editingDevice ? 'ç·¨è¼¯è¨­å‚™' : 'æ–°å¢è¨­å‚™'}}</h2>\n\n                <div class=\"form-group\">\n                    <label>è¨­å‚™ç·¨è™Ÿ *</label>\n                    <input v-model=\"deviceFormData.device_id\"\n                           placeholder=\"å¦‚: 6001 æˆ– A001\"\n                           :disabled=\"!!editingDevice\"\n                           class=\"form-control\">\n                    <small class=\"hint\">å»ºè­°æ ¼å¼ï¼š6001-6999 æˆ– A001-Z999</small>\n                </div>\n\n                <div class=\"form-group\">\n                    <label>è¨­å‚™åç¨±</label>\n                    <input v-model=\"deviceFormData.device_name\"\n                           placeholder=\"å¦‚: æ¸¬è©¦æ©Ÿ-å°ä¸­å» \"\n                           class=\"form-control\">\n                </div>\n\n                <div class=\"form-group\">\n                    <label>è¨­å‚™ä½ç½®</label>\n                    <input v-model=\"deviceFormData.location\"\n                           placeholder=\"å¦‚: å°ä¸­å¸‚è¥¿å±¯å€\"\n                           class=\"form-control\">\n                </div>\n\n                <div class=\"modal-actions\">\n                    <button @click=\"saveDevice\" class=\"btn-primary\">å„²å­˜</button>\n                    <button @click=\"closeDeviceModal\" class=\"btn-secondary\">å–æ¶ˆ</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    export default {\n    data() {\n        return {\n            activeTab: 'customers',\n            tabs: [\n                {id: 'customers', name: 'å®¢æˆ¶ç®¡ç†', icon: 'ğŸ‘¥'},\n                {id: 'devices', name: 'è¨­å‚™åˆ†é…', icon: 'ğŸ“Ÿ'}\n            ],\n            customers: [],\n            allDevices: [],\n            devicesLoading: false,\n            \n            // LOGO Base64ï¼ˆé ç•™ä½ç½®ï¼‰\n            logoBase64: 'data:image/png;base64,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',\n            // å®¢æˆ¶ç›¸é—œ\n            showAddCustomer: false,\n            editingCustomer: null,\n            formData: {\n                customer_code: '',\n                customer_name: '',\n                password: '',\n                devices: []\n            },\n            \n            // è¨­å‚™ç›¸é—œ\n            showAddDevice: false,\n            editingDevice: null,\n            deviceFormData: {\n                device_id: '',\n                device_name: '',\n                location: ''\n            },\n            \n            // åˆ†é…ç›¸é—œ\n            showReassignDialog: false,\n            reassignDeviceId: '',\n            reassignToCustomer: ''\n        }\n    },\n    \n    mounted() {\n        console.log('ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡é é¢è¼‰å…¥ï¼ˆæ‰‹å‹•è¨­å‚™ç®¡ç†ç‰ˆï¼‰');\n        \n        const isAdmin = localStorage.getItem('solar_is_admin');\n        if (isAdmin !== 'true') {\n            alert('â›” ç„¡æ¬Šé™è¨ªå•ç®¡ç†é é¢');\n            window.location.href = '/dashboard/login';\n            return;\n        }\n        \n        this.loadCustomers();\n        this.loadAllDevices();\n    },\n    \n    methods: {\n        // ========== å®¢æˆ¶ç®¡ç† ==========\n        loadCustomers() {\n            console.log('ğŸ“‹ è¼‰å…¥å®¢æˆ¶åˆ—è¡¨');\n            this.send({\n                payload: {\n                    action: 'list_customers'\n                }\n            });\n        },\n        \n        saveCustomer() {\n            if (!this.formData.customer_code || !this.formData.customer_name) {\n                alert('âš ï¸ è«‹å¡«å¯«å®¢æˆ¶ä»£ç¢¼å’Œå…¬å¸åç¨±');\n                return;\n            }\n            \n            const action = this.editingCustomer ? 'update_customer' : 'add_customer';\n            const payload = {\n                action: action,\n                customer_code: this.formData.customer_code,\n                customer_name: this.formData.customer_name,\n                devices: this.formData.devices\n            };\n            \n            if (this.formData.password) {\n                payload.password = this.formData.password;\n            }\n            \n            console.log(`ğŸ’¾ ${this.editingCustomer ? 'æ›´æ–°' : 'æ–°å¢'}å®¢æˆ¶:`, payload);\n            this.send({ payload });\n            \n            this.closeCustomerModal();\n            setTimeout(() => this.loadCustomers(), 500);\n        },\n        \n        editCustomer(customer) {\n            console.log('âœï¸ ç·¨è¼¯å®¢æˆ¶:', customer);\n            this.editingCustomer = customer;\n            this.formData = {\n                customer_code: customer.customer_code,\n                customer_name: customer.customer_name,\n                password: '',\n                devices: customer.devices || []\n            };\n        },\n        \n        toggleCustomer(customer) {\n            const action = customer.is_active ? 'disable_customer' : 'enable_customer';\n            const actionText = customer.is_active ? 'åœç”¨' : 'å•Ÿç”¨';\n            \n            if (!confirm(`ç¢ºå®šè¦${actionText}å®¢æˆ¶ ${customer.customer_code} å—ï¼Ÿ`)) return;\n            \n            console.log(`ğŸ”„ ${actionText}å®¢æˆ¶:`, customer.customer_code);\n            this.send({\n                payload: {\n                    action: action,\n                    customer_code: customer.customer_code\n                }\n            });\n            \n            setTimeout(() => this.loadCustomers(), 500);\n        },\n        \n        closeCustomerModal() {\n            this.showAddCustomer = false;\n            this.editingCustomer = null;\n            this.formData = {\n                customer_code: '',\n                customer_name: '',\n                password: '',\n                devices: []\n            };\n        },\n        \n        // ========== è¨­å‚™ç®¡ç† ==========\n        loadAllDevices() {\n            console.log('ğŸ“‹ è¼‰å…¥æ‰€æœ‰è¨­å‚™');\n            this.devicesLoading = true;\n            this.send({\n                payload: {\n                    action: 'list_all_devices'\n                }\n            });\n        },\n        \n        saveDevice() {\n            if (!this.deviceFormData.device_id) {\n                alert('âš ï¸ è«‹å¡«å¯«è¨­å‚™ç·¨è™Ÿ');\n                return;\n            }\n            \n            const action = this.editingDevice ? 'update_device' : 'add_device';\n            const payload = {\n                action: action,\n                device_id: this.deviceFormData.device_id,\n                device_name: this.deviceFormData.device_name,\n                location: this.deviceFormData.location\n            };\n            \n            console.log(`ğŸ’¾ ${this.editingDevice ? 'æ›´æ–°' : 'æ–°å¢'}è¨­å‚™:`, payload);\n            this.send({ payload });\n            \n            this.closeDeviceModal();\n            setTimeout(() => this.loadAllDevices(), 500);\n        },\n        \n        editDevice(device) {\n            console.log('âœï¸ ç·¨è¼¯è¨­å‚™:', device);\n            this.editingDevice = device;\n            this.deviceFormData = {\n                device_id: device.device_id,\n                device_name: device.device_name || '',\n                location: device.location || ''\n            };\n            this.showAddDevice = true;\n        },\n        \n        deleteDevice(device) {\n            if (!confirm(`ç¢ºå®šè¦åˆªé™¤è¨­å‚™ ${device.device_id} å—ï¼Ÿ\\nâš ï¸ æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) return;\n            \n            console.log('ğŸ—‘ï¸ åˆªé™¤è¨­å‚™:', device.device_id);\n            this.send({\n                payload: {\n                    action: 'delete_device',\n                    device_id: device.device_id\n                }\n            });\n            \n            setTimeout(() => this.loadAllDevices(), 500);\n        },\n        \n        closeDeviceModal() {\n            this.showAddDevice = false;\n            this.editingDevice = null;\n            this.deviceFormData = {\n                device_id: '',\n                device_name: '',\n                location: ''\n            };\n        },\n        \n        reassignDevice(deviceId) {\n            console.log('ğŸ”„ é–‹å•Ÿåˆ†é…å°è©±æ¡†:', deviceId);\n            this.reassignDeviceId = deviceId;\n            this.reassignToCustomer = '';\n            this.showReassignDialog = true;\n        },\n        \n        confirmReassign() {\n            console.log(`ğŸ”„ åˆ†é…è¨­å‚™ ${this.reassignDeviceId} çµ¦ ${this.reassignToCustomer || 'æœªåˆ†é…'}`);\n            \n            this.send({\n                payload: {\n                    action: 'reassign_device',\n                    device_id: this.reassignDeviceId,\n                    customer_code: this.reassignToCustomer || null\n                }\n            });\n            \n            this.showReassignDialog = false;\n            setTimeout(() => {\n                this.loadCustomers();\n                this.loadAllDevices();\n            }, 500);\n        },\n        \n        // ========== ç›£æ§åŠŸèƒ½ ==========\n        goToDeviceMonitor(deviceId) {\n            console.log(`ğŸ“Š è·³è½‰åˆ°è¨­å‚™ ${deviceId} çš„ç›£æ§é é¢`);\n            window.location.href = `/dashboard/page1?device=${deviceId}`;\n        },\n        \n        // ========== è¼”åŠ©å‡½æ•¸ ==========\n        getDeviceOwner(deviceId) {\n            for (const customer of this.customers) {\n                if (customer.devices && customer.devices.includes(deviceId)) {\n                    return customer.customer_code;\n                }\n            }\n            return '-';\n        },\n        \n        isDeviceOnline(device) {\n            if (!device.last_seen) return false;\n            const lastSeen = new Date(device.last_seen);\n            const now = new Date();\n            const diffMinutes = (now - lastSeen) / 1000 / 60;\n            return diffMinutes < 5;\n        },\n        \n        formatDateTime(dateStr) {\n            if (!dateStr) return '-';\n            const date = new Date(dateStr);\n            return date.toLocaleString('zh-TW', {\n                year: 'numeric',\n                month: '2-digit',\n                day: '2-digit',\n                hour: '2-digit',\n                minute: '2-digit'\n            });\n        },\n        \n        logout() {\n            if (!confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) return;\n            localStorage.removeItem('solar_is_admin');\n            localStorage.removeItem('solar_customer_code');\n            window.location.href = '/dashboard/login';\n        }\n    },\n    \n    watch: {\n        msg: {\n            handler(msg) {\n                if (!msg || !msg.payload) return;\n                \n                console.log('ğŸ“¥ æ”¶åˆ°è³‡æ–™:', msg.payload);\n                \n                if (Array.isArray(msg.payload) && msg.payload.length > 0) {\n                    if (msg.payload[0].hasOwnProperty('device_id')) {\n                        this.allDevices = msg.payload;\n                        this.devicesLoading = false;\n                        console.log(`âœ… è¼‰å…¥ ${this.allDevices.length} å€‹è¨­å‚™`);\n                    } else if (msg.payload[0].hasOwnProperty('customer_code')) {\n                        this.customers = msg.payload;\n                        console.log(`âœ… è¼‰å…¥ ${this.customers.length} å€‹å®¢æˆ¶`);\n                    }\n                } else if (Array.isArray(msg.payload) && msg.payload.length === 0) {\n                    if (this.devicesLoading) {\n                        this.allDevices = [];\n                        this.devicesLoading = false;\n                        console.log('â„¹ï¸ è¨­å‚™åˆ—è¡¨ç‚ºç©º');\n                    }\n                }\n            },\n            deep: true\n        }\n    }\n}\n</script>",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 220,
        "y": 1600,
        "wires": [
            [
                "0fd0fd6e38884b98"
            ]
        ]
    },
    {
        "id": "14d9b44e47dacd43",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "",
        "page": "e4c8b01d1e02491a",
        "ui": "",
        "name": "CSS(ç™»å…¥ç•«é¢)",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ================================================================\n   SOLARSDGS ç™»å…¥é é¢æ¨£å¼è¡¨\n   å“ç‰Œè‰²ç³»ï¼šé‡‘é»ƒ (#FFD700 / #FFC107 / #FFB300) + æ·±è—é»‘ (#2c3e50)\n   ================================================================ */\n\n/* ğŸ¨ å…¨å±€æ¨£å¼è¦†è“‹ï¼ˆå¼·åˆ¶æ·ºè‰²æ¨¡å¼ï¼‰ */\n:root {\n    --primary-gold: #FFC107;\n    --primary-gold-light: #FFD700;\n    --primary-gold-dark: #FFB300;\n    --dark-blue: #2c3e50;\n    --dark-blue-light: #34495e;\n    --success-green: #4CAF50;\n    --warning-orange: #f39c12;\n    --danger-red: #e74c3c;\n    --text-dark: #2c3e50;\n    --text-light: #7f8c8d;\n    --bg-light: #f5f6fa;\n}\n\n/* å¼·åˆ¶æ·ºè‰²æ¨¡å¼ */\n.login-wrapper,\n.login-wrapper * {\n    color-scheme: light !important;\n}\n\n/* åŸºç¤é‡ç½® */\n.login-wrapper * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\n/* ================================================================\n   å¤–å±¤å®¹å™¨ - æ·±è‰²æ¼¸å±¤èƒŒæ™¯\n   ================================================================ */\n.login-wrapper {\n    min-height: 100vh;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: linear-gradient(135deg, var(--dark-blue) 0%, var(--dark-blue-light) 100%);\n    padding: 20px;\n    position: relative;\n    overflow: hidden;\n}\n\n/* èƒŒæ™¯å‹•ç•«å…‰æšˆ */\n.login-wrapper::before {\n    content: '';\n    position: absolute;\n    width: 500px;\n    height: 500px;\n    background: radial-gradient(circle, var(--primary-gold) 0%, transparent 70%);\n    opacity: 0.1;\n    top: -250px;\n    right: -250px;\n    animation: pulse 4s ease-in-out infinite;\n}\n\n.login-wrapper::after {\n    content: '';\n    position: absolute;\n    width: 400px;\n    height: 400px;\n    background: radial-gradient(circle, var(--primary-gold-light) 0%, transparent 70%);\n    opacity: 0.08;\n    bottom: -200px;\n    left: -200px;\n    animation: pulse 5s ease-in-out infinite reverse;\n}\n\n@keyframes pulse {\n\n    0%,\n    100% {\n        transform: scale(1);\n        opacity: 0.1;\n    }\n\n    50% {\n        transform: scale(1.1);\n        opacity: 0.15;\n    }\n}\n\n/* ================================================================\n   ç™»å…¥å¡ç‰‡ - ç™½è‰²å¡ç‰‡ + é™°å½±\n   ================================================================ */\n.login-card {\n    width: 100%;\n    max-width: 420px;\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    overflow: hidden;\n    animation: slideIn 0.4s ease-out;\n    position: relative;\n    z-index: 1;\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateY(-30px);\n    }\n\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* ================================================================\n   é ‚éƒ¨ Header - æ·±è‰²èƒŒæ™¯ + é‡‘é»ƒé»ç¶´\n   ================================================================ */\n.login-header {\n    text-align: center;\n    padding: 40px 20px 30px;\n    background: linear-gradient(135deg, var(--dark-blue) 0%, var(--dark-blue-light) 100%);\n    color: white;\n    position: relative;\n    overflow: hidden;\n}\n\n/* Header å…‰æšˆæ•ˆæœ */\n.login-header::after {\n    content: '';\n    position: absolute;\n    top: -50%;\n    left: 50%;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, var(--primary-gold) 0%, transparent 50%);\n    opacity: 0.1;\n    transform: translateX(-50%);\n}\n\n/* LOGO åœ–ç‰‡æ¨£å¼ */\n.brand-logo {\n    width: 80px;\n    height: 80px;\n    margin: 0 auto 15px;\n    display: block;\n    border-radius: 16px;\n    box-shadow: 0 8px 24px rgba(255, 193, 7, 0.3);\n    background: white;\n    padding: 10px;\n    animation: logoGlow 3s ease-in-out infinite;\n}\n\n@keyframes logoGlow {\n\n    0%,\n    100% {\n        box-shadow: 0 8px 24px rgba(255, 193, 7, 0.3);\n    }\n\n    50% {\n        box-shadow: 0 8px 32px rgba(255, 193, 7, 0.5);\n    }\n}\n\n/* æ¨™é¡Œæ¨£å¼ */\n.login-header h1 {\n    font-size: 28px;\n    margin-bottom: 8px;\n    font-weight: 700;\n    color: var(--primary-gold);\n    text-shadow: 0 2px 10px rgba(255, 193, 7, 0.3);\n    position: relative;\n    z-index: 1;\n}\n\n.login-header p {\n    font-size: 13px;\n    opacity: 0.85;\n    color: rgba(255, 255, 255, 0.9);\n    font-weight: 400;\n    position: relative;\n    z-index: 1;\n}\n\n/* ================================================================\n   ç™»å…¥é¡å‹åˆ‡æ› Tab\n   ================================================================ */\n.login-type-tabs {\n    display: flex;\n    margin: 20px 20px 0;\n    background: var(--bg-light);\n    border-radius: 12px;\n    padding: 5px;\n}\n\n.tab-btn {\n    flex: 1;\n    padding: 12px;\n    border: none;\n    background: transparent;\n    color: var(--text-light);\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    border-radius: 8px;\n    transition: all 0.3s ease;\n    position: relative;\n}\n\n.tab-btn:hover:not(.active) {\n    color: var(--text-dark);\n    background: rgba(255, 193, 7, 0.1);\n}\n\n.tab-btn.active {\n    background: linear-gradient(135deg, var(--primary-gold) 0%, var(--primary-gold-dark) 100%);\n    color: white;\n    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);\n}\n\n/* ================================================================\n   ç™»å…¥è¡¨å–®å€åŸŸ\n   ================================================================ */\n.login-body {\n    padding: 30px 25px;\n}\n\n/* è¡¨å–®ç¾¤çµ„ */\n.form-group {\n    margin-bottom: 20px;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 8px;\n    color: var(--text-dark);\n    font-weight: 600;\n    font-size: 14px;\n}\n\n/* è¼¸å…¥æ¡† */\n.form-control {\n    width: 100%;\n    padding: 14px 16px;\n    border: 2px solid #e1e8ed;\n    border-radius: 10px;\n    font-size: 14px;\n    transition: all 0.3s ease;\n    background: white;\n    color: var(--text-dark);\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: var(--primary-gold);\n    box-shadow: 0 0 0 4px rgba(255, 193, 7, 0.1);\n}\n\n.form-control::placeholder {\n    color: #bdc3c7;\n}\n\n/* ================================================================\n   ç™»å…¥æŒ‰éˆ• - é‡‘é»ƒè‰²æ¼¸å±¤\n   ================================================================ */\n.login-btn {\n    width: 100%;\n    padding: 16px;\n    border: none;\n    border-radius: 10px;\n    background: linear-gradient(135deg, var(--primary-gold-light) 0%, var(--primary-gold) 50%, var(--primary-gold-dark) 100%);\n    color: white;\n    font-size: 16px;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n    margin-top: 10px;\n}\n\n.login-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);\n}\n\n.login-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.login-btn:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n}\n\n/* ç®¡ç†å“¡æŒ‰éˆ• - ç´…è‰² */\n.admin-btn {\n    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);\n}\n\n.admin-btn:hover:not(:disabled) {\n    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);\n}\n\n/* ================================================================\n   éŒ¯èª¤è¨Šæ¯\n   ================================================================ */\n.error-msg {\n    margin-top: 20px;\n    padding: 14px 16px;\n    background: linear-gradient(135deg, #fee 0%, #fdd 100%);\n    color: var(--danger-red);\n    border-radius: 10px;\n    font-size: 14px;\n    text-align: center;\n    font-weight: 500;\n    border-left: 4px solid var(--danger-red);\n    animation: shake 0.5s ease;\n}\n\n@keyframes shake {\n\n    0%,\n    100% {\n        transform: translateX(0);\n    }\n\n    25% {\n        transform: translateX(-5px);\n    }\n\n    75% {\n        transform: translateX(5px);\n    }\n}\n\n/* ================================================================\n   æ¸¬è©¦æç¤ºæ¡†\n   ================================================================ */\n.hint-box {\n    margin-top: 20px;\n    padding: 14px 16px;\n    background: linear-gradient(135deg, #e8f4fd 0%, #d1e7f7 100%);\n    border-radius: 10px;\n    color: #0066cc;\n    font-size: 12px;\n    line-height: 1.8;\n    border-left: 4px solid var(--primary-gold);\n}\n\n/* ================================================================\n   é å°¾\n   ================================================================ */\n.login-footer {\n    padding: 20px;\n    text-align: center;\n    color: var(--text-light);\n    background: var(--bg-light);\n    font-size: 12px;\n}\n\n/* ================================================================\n   éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿå„ªåŒ–\n   ================================================================ */\n@media (max-width: 480px) {\n    .login-card {\n        border-radius: 0;\n        max-width: 100%;\n    }\n\n    .login-header {\n        padding: 30px 20px 25px;\n    }\n\n    .login-header h1 {\n        font-size: 24px;\n    }\n\n    .brand-logo {\n        width: 70px;\n        height: 70px;\n    }\n\n    .login-body {\n        padding: 25px 20px;\n    }\n\n    .form-control {\n        font-size: 16px;\n        /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */\n    }\n\n    .login-btn {\n        padding: 14px;\n        font-size: 15px;\n    }\n}\n\n@media (max-width: 360px) {\n    .login-header h1 {\n        font-size: 22px;\n    }\n\n    .brand-logo {\n        width: 60px;\n        height: 60px;\n    }\n\n    .tab-btn {\n        font-size: 13px;\n        padding: 10px;\n    }\n}\n\n/* ================================================================\n   æš—é»‘æ¨¡å¼è¦†è“‹ï¼ˆå¼·åˆ¶åœç”¨ï¼‰\n   ================================================================ */\n@media (prefers-color-scheme: dark) {\n\n    .login-wrapper,\n    .login-card,\n    .form-control {\n        background: white !important;\n        color: var(--text-dark) !important;\n    }\n}\n\n/* ================================================================\n   è¼‰å…¥å‹•ç•«\n   ================================================================ */\n.login-btn:disabled::after {\n    content: 'â³';\n    margin-left: 8px;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    from {\n        transform: rotate(0deg);\n    }\n\n    to {\n        transform: rotate(360deg);\n    }\n}",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 180,
        "y": 1440,
        "wires": [
            []
        ]
    },
    {
        "id": "a4e53ddd023f1ebd",
        "type": "ui-template",
        "z": "4f2c9b23a074cc9b",
        "group": "",
        "page": "14e4b2bc7756e5f9",
        "ui": "",
        "name": "CSS(ç®¡ç†ç•«é¢)",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "/* ================================================================\n   SOLARSDGS ç®¡ç†å“¡é é¢æ¨£å¼è¡¨\n   å“ç‰Œè‰²ç³»ï¼šé‡‘é»ƒ (#FFD700 / #FFC107 / #FFB300) + æ·±è—é»‘ (#2c3e50)\n   \n   âš ï¸ ä½¿ç”¨èªªæ˜ï¼š\n   1. è¤‡è£½é€™æ•´å€‹æª”æ¡ˆçš„å…§å®¹\n   2. è²¼åˆ° Dashboard 2.0 â†’ Site â†’ CSS (overrides) å€åŸŸ\n   3. è²¼åœ¨ç™»å…¥é é¢ CSS çš„ã€ä¸‹æ–¹ã€‘ï¼ˆä¸è¦åˆªé™¤ç™»å…¥ CSSï¼‰\n   4. é»æ“Šå„²å­˜\n   ================================================================ */\n\n/* ğŸ¨ CSS è®Šæ•¸å®šç¾© */\n:root {\n    --primary-gold: #FFC107;\n    --primary-gold-light: #FFD700;\n    --primary-gold-dark: #FFB300;\n    --dark-blue: #2c3e50;\n    --dark-blue-light: #34495e;\n    --success-green: #4CAF50;\n    --warning-orange: #f39c12;\n    --danger-red: #e74c3c;\n    --text-dark: #2c3e50;\n    --text-light: #7f8c8d;\n    --bg-light: #f5f6fa;\n    --border-color: #e1e8ed;\n}\n\n/* ================================================================\n   åŸºç¤æ¨£å¼\n   ================================================================ */\n.admin-dashboard {\n    min-height: 100vh;\n    background: var(--bg-light);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n}\n\n/* ================================================================\n   é ‚éƒ¨ Header - æ·±è‰²èƒŒæ™¯ + é‡‘é»ƒ LOGO\n   ================================================================ */\n.admin-header {\n    background: linear-gradient(135deg, var(--dark-blue) 0%, var(--dark-blue-light) 100%);\n    color: white;\n    padding: 20px 30px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    position: sticky;\n    top: 0;\n    z-index: 100;\n}\n\n.header-left {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n/* LOGO æ¨£å¼ */\n.admin-logo {\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    background: white;\n    padding: 6px;\n    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);\n}\n\n.admin-header h1 {\n    margin: 0;\n    font-size: 22px;\n    font-weight: 700;\n    color: var(--primary-gold);\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.header-actions {\n    display: flex;\n    gap: 15px;\n    align-items: center;\n}\n\n.admin-name {\n    background: rgba(255, 255, 255, 0.1);\n    padding: 8px 16px;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n}\n\n.logout-btn {\n    background: var(--danger-red);\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 600;\n    transition: all 0.3s ease;\n}\n\n.logout-btn:hover {\n    background: #c0392b;\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);\n}\n\n/* ================================================================\n   é ç±¤å°èˆª - é‡‘é»ƒè‰² Active ç‹€æ…‹\n   ================================================================ */\n.tabs {\n    background: white;\n    padding: 0 30px;\n    display: flex;\n    gap: 10px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border-bottom: 2px solid var(--border-color);\n}\n\n.tab {\n    padding: 16px 28px;\n    border: none;\n    background: transparent;\n    cursor: pointer;\n    border-bottom: 3px solid transparent;\n    font-size: 15px;\n    font-weight: 600;\n    color: var(--text-light);\n    transition: all 0.3s ease;\n}\n\n.tab:hover:not(.active) {\n    color: var(--text-dark);\n    background: rgba(255, 193, 7, 0.05);\n}\n\n.tab.active {\n    border-bottom-color: var(--primary-gold);\n    color: var(--primary-gold);\n    background: rgba(255, 193, 7, 0.08);\n}\n\n/* ================================================================\n   ä¸»è¦å…§å®¹å€åŸŸ\n   ================================================================ */\n.tab-content {\n    padding: 30px;\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* å·¥å…·åˆ— */\n.toolbar {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 25px;\n}\n\n.toolbar h2 {\n    margin: 0;\n    font-size: 24px;\n    color: var(--text-dark);\n    font-weight: 700;\n}\n\n.toolbar-actions {\n    display: flex;\n    gap: 10px;\n}\n\n/* ================================================================\n   æŒ‰éˆ•æ¨£å¼ - é‡‘é»ƒè‰²ä¸»æŒ‰éˆ•\n   ================================================================ */\n.btn-primary {\n    background: linear-gradient(135deg, var(--primary-gold-light) 0%, var(--primary-gold) 50%, var(--primary-gold-dark) 100%);\n    color: white;\n    border: none;\n    padding: 12px 24px;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 600;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n}\n\n.btn-primary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);\n}\n\n.btn-secondary {\n    background: var(--dark-blue-light);\n    color: white;\n    border: none;\n    padding: 12px 24px;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 600;\n    transition: all 0.3s ease;\n}\n\n.btn-secondary:hover {\n    background: var(--dark-blue);\n    transform: translateY(-2px);\n}\n\n.btn-sm {\n    padding: 6px 14px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 13px;\n    font-weight: 600;\n    transition: all 0.3s ease;\n    margin-right: 5px;\n}\n\n.btn-edit {\n    background: var(--primary-gold);\n    color: white;\n}\n\n.btn-edit:hover {\n    background: var(--primary-gold-dark);\n    transform: translateY(-1px);\n}\n\n.btn-toggle {\n    background: var(--text-light);\n    color: white;\n}\n\n.btn-toggle:hover {\n    background: var(--text-dark);\n}\n\n.btn-view {\n    background: var(--dark-blue);\n    color: white;\n}\n\n.btn-view:hover {\n    background: var(--dark-blue-light);\n}\n\n/* ================================================================\n   è³‡æ–™è¡¨æ ¼ - ç¾ä»£åŒ–è¨­è¨ˆ\n   ================================================================ */\n.data-table {\n    width: 100%;\n    background: white;\n    border-radius: 12px;\n    overflow: hidden;\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);\n}\n\n.data-table thead {\n    background: linear-gradient(135deg, var(--dark-blue) 0%, var(--dark-blue-light) 100%);\n    color: white;\n}\n\n.data-table th {\n    padding: 16px 20px;\n    text-align: left;\n    font-weight: 600;\n    font-size: 14px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.data-table tbody tr {\n    border-bottom: 1px solid var(--border-color);\n    transition: all 0.3s ease;\n}\n\n.data-table tbody tr:hover {\n    background: rgba(255, 193, 7, 0.05);\n}\n\n.data-table tbody tr:last-child {\n    border-bottom: none;\n}\n\n.data-table td {\n    padding: 16px 20px;\n    color: var(--text-dark);\n    font-size: 14px;\n}\n\n.data-table td strong {\n    color: var(--primary-gold-dark);\n    font-weight: 700;\n}\n\n/* å¾½ç«  */\n.badge {\n    background: var(--primary-gold);\n    color: white;\n    padding: 4px 12px;\n    border-radius: 12px;\n    font-size: 13px;\n    font-weight: 600;\n}\n\n/* è¨­å‚™æ¨™ç±¤ */\n.device-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n}\n\n.device-tag {\n    background: rgba(255, 193, 7, 0.15);\n    color: var(--primary-gold-dark);\n    padding: 4px 10px;\n    border-radius: 6px;\n    font-size: 12px;\n    font-weight: 600;\n    border: 1px solid rgba(255, 193, 7, 0.3);\n}\n\n.text-muted {\n    color: var(--text-light);\n    font-style: italic;\n}\n\n/* ç‹€æ…‹æŒ‡ç¤ºå™¨ */\n.status {\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 13px;\n    font-weight: 600;\n    display: inline-block;\n}\n\n.status.active {\n    background: rgba(76, 175, 80, 0.15);\n    color: var(--success-green);\n    border: 1px solid rgba(76, 175, 80, 0.3);\n}\n\n.status.inactive {\n    background: rgba(127, 140, 141, 0.15);\n    color: var(--text-light);\n    border: 1px solid rgba(127, 140, 141, 0.3);\n}\n\n.device-status {\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 13px;\n    font-weight: 600;\n}\n\n.device-status.online {\n    background: rgba(76, 175, 80, 0.15);\n    color: var(--success-green);\n}\n\n.device-status.offline {\n    background: rgba(231, 76, 60, 0.15);\n    color: var(--danger-red);\n}\n\n/* ================================================================\n   Modal å½ˆçª—\n   ================================================================ */\n.modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.6);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 1000;\n    animation: fadeIn 0.3s ease;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n    }\n\n    to {\n        opacity: 1;\n    }\n}\n\n.modal-content {\n    background: white;\n    border-radius: 16px;\n    padding: 30px;\n    width: 90%;\n    max-width: 500px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    animation: slideUp 0.3s ease;\n}\n\n@keyframes slideUp {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.modal-content h2 {\n    margin: 0 0 25px 0;\n    font-size: 24px;\n    color: var(--text-dark);\n    font-weight: 700;\n}\n\n/* è¡¨å–®ç¾¤çµ„ */\n.form-group {\n    margin-bottom: 20px;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 8px;\n    color: var(--text-dark);\n    font-weight: 600;\n    font-size: 14px;\n}\n\n.form-control {\n    width: 100%;\n    padding: 12px 16px;\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    font-size: 14px;\n    transition: all 0.3s ease;\n    background: white;\n    color: var(--text-dark);\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: var(--primary-gold);\n    box-shadow: 0 0 0 4px rgba(255, 193, 7, 0.1);\n}\n\n.form-control:disabled {\n    background: var(--bg-light);\n    cursor: not-allowed;\n}\n\n.hint {\n    display: block;\n    margin-top: 6px;\n    color: var(--text-light);\n    font-size: 12px;\n}\n\n.modal-actions {\n    display: flex;\n    gap: 10px;\n    margin-top: 25px;\n}\n\n/* ================================================================\n   çµ±è¨ˆå¡ç‰‡ - å…¨åŸŸç›£æ§\n   ================================================================ */\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 20px;\n    margin-top: 30px;\n}\n\n.stat-card {\n    background: white;\n    border-radius: 12px;\n    padding: 25px;\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);\n    transition: all 0.3s ease;\n    border-left: 4px solid var(--primary-gold);\n}\n\n.stat-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);\n}\n\n.stat-icon {\n    font-size: 40px;\n    margin-bottom: 15px;\n}\n\n.stat-value {\n    font-size: 36px;\n    font-weight: 700;\n    color: var(--primary-gold-dark);\n    margin-bottom: 8px;\n}\n\n.stat-label {\n    font-size: 14px;\n    color: var(--text-light);\n    font-weight: 600;\n}\n\n/* ================================================================\n   ç©ºç‹€æ…‹ & è¼‰å…¥ç‹€æ…‹\n   ================================================================ */\n.empty-state {\n    text-align: center;\n    padding: 60px 20px;\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);\n}\n\n.empty-state p {\n    font-size: 18px;\n    color: var(--text-light);\n    margin-bottom: 20px;\n}\n\n.loading-box {\n    text-align: center;\n    padding: 60px 20px;\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);\n}\n\n.loading-box p {\n    font-size: 18px;\n    color: var(--primary-gold);\n    animation: pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes pulse {\n\n    0%,\n    100% {\n        opacity: 1;\n    }\n\n    50% {\n        opacity: 0.5;\n    }\n}\n\n/* ================================================================\n   éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿå„ªåŒ–\n   ================================================================ */\n@media (max-width: 768px) {\n    .admin-header {\n        flex-direction: column;\n        gap: 15px;\n        padding: 15px 20px;\n    }\n\n    .header-left {\n        width: 100%;\n        justify-content: center;\n    }\n\n    .header-actions {\n        width: 100%;\n        justify-content: space-between;\n    }\n\n    .tabs {\n        padding: 0 15px;\n        overflow-x: auto;\n    }\n\n    .tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        white-space: nowrap;\n    }\n\n    .tab-content {\n        padding: 20px 15px;\n    }\n\n    .toolbar {\n        flex-direction: column;\n        gap: 15px;\n        align-items: flex-start;\n    }\n\n    .toolbar-actions {\n        width: 100%;\n        flex-direction: column;\n    }\n\n    .toolbar-actions button {\n        width: 100%;\n    }\n\n    .data-table {\n        font-size: 13px;\n    }\n\n    .data-table th,\n    .data-table td {\n        padding: 12px 10px;\n    }\n\n    .stats-grid {\n        grid-template-columns: 1fr;\n    }\n\n    .modal-content {\n        width: 95%;\n        padding: 20px;\n    }\n\n    .modal-actions {\n        flex-direction: column;\n    }\n\n    .modal-actions button {\n        width: 100%;\n    }\n}\n\n@media (max-width: 480px) {\n    .admin-header h1 {\n        font-size: 18px;\n    }\n\n    .admin-logo {\n        width: 35px;\n        height: 35px;\n    }\n\n    .data-table {\n        display: block;\n        overflow-x: auto;\n    }\n}\n\n/* ================================================================\n   æš—é»‘æ¨¡å¼è¦†è“‹ï¼ˆå¼·åˆ¶åœç”¨ï¼‰\n   ================================================================ */\n@media (prefers-color-scheme: dark) {\n\n    .admin-dashboard,\n    .admin-dashboard * {\n        color-scheme: light !important;\n    }\n}",
        "storeOutMessages": true,
        "passthru": true,
        "resendOnRefresh": true,
        "templateScope": "page:style",
        "className": "",
        "x": 240,
        "y": 1660,
        "wires": [
            []
        ]
    },
    {
        "id": "http_icon_512",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /api/icon-512.png",
        "url": "/api/icon-512.png",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "http_icon_192",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /api/icon-192.png",
        "url": "/api/icon-192.png",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "http_icon_180",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /api/icon-180.png",
        "url": "/api/icon-180.png",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "http_favicon",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /api/favicon.ico",
        "url": "/api/favicon.ico",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "func_return_icon",
        "type": "function",
        "z": "pwa_icons_tab",
        "name": "Return Logo Base64",
        "func": "// âš ï¸ è«‹å°‡ä½ è¤‡è£½çš„ Base64 è²¼åœ¨ä¸‹é¢é€™è¡Œï¼ˆæ›¿æ›æ•´å€‹å­—ä¸²ï¼‰\nconst logoBase64 = \"data:image/png;base64,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\";\n\n// å°‡ Base64 è½‰æ›ç‚º Buffer\nconst base64Data = logoBase64.split(',')[1];\nconst imageBuffer = Buffer.from(base64Data, 'base64');\n\n// è¨­å®šå›æ‡‰\nmsg.payload = imageBuffer;\nmsg.headers = {\n    'Content-Type': 'image/png',\n    'Cache-Control': 'public, max-age=31536000',\n    'Access-Control-Allow-Origin': '*'\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "http_response_icon",
        "type": "http response",
        "z": "pwa_icons_tab",
        "name": "Response",
        "statusCode": "",
        "headers": {},
        "x": 660,
        "y": 180,
        "wires": []
    },
    {
        "id": "http_manifest",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /api/manifest.json",
        "url": "/api/manifest.json",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "func_manifest",
        "type": "function",
        "z": "pwa_icons_tab",
        "name": "Generate manifest.json",
        "func": "// PWA Manifest è¨­å®š\nmsg.payload = {\n    \"name\": \"SOLARSDGS å¤ªé™½èƒ½ç›£æ§ç³»çµ±\",\n    \"short_name\": \"SOLARSDGS\",\n    \"description\": \"å°ˆæ¥­çš„å¤ªé™½èƒ½ç™¼é›»å³æ™‚ç›£æ§å¹³å°\",\n    \"start_url\": \"/dashboard/login\",\n    \"display\": \"standalone\",\n    \"background_color\": \"#2c3e50\",\n    \"theme_color\": \"#FFD700\",\n    \"orientation\": \"portrait-primary\",\n    \"icons\": [\n        {\n            \"src\": \"/api/icon-192.png\",\n            \"sizes\": \"192x192\",\n            \"type\": \"image/png\",\n            \"purpose\": \"any maskable\"\n        },\n        {\n            \"src\": \"/api/icon-512.png\",\n            \"sizes\": \"512x512\",\n            \"type\": \"image/png\",\n            \"purpose\": \"any maskable\"\n        },\n        {\n            \"src\": \"/api/icon-180.png\",\n            \"sizes\": \"180x180\",\n            \"type\": \"image/png\"\n        }\n    ],\n    \"scope\": \"/\",\n    \"categories\": [\"productivity\", \"utilities\", \"energy\"]\n};\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Cache-Control\": \"public, max-age=3600\",\n    \"Access-Control-Allow-Origin\": \"*\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "http_response_manifest",
        "type": "http response",
        "z": "pwa_icons_tab",
        "name": "Response",
        "statusCode": "",
        "headers": {},
        "x": 680,
        "y": 380,
        "wires": []
    },
    {
        "id": "comment_instructions",
        "type": "comment",
        "z": "pwa_icons_tab",
        "name": "ğŸ“‹ ä½¿ç”¨ /api/ è·¯å¾‘é¿å… Dashboard 2.0 çš„ Session æª¢æŸ¥",
        "info": "## å®‰è£æ­¥é©Ÿ\n\n### 1. ä¿®æ”¹ Base64\né›™æ“Š \"Return Logo Base64\" Function ç¯€é»\næ‰¾åˆ°é€™è¡Œï¼š\n```javascript\nconst logoBase64 = \"data:image/png;base64,...\";\n```\næ›¿æ›æˆä½ è¤‡è£½çš„å®Œæ•´ Base64 å­—ä¸²\n\n### 2. éƒ¨ç½²\né»æ“Šå³ä¸Šè§’ Deploy æŒ‰éˆ•\n\n### 3. æ¸¬è©¦\nè¨ªå•ä»¥ä¸‹ç¶²å€ç¢ºèªåœ–æ¨™æ­£å¸¸é¡¯ç¤ºï¼š\n- https://solar.alwaysbefound.com/api/icon-512.png\n- https://solar.alwaysbefound.com/api/icon-192.png\n- https://solar.alwaysbefound.com/api/manifest.json\n\n### 4. è¨­å®š Dashboard 2.0\nåœ¨ Dashboard 2.0 å´é‚Šæ¬„ â†’ ui-base â†’ Siteï¼š\n- App Icon (192): /api/icon-192.png\n- App Icon (512): /api/icon-512.png\n- Favicon: /api/favicon.ico\n- Manifest URL: /api/manifest.json",
        "x": 310,
        "y": 40,
        "wires": []
    },
    {
        "id": "http_pwa_64",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /dashboard/pwa-64x64.png",
        "url": "/dashboard/pwa-64x64.png",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 890,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "http_pwa_192",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /dashboard/pwa-192x192.png",
        "url": "/dashboard/pwa-192x192.png",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 900,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "http_pwa_512",
        "type": "http in",
        "z": "pwa_icons_tab",
        "name": "GET /dashboard/pwa-512x512.png",
        "url": "/dashboard/pwa-512x512.png",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 890,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "comment_new_endpoints",
        "type": "comment",
        "z": "pwa_icons_tab",
        "name": "âœ… æ–°å¢ï¼šå°æ‡‰ manifest.webmanifest çš„è·¯å¾‘",
        "info": "é€™ä¸‰å€‹ endpoint å°æ‡‰ Dashboard 2.0 manifest.webmanifest ä¸­çš„ icon è·¯å¾‘ï¼š\n- /dashboard/pwa-64x64.png\n- /dashboard/pwa-192x192.png\n- /dashboard/pwa-512x512.png\n\nå®ƒå€‘æœƒé€£æ¥åˆ°æ‚¨ç¾æœ‰çš„ 'Return Logo Base64' Function ç¯€é»ï¼Œ\næ‰€ä»¥æœƒè¿”å›ç›¸åŒçš„åœ–æ¨™ã€‚",
        "x": 930,
        "y": 160,
        "wires": []
    },
    {
        "id": "3f3a97a0326341eb",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-contrib-postgresql": "0.15.4",
            "@flowfuse/node-red-dashboard": "1.28.0",
            "node-red-contrib-web-worldmap": "5.5.2",
            "@flowfuse/node-red-dashboard-2-ui-iframe": "1.1.0"
        }
    }
]
